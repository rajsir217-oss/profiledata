{
  "id": "scheduled_all_1760373635",
  "timestamp": "2025-10-13T09:43:24.775526",
  "test_type": "all",
  "status": "completed",
  "total_tests": 402,
  "passed_tests": 259,
  "failed_tests": 143,
  "duration": 169.42114186286926,
  "output": "Frontend: \n> frontend@0.1.0 test\n> react-scripts test --watchAll=false --passWithNoTests\n\nPASS src/__tests__/api.test.js\nFAIL src/components/__tests__/Sidebar.test.js\n  \u25cf Test suite failed to run\n\n    TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')\n\n      26 | mockAxios.put.mockResolvedValue({ data: {} });\n      27 | mockAxios.delete.mockResolvedValue({ data: {} });\n    > 28 | mockAxios.patch.mockResolvedValue({ data: {} });\n         |                 ^\n      29 | mockAxios.head.mockResolvedValue({ data: {} });\n      30 | mockAxios.options.mockResolvedValue({ data: {} });\n      31 |\n\n      at Object.<anonymous> (src/__mocks__/axios.js:28:17)\n      at Object.<anonymous> (src/api.js:2:1)\n      at Object.<anonymous> (src/components/Sidebar.js:3:1)\n      at Object.<anonymous> (src/components/__tests__/Sidebar.test.js:18:1)\n\nPASS src/components/__tests__/Login.test.js (6.471 s)\nPASS src/components/__tests__/Profile.test.js (6.591 s)\n  \u25cf Console\n\n    console.log\n      \u2705 WebSocket listeners initialized for online status\n\n      at OnlineStatusService.initializeWebSocket (src/services/onlineStatusService.js:60:15)\n\n    console.log\n      \ud83d\udccd Profile component loaded for username: testuser\n\n      at Profile (src/components/Profile.js:19:11)\n\n    console.log\n      \ud83d\udccd Profile component loaded for username: testuser\n\n      at Profile (src/components/Profile.js:19:11)\n\n    console.log\n      \ud83d\udccd Profile component loaded for username: testuser\n\n      at Profile (src/components/Profile.js:19:11)\n\n    console.log\n      \ud83d\udccd Profile component loaded for username: testuser\n\n      at Profile (src/components/Profile.js:19:11)\n\n    console.log\n      \ud83d\udccd Profile component loaded for username: testuser\n\n      at Profile (src/components/Profile.js:19:11)\n\n    console.log\n      \ud83d\udccd Profile component loaded for username: testuser\n\n      at Profile (src/components/Profile.js:19:11)\n\n    console.log\n      \ud83d\udccd Profile component loaded for username: testuser\n\n      at Profile (src/components/Profile.js:19:11)\n\nFAIL src/components/__tests__/SearchPage.test.js (7.327 s)\n  \u25cf Console\n\n    console.log\n      \u2705 WebSocket listeners initialized for online status\n\n      at OnlineStatusService.initializeWebSocket (src/services/onlineStatusService.js:60:15)\n\n  \u25cf SearchPage Component \u203a renders search form\n\n    TypeError: navigate is not a function\n\n      81 |     const username = localStorage.getItem('username');\n      82 |     if (!username) {\n    > 83 |       navigate('/login');\n         |       ^\n      84 |       return;\n      85 |     }\n      86 |     \n\n      at src/components/SearchPage.js:83:7\n      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)\n      at Object.<anonymous>.process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)\n      at node_modules/@testing-library/react/dist/act-compat.js:47:25\n      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)\n      at render (node_modules/@testing-library/react/dist/pure.js:292:10)\n      at Object.<anonymous> (src/components/__tests__/SearchPage.test.js:37:11)\n\n  \u25cf SearchPage Component \u203a allows user to type in search input\n\n    TypeError: navigate is not a function\n\n      81 |     const username = localStorage.getItem('username');\n      82 |     if (!username) {\n    > 83 |       navigate('/login');\n         |       ^\n      84 |       return;\n      85 |     }\n      86 |     \n\n      at src/components/SearchPage.js:83:7\n      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)\n      at Object.<anonymous>.process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)\n      at node_modules/@testing-library/react/dist/act-compat.js:47:25\n      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)\n      at render (node_modules/@testing-library/react/dist/pure.js:292:10)\n      at Object.<anonymous> (src/components/__tests__/SearchPage.test.js:45:11)\n\n  \u25cf SearchPage Component \u203a displays search filters\n\n    TypeError: navigate is not a function\n\n      81 |     const username = localStorage.getItem('username');\n      82 |     if (!username) {\n    > 83 |       navigate('/login');\n         |       ^\n      84 |       return;\n      85 |     }\n      86 |     \n\n      at src/components/SearchPage.js:83:7\n      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)\n      at Object.<anonymous>.process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)\n      at node_modules/@testing-library/react/dist/act-compat.js:47:25\n      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)\n      at render (node_modules/@testing-library/react/dist/pure.js:292:10)\n      at Object.<anonymous> (src/components/__tests__/SearchPage.test.js:54:11)\n\n  \u25cf SearchPage Component \u203a displays search results section\n\n    TypeError: navigate is not a function\n\n      81 |     const username = localStorage.getItem('username');\n      82 |     if (!username) {\n    > 83 |       navigate('/login');\n         |       ^\n      84 |       return;\n      85 |     }\n      86 |     \n\n      at src/components/SearchPage.js:83:7\n      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)\n      at Object.<anonymous>.process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)\n      at node_modules/@testing-library/react/dist/act-compat.js:47:25\n      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)\n      at render (node_modules/@testing-library/react/dist/pure.js:292:10)\n      at Object.<anonymous> (src/components/__tests__/SearchPage.test.js:61:11)\n\n  \u25cf SearchPage Component \u203a shows no results message when no users found\n\n    TypeError: navigate is not a function\n\n      81 |     const username = localStorage.getItem('username');\n      82 |     if (!username) {\n    > 83 |       navigate('/login');\n         |       ^\n      84 |       return;\n      85 |     }\n      86 |     \n\n      at src/components/SearchPage.js:83:7\n      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)\n      at Object.<anonymous>.process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)\n      at node_modules/@testing-library/react/dist/act-compat.js:47:25\n      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)\n      at render (node_modules/@testing-library/react/dist/pure.js:292:10)\n      at Object.<anonymous> (src/components/__tests__/SearchPage.test.js:67:11)\n\n  \u25cf SearchPage Component \u203a displays saved searches section\n\n    TypeError: navigate is not a function\n\n      81 |     const username = localStorage.getItem('username');\n      82 |     if (!username) {\n    > 83 |       navigate('/login');\n         |       ^\n      84 |       return;\n      85 |     }\n      86 |     \n\n      at src/components/SearchPage.js:83:7\n      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)\n      at Object.<anonymous>.process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)\n      at node_modules/@testing-library/react/dist/act-compat.js:47:25\n      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)\n      at render (node_modules/@testing-library/react/dist/pure.js:292:10)\n      at Object.<anonymous> (src/components/__tests__/SearchPage.test.js:74:11)\n\nTest Suites: 2 failed, 3 passed, 5 total\nTests:       6 failed, 10 passed, 16 total\nSnapshots:   0 total\nTime:        10.661 s\nRan all test suites.\n\nBackend: ........FFFFFFFF........................................................ [ 17%]\n...................................F....................FFFF.F.......... [ 35%]\n....F.........F.FFFFFFFFFFFFFFFFFFF..FFF..FFFF.FF....................... [ 52%]\n.................................F.FFFFFFFFFFFFFF...FFF.FFFFFFFFFFFF.FFF [ 70%]\nFFFF.F..FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF.FFFFFFFF.FFFF.FFFFFFFFFFF.. [ 87%]\n.F.........F.......................sssssssss.......                      [100%]\n=================================== FAILURES ===================================\n_____ TestJWTTokenFunctions.test_create_access_token_with_custom_settings ______\n\nargs = (<test_auth.TestJWTTokenFunctions object at 0x107b74a10>,), keywargs = {}\n\n    @wraps(func)\n    def patched(*args, **keywargs):\n>       with self.decoration_helper(patched,\n                                    args,\n                                    keywargs) as (newargs, newkeywargs):\n\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1384: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:137: in __enter__\n    return next(self.gen)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1366: in decoration_helper\n    arg = exit_stack.enter_context(patching)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:526: in enter_context\n    result = _enter(cm)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1455: in __enter__\n    original, local = self.get_original()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x107a65d90>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'auth' from '/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/__init__.py'> does not have the attribute 'settings'\n\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1428: AttributeError\n_____________ TestGetCurrentUser.test_get_current_user_valid_token _____________\n\nself = <Coroutine test_get_current_user_valid_token>\n\n    def runtest(self) -> None:\n        self.obj = wrap_in_sync(\n            # https://github.com/pytest-dev/pytest-asyncio/issues/596\n            self.obj,  # type: ignore[has-type]\n        )\n>       super().runtest()\n\nvenv/lib/python3.12/site-packages/pytest_asyncio/plugin.py:440: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/pytest_asyncio/plugin.py:907: in inner\n    _loop.run_until_complete(task)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py:685: in run_until_complete\n    return future.result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1401: in patched\n    with self.decoration_helper(patched,\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:137: in __enter__\n    return next(self.gen)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1366: in decoration_helper\n    arg = exit_stack.enter_context(patching)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:526: in enter_context\n    result = _enter(cm)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1455: in __enter__\n    original, local = self.get_original()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x107a19970>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'auth' from '/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/__init__.py'> does not have the attribute 'settings'\n\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1428: AttributeError\n____________ TestGetCurrentUser.test_get_current_user_invalid_token ____________\n\nargs = (<test_auth.TestGetCurrentUser object at 0x107b753d0>,), keywargs = {}\n\n    @wraps(func)\n    def patched(*args, **keywargs):\n>       with self.decoration_helper(patched,\n                                    args,\n                                    keywargs) as (newargs, newkeywargs):\n\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1384: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:137: in __enter__\n    return next(self.gen)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1366: in decoration_helper\n    arg = exit_stack.enter_context(patching)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:526: in enter_context\n    result = _enter(cm)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1455: in __enter__\n    original, local = self.get_original()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x107a5ee10>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'auth' from '/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/__init__.py'> does not have the attribute 'settings'\n\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1428: AttributeError\n____________ TestGetCurrentUser.test_get_current_user_expired_token ____________\n\nargs = (<test_auth.TestGetCurrentUser object at 0x107b767b0>,), keywargs = {}\n\n    @wraps(func)\n    def patched(*args, **keywargs):\n>       with self.decoration_helper(patched,\n                                    args,\n                                    keywargs) as (newargs, newkeywargs):\n\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1384: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:137: in __enter__\n    return next(self.gen)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1366: in decoration_helper\n    arg = exit_stack.enter_context(patching)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:526: in enter_context\n    result = _enter(cm)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1455: in __enter__\n    original, local = self.get_original()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x107a5ecc0>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'auth' from '/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/__init__.py'> does not have the attribute 'settings'\n\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1428: AttributeError\n_______________ TestGetCurrentUser.test_get_current_user_no_sub ________________\n\nargs = (<test_auth.TestGetCurrentUser object at 0x107b744d0>,), keywargs = {}\n\n    @wraps(func)\n    def patched(*args, **keywargs):\n>       with self.decoration_helper(patched,\n                                    args,\n                                    keywargs) as (newargs, newkeywargs):\n\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1384: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:137: in __enter__\n    return next(self.gen)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1366: in decoration_helper\n    arg = exit_stack.enter_context(patching)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:526: in enter_context\n    result = _enter(cm)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1455: in __enter__\n    original, local = self.get_original()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x107b75700>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'auth' from '/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/__init__.py'> does not have the attribute 'settings'\n\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1428: AttributeError\n____________ TestGetCurrentUser.test_get_current_user_wrong_secret _____________\n\nargs = (<test_auth.TestGetCurrentUser object at 0x107b77320>,), keywargs = {}\n\n    @wraps(func)\n    def patched(*args, **keywargs):\n>       with self.decoration_helper(patched,\n                                    args,\n                                    keywargs) as (newargs, newkeywargs):\n\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1384: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:137: in __enter__\n    return next(self.gen)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1366: in decoration_helper\n    arg = exit_stack.enter_context(patching)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:526: in enter_context\n    result = _enter(cm)\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1455: in __enter__\n    original, local = self.get_original()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x107b75820>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'auth' from '/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/__init__.py'> does not have the attribute 'settings'\n\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1428: AttributeError\n____________ TestIntegrationScenarios.test_full_authentication_flow ____________\n\nself = <test_auth.TestIntegrationScenarios object at 0x107b74350>\n\n    def test_full_authentication_flow(self):\n        \"\"\"Test complete authentication flow.\"\"\"\n        # 1. Hash a password\n        password = \"testpassword123\"\n        hashed = PasswordManager.hash_password(password)\n    \n        # 2. Verify the password\n        assert PasswordManager.verify_password(password, hashed) is True\n    \n        # 3. Create a token for the user with mocked settings\n>       with patch('auth.settings') as mock_settings:\n\ntests/test_auth.py:218: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1455: in __enter__\n    original, local = self.get_original()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <unittest.mock._patch object at 0x107f0fc80>\n\n    def get_original(self):\n        target = self.getter()\n        name = self.attribute\n    \n        original = DEFAULT\n        local = False\n    \n        try:\n            original = target.__dict__[name]\n        except (AttributeError, KeyError):\n            original = getattr(target, name, DEFAULT)\n        else:\n            local = True\n    \n        if name in _builtins and isinstance(target, ModuleType):\n            self.create = True\n    \n        if not self.create and original is DEFAULT:\n>           raise AttributeError(\n                \"%s does not have the attribute %r\" % (target, name)\n            )\nE           AttributeError: <module 'auth' from '/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/__init__.py'> does not have the attribute 'settings'\n\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/unittest/mock.py:1428: AttributeError\n__________ TestIntegrationScenarios.test_password_security_edge_cases __________\n\nself = <test_auth.TestIntegrationScenarios object at 0x107b74290>\n\n    def test_password_security_edge_cases(self):\n        \"\"\"Test password security edge cases.\"\"\"\n        # Test empty password validation at model level\n        with pytest.raises(Exception):\n            UserCreate(username=\"testuser\", password=\"\")\n    \n        # Test very long password (bcrypt handles up to 72 bytes)\n        very_long_password = \"a\" * 200\n>       hashed = get_password_hash(very_long_password)\nE       NameError: name 'get_password_hash' is not defined\n\ntests/test_auth.py:238: NameError\n_________ TestPasswordPolicyIntegration.test_password_expiry_workflow __________\n\nself = <test_auth_module.TestPasswordPolicyIntegration object at 0x107c1dc40>\n\n    def test_password_expiry_workflow(self):\n        \"\"\"Test complete password expiry workflow\"\"\"\n        # Create password\n        password = \"SecurePass123!\"\n        hashed = PasswordManager.hash_password(password)\n    \n        # Set expiry\n        changed_at = datetime.utcnow()\n        expires_at = PasswordManager.calculate_password_expiry(changed_at)\n    \n        # Check not expired\n        assert PasswordManager.is_password_expired(expires_at) is False\n    \n        # Check days until expiry\n        days_left = PasswordManager.get_days_until_expiry(expires_at)\n>       assert days_left == security_settings.PASSWORD_EXPIRY_DAYS\nE       AssertionError: assert 89 == 90\nE        +  where 90 = SecuritySettings(JWT_SECRET_KEY='your-secret-key-change-in-production', JWT_ALGORITHM='HS256', JWT_ACCESS_TOKEN_EXPIRE...ED_ATTEMPTS_PER_IP=20, DEFAULT_USER_ROLE='free_user', SYSTEM_ROLES=['admin', 'moderator', 'premium_user', 'free_user']).PASSWORD_EXPIRY_DAYS\n\ntests/test_auth_module.py:391: AssertionError\n___________________________ test_full_user_lifecycle ___________________________\n\ntest_client = <starlette.testclient.TestClient object at 0x108350620>\n\n    def test_full_user_lifecycle(test_client):\n        \"\"\"Test complete user lifecycle: register -> login -> profile -> update -> delete.\"\"\"\n        # 1. Register user\n        user_data = {\n            \"username\": \"lifecycle_user\",\n            \"password\": \"testpass123\",\n            \"firstName\": \"Lifecycle\",\n            \"lastName\": \"Test\",\n            \"contactEmail\": \"lifecycle@example.com\",\n            \"contactNumber\": \"1234567890\",\n            \"dob\": \"1990-01-01\",\n            \"sex\": \"Male\",\n            \"height\": \"5'8\\\"\",\n            \"location\": \"Test City\",\n            \"education\": \"Bachelor's Degree\",\n            \"workingStatus\": \"Employed\",\n            \"citizenshipStatus\": \"Citizen\"\n        }\n    \n        response = test_client.post(\"/api/users/register\", data=user_data)\n>       assert response.status_code == 201\nE       assert 422 == 201\nE        +  where 422 = <Response [422 Unprocessable Entity]>.status_code\n\ntests/test_e2e_api.py:70: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:19,360 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:19,364 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.005s\n2025-10-13 09:41:19,368 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.005s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n__________________________ test_pii_masking_workflow ___________________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_e2e_api.py\", line 149, in test_pii_masking_workflow\n    |     profile_response = test_client.get(\"/api/users/profile/pii_user1\",\n    |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    |     user = await db.users.find_one({\"username\": username})\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\ntest_client = <starlette.testclient.TestClient object at 0x108141ee0>\n\n    def test_pii_masking_workflow(test_client):\n        \"\"\"Test complete PII masking workflow.\"\"\"\n        # Register two users\n        user1_data = {\n            \"username\": \"pii_user1\",\n            \"password\": \"testpass123\",\n            \"firstName\": \"PII\",\n            \"lastName\": \"User1\",\n            \"contactEmail\": \"pii1@example.com\",\n            \"contactNumber\": \"555-123-4567\",\n            \"location\": \"123 Main St, New York, NY\",\n            \"workplace\": \"Google Inc, Mountain View\"\n        }\n    \n        user2_data = user1_data.copy()\n        user2_data[\"username\"] = \"pii_user2\"\n        user2_data[\"contactEmail\"] = \"pii2@example.com\"\n        user2_data[\"contactNumber\"] = \"555-987-6543\"\n    \n        test_client.post(\"/api/users/register\", data=user1_data)\n        test_client.post(\"/api/users/register\", data=user2_data)\n    \n        # Get user1's profile as user2 (should be masked)\n>       profile_response = test_client.get(\"/api/users/profile/pii_user1\",\n                                           params={\"requester\": \"pii_user2\"})\n\ntests/test_e2e_api.py:149: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'pii_user1', requester = 'pii_user2'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.get(\"/profile/{username}\")\n    async def get_user_profile(username: str, requester: str = None, db = Depends(get_database)):\n        \"\"\"Get user profile by username with PII masking\"\"\"\n        logger.info(f\"\ud83d\udc64 Profile request for username: {username} (requester: {requester})\")\n    \n        # Find user\n        logger.debug(f\"Fetching profile for user '{username}'...\")\n>       user = await db.users.find_one({\"username\": username})\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:469: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:19,444 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:19,447 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\n2025-10-13 09:41:19,537 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:19,540 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:19,543 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\n2025-10-13 09:41:19,545 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:19,555 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/profile/pii_user1\n2025-10-13 09:41:19,556 - routes - INFO - \ud83d\udc64 Profile request for username: pii_user1 (requester: pii_user2)\n2025-10-13 09:41:19,558 - main - ERROR - \u274c Error processing GET /api/users/profile/pii_user1 - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    user = await db.users.find_one({\"username\": username})\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/profile/pii_user1\nINFO     routes:routes.py:465 \ud83d\udc64 Profile request for username: pii_user1 (requester: pii_user2)\nERROR    main:main.py:120 \u274c Error processing GET /api/users/profile/pii_user1 - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    user = await db.users.find_one({\"username\": username})\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n__________________________ test_search_and_filtering ___________________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_e2e_api.py\", line 227, in test_search_and_filtering\n    |     keyword_response = test_client.get(\"/api/users/search\", params={\"keyword\": \"John\"})\n    |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\ntest_client = <starlette.testclient.TestClient object at 0x10811bfb0>\n\n    def test_search_and_filtering(test_client):\n        \"\"\"Test search functionality with various filters.\"\"\"\n        # Register multiple users with different attributes\n        users_data = [\n            {\n                \"username\": \"search_user1\",\n                \"password\": \"testpass123\",\n                \"firstName\": \"John\",\n                \"lastName\": \"Doe\",\n                \"sex\": \"Male\",\n                \"location\": \"New York, NY\",\n                \"education\": \"Bachelor's Degree\"\n            },\n            {\n                \"username\": \"search_user2\",\n                \"password\": \"testpass123\",\n                \"firstName\": \"Jane\",\n                \"lastName\": \"Smith\",\n                \"sex\": \"Female\",\n                \"location\": \"Los Angeles, CA\",\n                \"education\": \"Master's Degree\"\n            },\n            {\n                \"username\": \"search_user3\",\n                \"password\": \"testpass123\",\n                \"firstName\": \"Bob\",\n                \"lastName\": \"Johnson\",\n                \"sex\": \"Male\",\n                \"location\": \"New York, NY\",\n                \"education\": \"PhD\"\n            }\n        ]\n    \n        for user_data in users_data:\n            test_client.post(\"/api/users/register\", data=user_data)\n    \n        # Test keyword search\n>       keyword_response = test_client.get(\"/api/users/search\", params={\"keyword\": \"John\"})\n\ntests/test_e2e_api.py:227: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = 'John', gender = '', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:20,822 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:20,828 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.005s\n2025-10-13 09:41:20,832 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:20,842 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:20,846 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\n2025-10-13 09:41:20,853 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:20,858 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:20,862 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\n2025-10-13 09:41:20,872 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:20,874 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:41:20,876 - routes - INFO - \ud83d\udd0d Search request - keyword: 'John', status: '', page: 1, limit: 20\n2025-10-13 09:41:20,876 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'John', '$options': 'i'}}, {'lastName': {'$regex': 'John', '$options': 'i'}}, {'username': {'$regex': 'John', '$options': 'i'}}, {'location': {'$regex': 'John', '$options': 'i'}}, {'education': {'$regex': 'John', '$options': 'i'}}, {'occupation': {'$regex': 'John', '$options': 'i'}}, {'aboutYou': {'$regex': 'John', '$options': 'i'}}, {'bio': {'$regex': 'John', '$options': 'i'}}, {'interests': {'$regex': 'John', '$options': 'i'}}]}\n2025-10-13 09:41:20,878 - routes - ERROR - \u274c Search execution error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\n2025-10-13 09:41:20,879 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.004s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.005s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: 'John', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'John', '$options': 'i'}}, {'lastName': {'$regex': 'John', '$options': 'i'}}, {'username': {'$regex': 'John', '$options': 'i'}}, {'location': {'$regex': 'John', '$options': 'i'}}, {'education': {'$regex': 'John', '$options': 'i'}}, {'occupation': {'$regex': 'John', '$options': 'i'}}, {'aboutYou': {'$regex': 'John', '$options': 'i'}}, {'bio': {'$regex': 'John', '$options': 'i'}}, {'interests': {'$regex': 'John', '$options': 'i'}}]}\nERROR    routes:routes.py:1266 \u274c Search execution error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.004s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n___________________________ test_concurrent_requests ___________________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_e2e_api.py\", line 265, in test_concurrent_requests\n    |     response = test_client.get(f\"/api/users/profile/concurrent_user\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    |     user = await db.users.find_one({\"username\": username})\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\ntest_client = <starlette.testclient.TestClient object at 0x108111c70>\n\n    def test_concurrent_requests(test_client):\n        \"\"\"Test handling of concurrent requests.\"\"\"\n        # Register a user first\n        test_client.post(\"/api/users/register\", data={\n            \"username\": \"concurrent_user\",\n            \"password\": \"testpass123\",\n            \"firstName\": \"Concurrent\",\n            \"lastName\": \"Test\"\n        })\n    \n        # Send multiple sequential requests\n        responses = []\n        for i in range(10):\n>           response = test_client.get(f\"/api/users/profile/concurrent_user\")\n\ntests/test_e2e_api.py:265: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'concurrent_user', requester = None\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.get(\"/profile/{username}\")\n    async def get_user_profile(username: str, requester: str = None, db = Depends(get_database)):\n        \"\"\"Get user profile by username with PII masking\"\"\"\n        logger.info(f\"\ud83d\udc64 Profile request for username: {username} (requester: {requester})\")\n    \n        # Find user\n        logger.debug(f\"Fetching profile for user '{username}'...\")\n>       user = await db.users.find_one({\"username\": username})\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:469: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:21,959 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:21,968 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.009s\n2025-10-13 09:41:21,971 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:21,974 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/profile/concurrent_user\n2025-10-13 09:41:21,975 - routes - INFO - \ud83d\udc64 Profile request for username: concurrent_user (requester: None)\n2025-10-13 09:41:21,976 - main - ERROR - \u274c Error processing GET /api/users/profile/concurrent_user - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    user = await db.users.find_one({\"username\": username})\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.009s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/profile/concurrent_user\nINFO     routes:routes.py:465 \ud83d\udc64 Profile request for username: concurrent_user (requester: None)\nERROR    main:main.py:120 \u274c Error processing GET /api/users/profile/concurrent_user - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    user = await db.users.find_one({\"username\": username})\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n______________________________ test_cors_headers _______________________________\n\ntest_client = <starlette.testclient.TestClient object at 0x108074b60>\n\n    def test_cors_headers(test_client):\n        \"\"\"Test CORS headers are present.\"\"\"\n        response = test_client.options(\"/api/users/profile/test\")\n>       assert response.status_code == 200\nE       assert 405 == 200\nE        +  where 405 = <Response [405 Method Not Allowed]>.status_code\n\ntests/test_e2e_api.py:291: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:23,146 - main - INFO - \ud83d\udce8 Incoming OPTIONS request to /api/users/profile/test\n2025-10-13 09:41:23,149 - main - INFO - \u274c OPTIONS /api/users/profile/test - Status: 405 - Duration: 0.003s\n2025-10-13 09:41:23,152 - httpx - INFO - HTTP Request: OPTIONS http://testserver/api/users/profile/test \"HTTP/1.1 405 Method Not Allowed\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming OPTIONS request to /api/users/profile/test\nINFO     main:main.py:111 \u274c OPTIONS /api/users/profile/test - Status: 405 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: OPTIONS http://testserver/api/users/profile/test \"HTTP/1.1 405 Method Not Allowed\"\n______________ TestTokenRefresh.test_refresh_token_extends_expiry ______________\n\nself = <test_jwt_timezone.TestTokenRefresh object at 0x107bbcce0>\n\n    def test_refresh_token_extends_expiry(self):\n        \"\"\"Test refreshing token extends expiration\"\"\"\n        # Create token\n        payload = {\"sub\": \"testuser\"}\n        token1 = JWTManager.create_access_token(payload)\n        decoded1 = JWTManager.decode_token(token1)\n        exp1 = decoded1[\"exp\"]\n    \n        # Refresh token (simulate)\n        token2 = JWTManager.create_access_token(payload)\n        decoded2 = JWTManager.decode_token(token2)\n        exp2 = decoded2[\"exp\"]\n    \n        # New token should have later expiration\n>       assert exp2 > exp1\nE       assert 1760377283 > 1760377283\n\ntests/test_jwt_timezone.py:214: AssertionError\n__________________ TestSendMessage.test_send_message_success ___________________\n\nself = <test_messages.TestSendMessage object at 0x107bbf920>\ntest_users = [{'_id': ObjectId('68ed2bb307cd87bd4dd2ab0b'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb307cd87bd4dd2ab0e'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\ncleanup_messages = None\n\n    def test_send_message_success(self, test_users, cleanup_messages):\n        \"\"\"Test successfully sending a message\"\"\"\n        response = client.post(\n            \"/api/messages/send?username=user1\",\n            json={\n                \"toUsername\": \"user2\",\n                \"content\": \"Hello, how are you?\"\n            }\n        )\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:79: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:23,760 - main - INFO - \ud83d\udce8 Incoming POST request to /api/messages/send\n2025-10-13 09:41:23,763 - main - INFO - \u274c POST /api/messages/send - Status: 404 - Duration: 0.003s\n2025-10-13 09:41:23,769 - httpx - INFO - HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/messages/send\nINFO     main:main.py:111 \u274c POST /api/messages/send - Status: 404 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n___________________ TestSendMessage.test_send_empty_message ____________________\n\nself = <test_messages.TestSendMessage object at 0x107bbee10>\ntest_users = [{'_id': ObjectId('68ed2bb407cd87bd4dd2ab15'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb407cd87bd4dd2ab18'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\ncleanup_messages = None\n\n    def test_send_empty_message(self, test_users, cleanup_messages):\n        \"\"\"Test sending empty message\"\"\"\n        response = client.post(\n            \"/api/messages/send?username=user1\",\n            json={\n                \"toUsername\": \"user2\",\n                \"content\": \"\"\n            }\n        )\n    \n>       assert response.status_code == 422  # Validation error\nE       assert 404 == 422\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:111: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:24,343 - main - INFO - \ud83d\udce8 Incoming POST request to /api/messages/send\n2025-10-13 09:41:24,345 - main - INFO - \u274c POST /api/messages/send - Status: 404 - Duration: 0.001s\n2025-10-13 09:41:24,347 - httpx - INFO - HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/messages/send\nINFO     main:main.py:111 \u274c POST /api/messages/send - Status: 404 - Duration: 0.001s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n__________________ TestSendMessage.test_send_message_too_long __________________\n\nself = <test_messages.TestSendMessage object at 0x107bbebd0>\ntest_users = [{'_id': ObjectId('68ed2bb407cd87bd4dd2ab1a'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb407cd87bd4dd2ab1d'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\ncleanup_messages = None\n\n    def test_send_message_too_long(self, test_users, cleanup_messages):\n        \"\"\"Test sending message exceeding max length\"\"\"\n        long_message = \"a\" * 1001  # Max is 1000\n        response = client.post(\n            \"/api/messages/send?username=user1\",\n            json={\n                \"toUsername\": \"user2\",\n                \"content\": long_message\n            }\n        )\n    \n>       assert response.status_code == 422  # Validation error\nE       assert 404 == 422\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:124: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:24,608 - main - INFO - \ud83d\udce8 Incoming POST request to /api/messages/send\n2025-10-13 09:41:24,611 - main - INFO - \u274c POST /api/messages/send - Status: 404 - Duration: 0.003s\n2025-10-13 09:41:24,616 - httpx - INFO - HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/messages/send\nINFO     main:main.py:111 \u274c POST /api/messages/send - Status: 404 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n______________ TestSendMessage.test_send_message_trims_whitespace ______________\n\nself = <test_messages.TestSendMessage object at 0x107bbed20>\ntest_users = [{'_id': ObjectId('68ed2bb407cd87bd4dd2ab1f'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb407cd87bd4dd2ab22'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\ncleanup_messages = None\n\n    def test_send_message_trims_whitespace(self, test_users, cleanup_messages):\n        \"\"\"Test that message content is trimmed\"\"\"\n        response = client.post(\n            \"/api/messages/send?username=user1\",\n            json={\n                \"toUsername\": \"user2\",\n                \"content\": \"  Hello  \"\n            }\n        )\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:136: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:24,892 - main - INFO - \ud83d\udce8 Incoming POST request to /api/messages/send\n2025-10-13 09:41:24,893 - main - INFO - \u274c POST /api/messages/send - Status: 404 - Duration: 0.001s\n2025-10-13 09:41:24,896 - httpx - INFO - HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/messages/send\nINFO     main:main.py:111 \u274c POST /api/messages/send - Status: 404 - Duration: 0.001s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n____ TestMessagePrivacy.test_send_message_to_blocked_user_marked_invisible _____\n\nself = <test_messages.TestMessagePrivacy object at 0x107bbe990>\ntest_users = [{'_id': ObjectId('68ed2bb507cd87bd4dd2ab24'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb507cd87bd4dd2ab27'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\nblocked_users = {'_id': ObjectId('68ed2bb507cd87bd4dd2ab28'), 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 25, 310705), 'excludedUsername': 'blocked_user', 'reason': 'Test exclusion', ...}\ncleanup_messages = None\n\n    def test_send_message_to_blocked_user_marked_invisible(self, test_users, blocked_users, cleanup_messages):\n        \"\"\"Test that messages to blocked users are marked as invisible\"\"\"\n        response = client.post(\n            \"/api/messages/send?username=user1\",\n            json={\n                \"toUsername\": \"blocked_user\",\n                \"content\": \"This should be invisible\"\n            }\n        )\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:165: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:25,449 - main - INFO - \ud83d\udce8 Incoming POST request to /api/messages/send\n2025-10-13 09:41:25,451 - main - INFO - \u274c POST /api/messages/send - Status: 404 - Duration: 0.003s\n2025-10-13 09:41:25,455 - httpx - INFO - HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/messages/send\nINFO     main:main.py:111 \u274c POST /api/messages/send - Status: 404 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n___ TestMessagePrivacy.test_send_message_from_blocked_user_marked_invisible ____\n\nself = <test_messages.TestMessagePrivacy object at 0x107bbe3f0>\ntest_users = [{'_id': ObjectId('68ed2bb507cd87bd4dd2ab2a'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb507cd87bd4dd2ab2d'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\nblocked_users = {'_id': ObjectId('68ed2bb507cd87bd4dd2ab2e'), 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 25, 710618), 'excludedUsername': 'blocked_user', 'reason': 'Test exclusion', ...}\ncleanup_messages = None\n\n    def test_send_message_from_blocked_user_marked_invisible(self, test_users, blocked_users, cleanup_messages):\n        \"\"\"Test that messages from blocked users are marked as invisible\"\"\"\n        response = client.post(\n            \"/api/messages/send?username=blocked_user\",\n            json={\n                \"toUsername\": \"user1\",\n                \"content\": \"This should also be invisible\"\n            }\n        )\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:179: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:25,962 - main - INFO - \ud83d\udce8 Incoming POST request to /api/messages/send\n2025-10-13 09:41:25,964 - main - INFO - \u274c POST /api/messages/send - Status: 404 - Duration: 0.002s\n2025-10-13 09:41:25,967 - httpx - INFO - HTTP Request: POST http://testserver/api/messages/send?username=blocked_user \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/messages/send\nINFO     main:main.py:111 \u274c POST /api/messages/send - Status: 404 - Duration: 0.002s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/messages/send?username=blocked_user \"HTTP/1.1 404 Not Found\"\n______________ TestGetConversation.test_get_conversation_success _______________\n\nself = <test_messages.TestGetConversation object at 0x107bbe330>\ntest_users = [{'_id': ObjectId('68ed2bb607cd87bd4dd2ab30'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb607cd87bd4dd2ab33'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\nsample_messages = [{'_id': ObjectId('68ed2bb607cd87bd4dd2ab34'), 'content': 'Hello', 'createdAt': datetime.datetime(2025, 10, 13, 16, 36...tent': 'How are you?', 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 26, 209964), 'fromUsername': 'user1', ...}]\ncleanup_messages = None\n\n    def test_get_conversation_success(self, test_users, sample_messages, cleanup_messages):\n        \"\"\"Test successfully retrieving a conversation\"\"\"\n        response = client.get(\"/api/messages/conversation/user2?username=user1\")\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:223: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:26,365 - main - INFO - \ud83d\udce8 Incoming GET request to /api/messages/conversation/user2\n2025-10-13 09:41:26,369 - main - INFO - \u274c GET /api/messages/conversation/user2 - Status: 404 - Duration: 0.004s\n2025-10-13 09:41:26,372 - httpx - INFO - HTTP Request: GET http://testserver/api/messages/conversation/user2?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/messages/conversation/user2\nINFO     main:main.py:111 \u274c GET /api/messages/conversation/user2 - Status: 404 - Duration: 0.004s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/messages/conversation/user2?username=user1 \"HTTP/1.1 404 Not Found\"\n_______ TestGetConversation.test_get_conversation_sorted_chronologically _______\n\nself = <test_messages.TestGetConversation object at 0x107bbdee0>\ntest_users = [{'_id': ObjectId('68ed2bb607cd87bd4dd2ab38'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb607cd87bd4dd2ab3b'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\nsample_messages = [{'_id': ObjectId('68ed2bb607cd87bd4dd2ab3c'), 'content': 'Hello', 'createdAt': datetime.datetime(2025, 10, 13, 16, 36...tent': 'How are you?', 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 26, 659844), 'fromUsername': 'user1', ...}]\ncleanup_messages = None\n\n    def test_get_conversation_sorted_chronologically(self, test_users, sample_messages, cleanup_messages):\n        \"\"\"Test that messages are sorted chronologically\"\"\"\n        response = client.get(\"/api/messages/conversation/user2?username=user1\")\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:235: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:26,855 - main - INFO - \ud83d\udce8 Incoming GET request to /api/messages/conversation/user2\n2025-10-13 09:41:26,857 - main - INFO - \u274c GET /api/messages/conversation/user2 - Status: 404 - Duration: 0.003s\n2025-10-13 09:41:26,874 - httpx - INFO - HTTP Request: GET http://testserver/api/messages/conversation/user2?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/messages/conversation/user2\nINFO     main:main.py:111 \u274c GET /api/messages/conversation/user2 - Status: 404 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/messages/conversation/user2?username=user1 \"HTTP/1.1 404 Not Found\"\n_______ TestGetConversation.test_get_conversation_marks_messages_as_read _______\n\nself = <test_messages.TestGetConversation object at 0x107bbcbc0>\ntest_users = [{'_id': ObjectId('68ed2bb607cd87bd4dd2ab40'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb607cd87bd4dd2ab43'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\nsample_messages = [{'_id': ObjectId('68ed2bb707cd87bd4dd2ab44'), 'content': 'Hello', 'createdAt': datetime.datetime(2025, 10, 13, 16, 36...ntent': 'How are you?', 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 27, 58555), 'fromUsername': 'user1', ...}]\ncleanup_messages = None\n\n    def test_get_conversation_marks_messages_as_read(self, test_users, sample_messages, cleanup_messages):\n        \"\"\"Test that retrieving conversation marks messages as read\"\"\"\n        # Get conversation as user1 (recipient of message from user2)\n        response = client.get(\"/api/messages/conversation/user2?username=user1\")\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:248: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:27,195 - main - INFO - \ud83d\udce8 Incoming GET request to /api/messages/conversation/user2\n2025-10-13 09:41:27,203 - main - INFO - \u274c GET /api/messages/conversation/user2 - Status: 404 - Duration: 0.008s\n2025-10-13 09:41:27,207 - httpx - INFO - HTTP Request: GET http://testserver/api/messages/conversation/user2?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/messages/conversation/user2\nINFO     main:main.py:111 \u274c GET /api/messages/conversation/user2 - Status: 404 - Duration: 0.008s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/messages/conversation/user2?username=user1 \"HTTP/1.1 404 Not Found\"\n____ TestGetConversation.test_get_conversation_includes_other_user_profile _____\n\nself = <test_messages.TestGetConversation object at 0x107bbcf80>\ntest_users = [{'_id': ObjectId('68ed2bb707cd87bd4dd2ab48'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb707cd87bd4dd2ab4b'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\nsample_messages = [{'_id': ObjectId('68ed2bb707cd87bd4dd2ab4c'), 'content': 'Hello', 'createdAt': datetime.datetime(2025, 10, 13, 16, 36...tent': 'How are you?', 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 27, 440347), 'fromUsername': 'user1', ...}]\ncleanup_messages = None\n\n    def test_get_conversation_includes_other_user_profile(self, test_users, sample_messages, cleanup_messages):\n        \"\"\"Test that conversation includes other user's profile\"\"\"\n        response = client.get(\"/api/messages/conversation/user2?username=user1\")\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:255: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:27,548 - main - INFO - \ud83d\udce8 Incoming GET request to /api/messages/conversation/user2\n2025-10-13 09:41:27,550 - main - INFO - \u274c GET /api/messages/conversation/user2 - Status: 404 - Duration: 0.002s\n2025-10-13 09:41:27,553 - httpx - INFO - HTTP Request: GET http://testserver/api/messages/conversation/user2?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/messages/conversation/user2\nINFO     main:main.py:111 \u274c GET /api/messages/conversation/user2 - Status: 404 - Duration: 0.002s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/messages/conversation/user2?username=user1 \"HTTP/1.1 404 Not Found\"\n_______________ TestGetConversation.test_get_conversation_empty ________________\n\nself = <test_messages.TestGetConversation object at 0x107bbeab0>\ntest_users = [{'_id': ObjectId('68ed2bb707cd87bd4dd2ab50'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb707cd87bd4dd2ab53'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\ncleanup_messages = None\n\n    def test_get_conversation_empty(self, test_users, cleanup_messages):\n        \"\"\"Test getting conversation with no messages\"\"\"\n        response = client.get(\"/api/messages/conversation/user2?username=user1\")\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:267: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:27,793 - main - INFO - \ud83d\udce8 Incoming GET request to /api/messages/conversation/user2\n2025-10-13 09:41:27,798 - main - INFO - \u274c GET /api/messages/conversation/user2 - Status: 404 - Duration: 0.005s\n2025-10-13 09:41:27,807 - httpx - INFO - HTTP Request: GET http://testserver/api/messages/conversation/user2?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/messages/conversation/user2\nINFO     main:main.py:111 \u274c GET /api/messages/conversation/user2 - Status: 404 - Duration: 0.005s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/messages/conversation/user2?username=user1 \"HTTP/1.1 404 Not Found\"\n_____________ TestGetConversations.test_get_conversations_success ______________\n\nself = <test_messages.TestGetConversations object at 0x10729db50>\ntest_users = [{'_id': ObjectId('68ed2bb707cd87bd4dd2ab55'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb707cd87bd4dd2ab58'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\nmultiple_conversations = [{'_id': ObjectId('68ed2bb807cd87bd4dd2ab59'), 'content': 'Hello user2', 'createdAt': datetime.datetime(2025, 10, 13, ...tent': 'Admin message', 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 28, 41237), 'fromUsername': 'admin', ...}]\ncleanup_messages = None\n\n    def test_get_conversations_success(self, test_users, multiple_conversations, cleanup_messages):\n        \"\"\"Test successfully retrieving conversations list\"\"\"\n        response = client.get(\"/api/messages/conversations?username=user1\")\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:312: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:28,208 - main - INFO - \ud83d\udce8 Incoming GET request to /api/messages/conversations\n2025-10-13 09:41:28,210 - main - INFO - \u274c GET /api/messages/conversations - Status: 404 - Duration: 0.002s\n2025-10-13 09:41:28,221 - httpx - INFO - HTTP Request: GET http://testserver/api/messages/conversations?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/messages/conversations\nINFO     main:main.py:111 \u274c GET /api/messages/conversations - Status: 404 - Duration: 0.002s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/messages/conversations?username=user1 \"HTTP/1.1 404 Not Found\"\n_________ TestGetConversations.test_get_conversations_sorted_by_recent _________\n\nself = <test_messages.TestGetConversations object at 0x107814050>\ntest_users = [{'_id': ObjectId('68ed2bb807cd87bd4dd2ab5d'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb807cd87bd4dd2ab60'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\nmultiple_conversations = [{'_id': ObjectId('68ed2bb807cd87bd4dd2ab61'), 'content': 'Hello user2', 'createdAt': datetime.datetime(2025, 10, 13, ...ent': 'Admin message', 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 28, 421271), 'fromUsername': 'admin', ...}]\ncleanup_messages = None\n\n    def test_get_conversations_sorted_by_recent(self, test_users, multiple_conversations, cleanup_messages):\n        \"\"\"Test that conversations are sorted by most recent message\"\"\"\n        response = client.get(\"/api/messages/conversations?username=user1\")\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:321: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:28,604 - main - INFO - \ud83d\udce8 Incoming GET request to /api/messages/conversations\n2025-10-13 09:41:28,607 - main - INFO - \u274c GET /api/messages/conversations - Status: 404 - Duration: 0.003s\n2025-10-13 09:41:28,628 - httpx - INFO - HTTP Request: GET http://testserver/api/messages/conversations?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/messages/conversations\nINFO     main:main.py:111 \u274c GET /api/messages/conversations - Status: 404 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/messages/conversations?username=user1 \"HTTP/1.1 404 Not Found\"\n______ TestGetConversations.test_get_conversations_includes_unread_count _______\n\nself = <test_messages.TestGetConversations object at 0x107920320>\ntest_users = [{'_id': ObjectId('68ed2bb807cd87bd4dd2ab65'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb807cd87bd4dd2ab68'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\nmultiple_conversations = [{'_id': ObjectId('68ed2bb807cd87bd4dd2ab69'), 'content': 'Hello user2', 'createdAt': datetime.datetime(2025, 10, 13, ...ent': 'Admin message', 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 28, 942962), 'fromUsername': 'admin', ...}]\ncleanup_messages = None\n\n    def test_get_conversations_includes_unread_count(self, test_users, multiple_conversations, cleanup_messages):\n        \"\"\"Test that conversations include unread message count\"\"\"\n        response = client.get(\"/api/messages/conversations?username=user1\")\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:332: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:29,093 - main - INFO - \ud83d\udce8 Incoming GET request to /api/messages/conversations\n2025-10-13 09:41:29,094 - main - INFO - \u274c GET /api/messages/conversations - Status: 404 - Duration: 0.001s\n2025-10-13 09:41:29,101 - httpx - INFO - HTTP Request: GET http://testserver/api/messages/conversations?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/messages/conversations\nINFO     main:main.py:111 \u274c GET /api/messages/conversations - Status: 404 - Duration: 0.001s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/messages/conversations?username=user1 \"HTTP/1.1 404 Not Found\"\n______ TestGetConversations.test_get_conversations_includes_last_message _______\n\nself = <test_messages.TestGetConversations object at 0x107bdb350>\ntest_users = [{'_id': ObjectId('68ed2bb907cd87bd4dd2ab6d'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb907cd87bd4dd2ab70'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\nmultiple_conversations = [{'_id': ObjectId('68ed2bb907cd87bd4dd2ab71'), 'content': 'Hello user2', 'createdAt': datetime.datetime(2025, 10, 13, ...ent': 'Admin message', 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 29, 293721), 'fromUsername': 'admin', ...}]\ncleanup_messages = None\n\n    def test_get_conversations_includes_last_message(self, test_users, multiple_conversations, cleanup_messages):\n        \"\"\"Test that conversations include last message preview\"\"\"\n        response = client.get(\"/api/messages/conversations?username=user1\")\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:343: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:29,442 - main - INFO - \ud83d\udce8 Incoming GET request to /api/messages/conversations\n2025-10-13 09:41:29,443 - main - INFO - \u274c GET /api/messages/conversations - Status: 404 - Duration: 0.001s\n2025-10-13 09:41:29,445 - httpx - INFO - HTTP Request: GET http://testserver/api/messages/conversations?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/messages/conversations\nINFO     main:main.py:111 \u274c GET /api/messages/conversations - Status: 404 - Duration: 0.001s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/messages/conversations?username=user1 \"HTTP/1.1 404 Not Found\"\n______________ TestGetConversations.test_get_conversations_empty _______________\n\nself = <test_messages.TestGetConversations object at 0x107bdb440>\ntest_users = [{'_id': ObjectId('68ed2bb907cd87bd4dd2ab75'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb907cd87bd4dd2ab78'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\ncleanup_messages = None\n\n    def test_get_conversations_empty(self, test_users, cleanup_messages):\n        \"\"\"Test getting conversations when none exist\"\"\"\n        response = client.get(\"/api/messages/conversations?username=user1\")\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:355: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:29,594 - main - INFO - \ud83d\udce8 Incoming GET request to /api/messages/conversations\n2025-10-13 09:41:29,600 - main - INFO - \u274c GET /api/messages/conversations - Status: 404 - Duration: 0.006s\n2025-10-13 09:41:29,605 - httpx - INFO - HTTP Request: GET http://testserver/api/messages/conversations?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/messages/conversations\nINFO     main:main.py:111 \u274c GET /api/messages/conversations - Status: 404 - Duration: 0.006s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/messages/conversations?username=user1 \"HTTP/1.1 404 Not Found\"\n____________ TestAdminOverride.test_admin_can_see_blocked_messages _____________\n\nself = <test_messages.TestAdminOverride object at 0x107bdbaa0>\ntest_users = [{'_id': ObjectId('68ed2bb907cd87bd4dd2ab7a'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bb907cd87bd4dd2ab7d'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\nblocked_messages = {'_id': ObjectId('68ed2bba07cd87bd4dd2ab7f'), 'content': 'Blocked message', 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 30, 149812), 'fromUsername': 'user1', ...}\ncleanup_messages = None\n\n    def test_admin_can_see_blocked_messages(self, test_users, blocked_messages, cleanup_messages):\n        \"\"\"Test that admin can see messages marked as invisible\"\"\"\n        response = client.get(\"/api/messages/conversation/user2?username=admin\")\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:390: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:30,265 - main - INFO - \ud83d\udce8 Incoming GET request to /api/messages/conversation/user2\n2025-10-13 09:41:30,268 - main - INFO - \u274c GET /api/messages/conversation/user2 - Status: 404 - Duration: 0.002s\n2025-10-13 09:41:30,270 - httpx - INFO - HTTP Request: GET http://testserver/api/messages/conversation/user2?username=admin \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/messages/conversation/user2\nINFO     main:main.py:111 \u274c GET /api/messages/conversation/user2 - Status: 404 - Duration: 0.002s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/messages/conversation/user2?username=admin \"HTTP/1.1 404 Not Found\"\n_______ TestAdminOverride.test_regular_user_cannot_see_blocked_messages ________\n\nself = <test_messages.TestAdminOverride object at 0x107bdb710>\ntest_users = [{'_id': ObjectId('68ed2bba07cd87bd4dd2ab81'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bba07cd87bd4dd2ab84'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\nblocked_messages = {'_id': ObjectId('68ed2bba07cd87bd4dd2ab86'), 'content': 'Blocked message', 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 30, 640302), 'fromUsername': 'user1', ...}\ncleanup_messages = None\n\n    def test_regular_user_cannot_see_blocked_messages(self, test_users, blocked_messages, cleanup_messages):\n        \"\"\"Test that regular users cannot see blocked messages\"\"\"\n        response = client.get(\"/api/messages/conversation/user2?username=user1\")\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:398: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:30,746 - main - INFO - \ud83d\udce8 Incoming GET request to /api/messages/conversation/user2\n2025-10-13 09:41:30,753 - main - INFO - \u274c GET /api/messages/conversation/user2 - Status: 404 - Duration: 0.006s\n2025-10-13 09:41:30,755 - httpx - INFO - HTTP Request: GET http://testserver/api/messages/conversation/user2?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/messages/conversation/user2\nINFO     main:main.py:111 \u274c GET /api/messages/conversation/user2 - Status: 404 - Duration: 0.006s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/messages/conversation/user2?username=user1 \"HTTP/1.1 404 Not Found\"\n___________ TestMessageEdgeCases.test_send_message_missing_username ____________\n\nself = <test_messages.TestMessageEdgeCases object at 0x1072d4d40>\ntest_users = [{'_id': ObjectId('68ed2bba07cd87bd4dd2ab88'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bba07cd87bd4dd2ab8b'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\ncleanup_messages = None\n\n    def test_send_message_missing_username(self, test_users, cleanup_messages):\n        \"\"\"Test sending message without username parameter\"\"\"\n        response = client.post(\n            \"/api/messages/send\",\n            json={\n                \"toUsername\": \"user2\",\n                \"content\": \"Hello\"\n            }\n        )\n    \n>       assert response.status_code == 422  # Missing required parameter\nE       assert 404 == 422\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:417: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:31,198 - main - INFO - \ud83d\udce8 Incoming POST request to /api/messages/send\n2025-10-13 09:41:31,201 - main - INFO - \u274c POST /api/messages/send - Status: 404 - Duration: 0.002s\n2025-10-13 09:41:31,204 - httpx - INFO - HTTP Request: POST http://testserver/api/messages/send \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/messages/send\nINFO     main:main.py:111 \u274c POST /api/messages/send - Status: 404 - Duration: 0.002s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/messages/send \"HTTP/1.1 404 Not Found\"\n__________ TestMessageEdgeCases.test_send_message_special_characters ___________\n\nself = <test_messages.TestMessageEdgeCases object at 0x1072d51f0>\ntest_users = [{'_id': ObjectId('68ed2bbb07cd87bd4dd2ab8d'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bbb07cd87bd4dd2ab90'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\ncleanup_messages = None\n\n    def test_send_message_special_characters(self, test_users, cleanup_messages):\n        \"\"\"Test sending message with special characters\"\"\"\n        response = client.post(\n            \"/api/messages/send?username=user1\",\n            json={\n                \"toUsername\": \"user2\",\n                \"content\": \"Hello! \ud83d\ude0a <script>alert('xss')</script>\"\n            }\n        )\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:429: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:31,414 - main - INFO - \ud83d\udce8 Incoming POST request to /api/messages/send\n2025-10-13 09:41:31,417 - main - INFO - \u274c POST /api/messages/send - Status: 404 - Duration: 0.003s\n2025-10-13 09:41:31,421 - httpx - INFO - HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/messages/send\nINFO     main:main.py:111 \u274c POST /api/messages/send - Status: 404 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n____________ TestMessageIntegration.test_full_conversation_workflow ____________\n\nself = <test_messages.TestMessageIntegration object at 0x1072d7e90>\ntest_users = [{'_id': ObjectId('68ed2bbb07cd87bd4dd2ab9c'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bbb07cd87bd4dd2ab9f'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\ncleanup_messages = None\n\n    def test_full_conversation_workflow(self, test_users, cleanup_messages):\n        \"\"\"Test complete workflow: send messages, retrieve conversation\"\"\"\n        # Send message from user1 to user2\n        send_response1 = client.post(\n            \"/api/messages/send?username=user1\",\n            json={\"toUsername\": \"user2\", \"content\": \"Hello\"}\n        )\n>       assert send_response1.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:455: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:32,142 - main - INFO - \ud83d\udce8 Incoming POST request to /api/messages/send\n2025-10-13 09:41:32,143 - main - INFO - \u274c POST /api/messages/send - Status: 404 - Duration: 0.001s\n2025-10-13 09:41:32,146 - httpx - INFO - HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/messages/send\nINFO     main:main.py:111 \u274c POST /api/messages/send - Status: 404 - Duration: 0.001s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n____________ TestMessageIntegration.test_block_user_hides_messages _____________\n\nself = <test_messages.TestMessageIntegration object at 0x1072d5520>\ntest_users = [{'_id': ObjectId('68ed2bbc07cd87bd4dd2aba1'), 'contactEmail': 'user1@test.com', 'firstName': 'User', 'lastName': 'One...ctId('68ed2bbc07cd87bd4dd2aba4'), 'contactEmail': 'blocked@test.com', 'firstName': 'Blocked', 'lastName': 'User', ...}]\ncleanup_messages = None\n\n    def test_block_user_hides_messages(self, test_users, cleanup_messages):\n        \"\"\"Test that blocking a user hides existing messages\"\"\"\n        # Send messages\n        client.post(\n            \"/api/messages/send?username=user1\",\n            json={\"toUsername\": \"user2\", \"content\": \"Before block\"}\n        )\n    \n        # Block user2\n        # (Would need to call exclusion endpoint)\n    \n        # Send message after block\n        response = client.post(\n            \"/api/messages/send?username=user1\",\n            json={\"toUsername\": \"user2\", \"content\": \"After block\"}\n        )\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_messages.py:491: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:32,369 - main - INFO - \ud83d\udce8 Incoming POST request to /api/messages/send\n2025-10-13 09:41:32,371 - main - INFO - \u274c POST /api/messages/send - Status: 404 - Duration: 0.002s\n2025-10-13 09:41:32,376 - httpx - INFO - HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n2025-10-13 09:41:32,388 - main - INFO - \ud83d\udce8 Incoming POST request to /api/messages/send\n2025-10-13 09:41:32,391 - main - INFO - \u274c POST /api/messages/send - Status: 404 - Duration: 0.004s\n2025-10-13 09:41:32,404 - httpx - INFO - HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/messages/send\nINFO     main:main.py:111 \u274c POST /api/messages/send - Status: 404 - Duration: 0.002s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/messages/send\nINFO     main:main.py:111 \u274c POST /api/messages/send - Status: 404 - Duration: 0.004s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/messages/send?username=user1 \"HTTP/1.1 404 Not Found\"\n__________________ TestUserBase.test_valid_user_base_creation __________________\n\nself = <test_models.TestUserBase object at 0x107e600b0>\n\n    def test_valid_user_base_creation(self):\n        \"\"\"Test creating a valid UserBase instance.\"\"\"\n        user_data = {\n            \"username\": \"testuser\",\n            \"firstName\": \"Test\",\n            \"lastName\": \"User\",\n            \"contactEmail\": \"test@example.com\",\n            \"sex\": \"Male\",\n            \"eatingPreference\": \"Vegetarian\",\n            \"citizenshipStatus\": \"Citizen\"\n        }\n>       user = UserBase(**user_data)\nE       pydantic_core._pydantic_core.ValidationError: 1 validation error for UserBase\nE       state\nE         Field required [type=missing, input_value={'username': 'testuser', ...nshipStatus': 'Citizen'}, input_type=dict]\nE           For further information visit https://errors.pydantic.dev/2.5/v/missing\n\ntests/test_models.py:33: ValidationError\n_______________________ TestUserBase.test_sex_validation _______________________\n\nself = <test_models.TestUserBase object at 0x107e604a0>\n\n    def test_sex_validation(self):\n        \"\"\"Test sex field validation.\"\"\"\n        # Valid values\n>       assert UserBase(username=\"testuser\", sex=\"Male\").sex == \"Male\"\nE       pydantic_core._pydantic_core.ValidationError: 1 validation error for UserBase\nE       state\nE         Field required [type=missing, input_value={'username': 'testuser', 'sex': 'Male'}, input_type=dict]\nE           For further information visit https://errors.pydantic.dev/2.5/v/missing\n\ntests/test_models.py:55: ValidationError\n________________ TestUserBase.test_eating_preference_validation ________________\n\nself = <test_models.TestUserBase object at 0x107e605f0>\n\n    def test_eating_preference_validation(self):\n        \"\"\"Test eating preference validation.\"\"\"\n        valid_preferences = [\"Vegetarian\", \"Eggetarian\", \"Non-Veg\", \"Others\", \"\"]\n    \n        for pref in valid_preferences:\n>           user = UserBase(username=\"testuser\", eatingPreference=pref)\nE           pydantic_core._pydantic_core.ValidationError: 1 validation error for UserBase\nE           state\nE             Field required [type=missing, input_value={'username': 'testuser', ...eference': 'Vegetarian'}, input_type=dict]\nE               For further information visit https://errors.pydantic.dev/2.5/v/missing\n\ntests/test_models.py:68: ValidationError\n_______________ TestUserBase.test_citizenship_status_validation ________________\n\nself = <test_models.TestUserBase object at 0x107e60740>\n\n    def test_citizenship_status_validation(self):\n        \"\"\"Test citizenship status validation.\"\"\"\n        valid_statuses = [\"Citizen\", \"Greencard\", \"\"]\n    \n        for status in valid_statuses:\n>           user = UserBase(username=\"testuser\", citizenshipStatus=status)\nE           pydantic_core._pydantic_core.ValidationError: 1 validation error for UserBase\nE           state\nE             Field required [type=missing, input_value={'username': 'testuser', ...nshipStatus': 'Citizen'}, input_type=dict]\nE               For further information visit https://errors.pydantic.dev/2.5/v/missing\n\ntests/test_models.py:80: ValidationError\n____________________ TestUserCreate.test_valid_user_create _____________________\n\nself = <test_models.TestUserCreate object at 0x107e60a10>\n\n    def test_valid_user_create(self):\n        \"\"\"Test creating a valid UserCreate instance.\"\"\"\n        user_data = {\n            \"username\": \"testuser\",\n            \"password\": \"testpass123\",\n            \"firstName\": \"Test\",\n            \"contactEmail\": \"test@example.com\"\n        }\n>       user = UserCreate(**user_data)\nE       pydantic_core._pydantic_core.ValidationError: 1 validation error for UserCreate\nE       state\nE         Field required [type=missing, input_value={'username': 'testuser', ...il': 'test@example.com'}, input_type=dict]\nE           For further information visit https://errors.pydantic.dev/2.5/v/missing\n\ntests/test_models.py:99: ValidationError\n______________________ TestUserInDB.test_valid_user_in_db ______________________\n\nself = <test_models.TestUserInDB object at 0x107e60d40>\n\n    def test_valid_user_in_db(self):\n        \"\"\"Test creating a valid UserInDB instance.\"\"\"\n        user_data = {\n            \"username\": \"testuser\",\n            \"password\": \"hashedpassword\",\n            \"firstName\": \"Test\",\n            \"contactEmail\": \"test@example.com\"\n        }\n>       user = UserInDB(**user_data)\nE       pydantic_core._pydantic_core.ValidationError: 1 validation error for UserInDB\nE       state\nE         Field required [type=missing, input_value={'username': 'testuser', ...il': 'test@example.com'}, input_type=dict]\nE           For further information visit https://errors.pydantic.dev/2.5/v/missing\n\ntests/test_models.py:120: ValidationError\n__________________ TestUserResponse.test_valid_user_response ___________________\n\nself = <test_models.TestUserResponse object at 0x107e60470>\n\n    def test_valid_user_response(self):\n        \"\"\"Test creating a valid UserResponse instance.\"\"\"\n        user_data = {\n            \"username\": \"testuser\",\n            \"firstName\": \"Test\",\n            \"createdAt\": datetime.utcnow(),\n            \"updatedAt\": datetime.utcnow()\n        }\n>       user = UserResponse(**user_data)\nE       pydantic_core._pydantic_core.ValidationError: 1 validation error for UserResponse\nE       state\nE         Field required [type=missing, input_value={'username': 'testuser', ...13, 16, 41, 32, 589143)}, input_type=dict]\nE           For further information visit https://errors.pydantic.dev/2.5/v/missing\n\ntests/test_models.py:138: ValidationError\n___________ TestProfileViewTracking.test_track_profile_view_success ____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py\", line 62, in test_track_profile_view_success\n    |     response = client.post(\n    |                ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    |     profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | TypeError: object MagicMock can't be used in 'await' expression\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_profile_views.TestProfileViewTracking object at 0x107e2ef90>\ntest_users = [{'_id': ObjectId('68ed2bbc07cd87bd4dd2aba8'), 'contactEmail': 'viewer1@test.com', 'firstName': 'John', 'lastName': 'V...ectId('68ed2bbc07cd87bd4dd2abaa'), 'contactEmail': 'owner@test.com', 'firstName': 'Profile', 'lastName': 'Owner', ...}]\ncleanup_profile_views = None\n\n    def test_track_profile_view_success(self, test_users, cleanup_profile_views):\n        \"\"\"Test successfully tracking a profile view\"\"\"\n>       response = client.post(\n            \"/api/users/profile-views\",\n            json={\n                \"profileUsername\": \"profile_owner\",\n                \"viewedByUsername\": \"viewer1\"\n            }\n        )\n\ntests/test_profile_views.py:62: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nprofile_view = ProfileViewCreate(profileUsername='profile_owner', viewedByUsername='viewer1')\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.post(\"/profile-views\")\n    async def track_profile_view(\n        profile_view: ProfileViewCreate,\n        db = Depends(get_database)\n    ):\n        \"\"\"Track when a user views another user's profile\"\"\"\n        logger.info(f\"\ud83d\udc41\ufe0f Profile view: {profile_view.viewedByUsername} viewed {profile_view.profileUsername}\")\n    \n        # Don't track if user views their own profile\n        if profile_view.profileUsername == profile_view.viewedByUsername:\n            return {\"message\": \"Self-view not tracked\"}\n    \n        # Check if both users exist\n>       profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\nE       TypeError: object MagicMock can't be used in 'await' expression\n\nroutes.py:2569: TypeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:32,993 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/profile-views\n2025-10-13 09:41:32,995 - routes - INFO - \ud83d\udc41\ufe0f Profile view: viewer1 viewed profile_owner\n2025-10-13 09:41:32,998 - main - ERROR - \u274c Error processing POST /api/users/profile-views - Duration: 0.006s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/profile-views\nINFO     routes:routes.py:2562 \ud83d\udc41\ufe0f Profile view: viewer1 viewed profile_owner\nERROR    main:main.py:120 \u274c Error processing POST /api/users/profile-views - Duration: 0.006s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n_________ TestProfileViewTracking.test_track_view_nonexistent_profile __________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py\", line 91, in test_track_view_nonexistent_profile\n    |     response = client.post(\n    |                ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    |     profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | TypeError: object MagicMock can't be used in 'await' expression\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_profile_views.TestProfileViewTracking object at 0x107e2ee10>\ntest_users = [{'_id': ObjectId('68ed2bbe07cd87bd4dd2abb0'), 'contactEmail': 'viewer1@test.com', 'firstName': 'John', 'lastName': 'V...ectId('68ed2bbe07cd87bd4dd2abb2'), 'contactEmail': 'owner@test.com', 'firstName': 'Profile', 'lastName': 'Owner', ...}]\ncleanup_profile_views = None\n\n    def test_track_view_nonexistent_profile(self, test_users, cleanup_profile_views):\n        \"\"\"Test tracking view for non-existent profile\"\"\"\n>       response = client.post(\n            \"/api/users/profile-views\",\n            json={\n                \"profileUsername\": \"nonexistent\",\n                \"viewedByUsername\": \"viewer1\"\n            }\n        )\n\ntests/test_profile_views.py:91: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nprofile_view = ProfileViewCreate(profileUsername='nonexistent', viewedByUsername='viewer1')\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.post(\"/profile-views\")\n    async def track_profile_view(\n        profile_view: ProfileViewCreate,\n        db = Depends(get_database)\n    ):\n        \"\"\"Track when a user views another user's profile\"\"\"\n        logger.info(f\"\ud83d\udc41\ufe0f Profile view: {profile_view.viewedByUsername} viewed {profile_view.profileUsername}\")\n    \n        # Don't track if user views their own profile\n        if profile_view.profileUsername == profile_view.viewedByUsername:\n            return {\"message\": \"Self-view not tracked\"}\n    \n        # Check if both users exist\n>       profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\nE       TypeError: object MagicMock can't be used in 'await' expression\n\nroutes.py:2569: TypeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:34,394 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/profile-views\n2025-10-13 09:41:34,397 - routes - INFO - \ud83d\udc41\ufe0f Profile view: viewer1 viewed nonexistent\n2025-10-13 09:41:34,398 - main - ERROR - \u274c Error processing POST /api/users/profile-views - Duration: 0.004s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/profile-views\nINFO     routes:routes.py:2562 \ud83d\udc41\ufe0f Profile view: viewer1 viewed nonexistent\nERROR    main:main.py:120 \u274c Error processing POST /api/users/profile-views - Duration: 0.004s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n__________ TestProfileViewTracking.test_track_view_nonexistent_viewer __________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py\", line 104, in test_track_view_nonexistent_viewer\n    |     response = client.post(\n    |                ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    |     profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | TypeError: object MagicMock can't be used in 'await' expression\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_profile_views.TestProfileViewTracking object at 0x107e2ea50>\ntest_users = [{'_id': ObjectId('68ed2bbf07cd87bd4dd2abb4'), 'contactEmail': 'viewer1@test.com', 'firstName': 'John', 'lastName': 'V...ectId('68ed2bbf07cd87bd4dd2abb6'), 'contactEmail': 'owner@test.com', 'firstName': 'Profile', 'lastName': 'Owner', ...}]\ncleanup_profile_views = None\n\n    def test_track_view_nonexistent_viewer(self, test_users, cleanup_profile_views):\n        \"\"\"Test tracking view by non-existent viewer\"\"\"\n>       response = client.post(\n            \"/api/users/profile-views\",\n            json={\n                \"profileUsername\": \"profile_owner\",\n                \"viewedByUsername\": \"nonexistent\"\n            }\n        )\n\ntests/test_profile_views.py:104: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nprofile_view = ProfileViewCreate(profileUsername='profile_owner', viewedByUsername='nonexistent')\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.post(\"/profile-views\")\n    async def track_profile_view(\n        profile_view: ProfileViewCreate,\n        db = Depends(get_database)\n    ):\n        \"\"\"Track when a user views another user's profile\"\"\"\n        logger.info(f\"\ud83d\udc41\ufe0f Profile view: {profile_view.viewedByUsername} viewed {profile_view.profileUsername}\")\n    \n        # Don't track if user views their own profile\n        if profile_view.profileUsername == profile_view.viewedByUsername:\n            return {\"message\": \"Self-view not tracked\"}\n    \n        # Check if both users exist\n>       profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\nE       TypeError: object MagicMock can't be used in 'await' expression\n\nroutes.py:2569: TypeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:35,824 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/profile-views\n2025-10-13 09:41:35,826 - routes - INFO - \ud83d\udc41\ufe0f Profile view: nonexistent viewed profile_owner\n2025-10-13 09:41:35,827 - main - ERROR - \u274c Error processing POST /api/users/profile-views - Duration: 0.003s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/profile-views\nINFO     routes:routes.py:2562 \ud83d\udc41\ufe0f Profile view: nonexistent viewed profile_owner\nERROR    main:main.py:120 \u274c Error processing POST /api/users/profile-views - Duration: 0.003s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n___ TestProfileViewTracking.test_duplicate_view_within_24h_updates_timestamp ___\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py\", line 118, in test_duplicate_view_within_24h_updates_timestamp\n    |     response1 = client.post(\n    |                 ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    |     profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | TypeError: object MagicMock can't be used in 'await' expression\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_profile_views.TestProfileViewTracking object at 0x107e2dfa0>\ntest_users = [{'_id': ObjectId('68ed2bc007cd87bd4dd2abb8'), 'contactEmail': 'viewer1@test.com', 'firstName': 'John', 'lastName': 'V...ectId('68ed2bc007cd87bd4dd2abba'), 'contactEmail': 'owner@test.com', 'firstName': 'Profile', 'lastName': 'Owner', ...}]\ncleanup_profile_views = None\n\n    def test_duplicate_view_within_24h_updates_timestamp(self, test_users, cleanup_profile_views):\n        \"\"\"Test that duplicate views within 24h update timestamp instead of creating new record\"\"\"\n        # First view\n>       response1 = client.post(\n            \"/api/users/profile-views\",\n            json={\n                \"profileUsername\": \"profile_owner\",\n                \"viewedByUsername\": \"viewer1\"\n            }\n        )\n\ntests/test_profile_views.py:118: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nprofile_view = ProfileViewCreate(profileUsername='profile_owner', viewedByUsername='viewer1')\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.post(\"/profile-views\")\n    async def track_profile_view(\n        profile_view: ProfileViewCreate,\n        db = Depends(get_database)\n    ):\n        \"\"\"Track when a user views another user's profile\"\"\"\n        logger.info(f\"\ud83d\udc41\ufe0f Profile view: {profile_view.viewedByUsername} viewed {profile_view.profileUsername}\")\n    \n        # Don't track if user views their own profile\n        if profile_view.profileUsername == profile_view.viewedByUsername:\n            return {\"message\": \"Self-view not tracked\"}\n    \n        # Check if both users exist\n>       profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\nE       TypeError: object MagicMock can't be used in 'await' expression\n\nroutes.py:2569: TypeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:37,095 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/profile-views\n2025-10-13 09:41:37,105 - routes - INFO - \ud83d\udc41\ufe0f Profile view: viewer1 viewed profile_owner\n2025-10-13 09:41:37,105 - main - ERROR - \u274c Error processing POST /api/users/profile-views - Duration: 0.010s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/profile-views\nINFO     routes:routes.py:2562 \ud83d\udc41\ufe0f Profile view: viewer1 viewed profile_owner\nERROR    main:main.py:120 \u274c Error processing POST /api/users/profile-views - Duration: 0.010s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n_______ TestProfileViewTracking.test_multiple_viewers_tracked_separately _______\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py\", line 142, in test_multiple_viewers_tracked_separately\n    |     response1 = client.post(\n    |                 ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    |     profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | TypeError: object MagicMock can't be used in 'await' expression\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_profile_views.TestProfileViewTracking object at 0x107e2ec90>\ntest_users = [{'_id': ObjectId('68ed2bc207cd87bd4dd2abbc'), 'contactEmail': 'viewer1@test.com', 'firstName': 'John', 'lastName': 'V...ectId('68ed2bc207cd87bd4dd2abbe'), 'contactEmail': 'owner@test.com', 'firstName': 'Profile', 'lastName': 'Owner', ...}]\ncleanup_profile_views = None\n\n    def test_multiple_viewers_tracked_separately(self, test_users, cleanup_profile_views):\n        \"\"\"Test that multiple viewers are tracked separately\"\"\"\n        # Viewer 1\n>       response1 = client.post(\n            \"/api/users/profile-views\",\n            json={\n                \"profileUsername\": \"profile_owner\",\n                \"viewedByUsername\": \"viewer1\"\n            }\n        )\n\ntests/test_profile_views.py:142: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nprofile_view = ProfileViewCreate(profileUsername='profile_owner', viewedByUsername='viewer1')\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.post(\"/profile-views\")\n    async def track_profile_view(\n        profile_view: ProfileViewCreate,\n        db = Depends(get_database)\n    ):\n        \"\"\"Track when a user views another user's profile\"\"\"\n        logger.info(f\"\ud83d\udc41\ufe0f Profile view: {profile_view.viewedByUsername} viewed {profile_view.profileUsername}\")\n    \n        # Don't track if user views their own profile\n        if profile_view.profileUsername == profile_view.viewedByUsername:\n            return {\"message\": \"Self-view not tracked\"}\n    \n        # Check if both users exist\n>       profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\nE       TypeError: object MagicMock can't be used in 'await' expression\n\nroutes.py:2569: TypeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:38,442 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/profile-views\n2025-10-13 09:41:38,444 - routes - INFO - \ud83d\udc41\ufe0f Profile view: viewer1 viewed profile_owner\n2025-10-13 09:41:38,445 - main - ERROR - \u274c Error processing POST /api/users/profile-views - Duration: 0.003s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/profile-views\nINFO     routes:routes.py:2562 \ud83d\udc41\ufe0f Profile view: viewer1 viewed profile_owner\nERROR    main:main.py:120 \u274c Error processing POST /api/users/profile-views - Duration: 0.003s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n______________ TestGetProfileViews.test_get_profile_views_success ______________\n\nself = <test_profile_views.TestGetProfileViews object at 0x107de0fb0>\ntest_users = [{'_id': ObjectId('68ed2bc307cd87bd4dd2abc0'), 'contactEmail': 'viewer1@test.com', 'firstName': 'John', 'lastName': 'V...ectId('68ed2bc307cd87bd4dd2abc2'), 'contactEmail': 'owner@test.com', 'firstName': 'Profile', 'lastName': 'Owner', ...}]\nsample_views = [{'_id': ObjectId('68ed2bc307cd87bd4dd2abc3'), 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 39, 600014), 'prof...39, 600039), 'profileUsername': 'profile_owner', 'viewedAt': datetime.datetime(2025, 10, 13, 14, 41, 39, 600023), ...}]\ncleanup_profile_views = None\n\n    def test_get_profile_views_success(self, test_users, sample_views, cleanup_profile_views):\n        \"\"\"Test successfully retrieving profile views\"\"\"\n        response = client.get(\"/api/users/profile-views/profile_owner\")\n    \n>       assert response.status_code == 200\nE       assert 500 == 200\nE        +  where 500 = <Response [500 Internal Server Error]>.status_code\n\ntests/test_profile_views.py:192: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:39,742 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/profile-views/profile_owner\n2025-10-13 09:41:39,744 - routes - INFO - \ud83d\udcca Getting profile views for profile_owner\n2025-10-13 09:41:39,746 - routes - ERROR - \u274c Error fetching profile views: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2634, in get_profile_views\n    all_views = await db.profile_views.find({\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:41:39,747 - main - INFO - \u274c GET /api/users/profile-views/profile_owner - Status: 500 - Duration: 0.005s\n2025-10-13 09:41:39,752 - httpx - INFO - HTTP Request: GET http://testserver/api/users/profile-views/profile_owner \"HTTP/1.1 500 Internal Server Error\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/profile-views/profile_owner\nINFO     routes:routes.py:2630 \ud83d\udcca Getting profile views for profile_owner\nERROR    routes:routes.py:2726 \u274c Error fetching profile views: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2634, in get_profile_views\n    all_views = await db.profile_views.find({\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nINFO     main:main.py:111 \u274c GET /api/users/profile-views/profile_owner - Status: 500 - Duration: 0.005s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/users/profile-views/profile_owner \"HTTP/1.1 500 Internal Server Error\"\n______ TestGetProfileViews.test_get_profile_views_includes_viewer_details ______\n\nself = <test_profile_views.TestGetProfileViews object at 0x107de01a0>\ntest_users = [{'_id': ObjectId('68ed2bc307cd87bd4dd2abc6'), 'contactEmail': 'viewer1@test.com', 'firstName': 'John', 'lastName': 'V...ectId('68ed2bc307cd87bd4dd2abc8'), 'contactEmail': 'owner@test.com', 'firstName': 'Profile', 'lastName': 'Owner', ...}]\nsample_views = [{'_id': ObjectId('68ed2bc307cd87bd4dd2abc9'), 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 39, 960133), 'prof...39, 960156), 'profileUsername': 'profile_owner', 'viewedAt': datetime.datetime(2025, 10, 13, 14, 41, 39, 960140), ...}]\ncleanup_profile_views = None\n\n    def test_get_profile_views_includes_viewer_details(self, test_users, sample_views, cleanup_profile_views):\n        \"\"\"Test that profile views include viewer profile details\"\"\"\n        response = client.get(\"/api/users/profile-views/profile_owner\")\n    \n>       assert response.status_code == 200\nE       assert 500 == 200\nE        +  where 500 = <Response [500 Internal Server Error]>.status_code\n\ntests/test_profile_views.py:204: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:40,078 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/profile-views/profile_owner\n2025-10-13 09:41:40,081 - routes - INFO - \ud83d\udcca Getting profile views for profile_owner\n2025-10-13 09:41:40,084 - routes - ERROR - \u274c Error fetching profile views: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2634, in get_profile_views\n    all_views = await db.profile_views.find({\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:41:40,087 - main - INFO - \u274c GET /api/users/profile-views/profile_owner - Status: 500 - Duration: 0.008s\n2025-10-13 09:41:40,107 - httpx - INFO - HTTP Request: GET http://testserver/api/users/profile-views/profile_owner \"HTTP/1.1 500 Internal Server Error\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/profile-views/profile_owner\nINFO     routes:routes.py:2630 \ud83d\udcca Getting profile views for profile_owner\nERROR    routes:routes.py:2726 \u274c Error fetching profile views: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2634, in get_profile_views\n    all_views = await db.profile_views.find({\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nINFO     main:main.py:111 \u274c GET /api/users/profile-views/profile_owner - Status: 500 - Duration: 0.008s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/users/profile-views/profile_owner \"HTTP/1.1 500 Internal Server Error\"\n_________ TestGetProfileViews.test_get_profile_views_sorted_by_recent __________\n\nself = <test_profile_views.TestGetProfileViews object at 0x107de0650>\ntest_users = [{'_id': ObjectId('68ed2bc407cd87bd4dd2abcc'), 'contactEmail': 'viewer1@test.com', 'firstName': 'John', 'lastName': 'V...ectId('68ed2bc407cd87bd4dd2abce'), 'contactEmail': 'owner@test.com', 'firstName': 'Profile', 'lastName': 'Owner', ...}]\nsample_views = [{'_id': ObjectId('68ed2bc407cd87bd4dd2abcf'), 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 40, 360388), 'prof...40, 360402), 'profileUsername': 'profile_owner', 'viewedAt': datetime.datetime(2025, 10, 13, 14, 41, 40, 360392), ...}]\ncleanup_profile_views = None\n\n    def test_get_profile_views_sorted_by_recent(self, test_users, sample_views, cleanup_profile_views):\n        \"\"\"Test that profile views are sorted by most recent first\"\"\"\n        response = client.get(\"/api/users/profile-views/profile_owner\")\n    \n>       assert response.status_code == 200\nE       assert 500 == 200\nE        +  where 500 = <Response [500 Internal Server Error]>.status_code\n\ntests/test_profile_views.py:218: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:40,492 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/profile-views/profile_owner\n2025-10-13 09:41:40,494 - routes - INFO - \ud83d\udcca Getting profile views for profile_owner\n2025-10-13 09:41:40,495 - routes - ERROR - \u274c Error fetching profile views: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2634, in get_profile_views\n    all_views = await db.profile_views.find({\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:41:40,496 - main - INFO - \u274c GET /api/users/profile-views/profile_owner - Status: 500 - Duration: 0.003s\n2025-10-13 09:41:40,505 - httpx - INFO - HTTP Request: GET http://testserver/api/users/profile-views/profile_owner \"HTTP/1.1 500 Internal Server Error\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/profile-views/profile_owner\nINFO     routes:routes.py:2630 \ud83d\udcca Getting profile views for profile_owner\nERROR    routes:routes.py:2726 \u274c Error fetching profile views: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2634, in get_profile_views\n    all_views = await db.profile_views.find({\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nINFO     main:main.py:111 \u274c GET /api/users/profile-views/profile_owner - Status: 500 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/users/profile-views/profile_owner \"HTTP/1.1 500 Internal Server Error\"\n____________ TestGetProfileViews.test_get_profile_views_with_limit _____________\n\nself = <test_profile_views.TestGetProfileViews object at 0x107de0dd0>\ntest_users = [{'_id': ObjectId('68ed2bc407cd87bd4dd2abd2'), 'contactEmail': 'viewer1@test.com', 'firstName': 'John', 'lastName': 'V...ectId('68ed2bc407cd87bd4dd2abd4'), 'contactEmail': 'owner@test.com', 'firstName': 'Profile', 'lastName': 'Owner', ...}]\nsample_views = [{'_id': ObjectId('68ed2bc407cd87bd4dd2abd5'), 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 40, 740463), 'prof...40, 740478), 'profileUsername': 'profile_owner', 'viewedAt': datetime.datetime(2025, 10, 13, 14, 41, 40, 740467), ...}]\ncleanup_profile_views = None\n\n    def test_get_profile_views_with_limit(self, test_users, sample_views, cleanup_profile_views):\n        \"\"\"Test retrieving profile views with limit parameter\"\"\"\n        response = client.get(\"/api/users/profile-views/profile_owner?limit=1\")\n    \n>       assert response.status_code == 200\nE       assert 500 == 200\nE        +  where 500 = <Response [500 Internal Server Error]>.status_code\n\ntests/test_profile_views.py:229: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:40,895 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/profile-views/profile_owner\n2025-10-13 09:41:40,903 - routes - INFO - \ud83d\udcca Getting profile views for profile_owner\n2025-10-13 09:41:40,903 - routes - ERROR - \u274c Error fetching profile views: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2634, in get_profile_views\n    all_views = await db.profile_views.find({\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:41:40,905 - main - INFO - \u274c GET /api/users/profile-views/profile_owner - Status: 500 - Duration: 0.009s\n2025-10-13 09:41:40,919 - httpx - INFO - HTTP Request: GET http://testserver/api/users/profile-views/profile_owner?limit=1 \"HTTP/1.1 500 Internal Server Error\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/profile-views/profile_owner\nINFO     routes:routes.py:2630 \ud83d\udcca Getting profile views for profile_owner\nERROR    routes:routes.py:2726 \u274c Error fetching profile views: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2634, in get_profile_views\n    all_views = await db.profile_views.find({\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nINFO     main:main.py:111 \u274c GET /api/users/profile-views/profile_owner - Status: 500 - Duration: 0.009s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/users/profile-views/profile_owner?limit=1 \"HTTP/1.1 500 Internal Server Error\"\n_______________ TestGetProfileViews.test_get_profile_views_empty _______________\n\nself = <test_profile_views.TestGetProfileViews object at 0x107de1010>\ntest_users = [{'_id': ObjectId('68ed2bc407cd87bd4dd2abd8'), 'contactEmail': 'viewer1@test.com', 'firstName': 'John', 'lastName': 'V...ectId('68ed2bc407cd87bd4dd2abda'), 'contactEmail': 'owner@test.com', 'firstName': 'Profile', 'lastName': 'Owner', ...}]\ncleanup_profile_views = None\n\n    def test_get_profile_views_empty(self, test_users, cleanup_profile_views):\n        \"\"\"Test retrieving profile views when none exist\"\"\"\n        response = client.get(\"/api/users/profile-views/profile_owner\")\n    \n>       assert response.status_code == 200\nE       assert 500 == 200\nE        +  where 500 = <Response [500 Internal Server Error]>.status_code\n\ntests/test_profile_views.py:238: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:41,095 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/profile-views/profile_owner\n2025-10-13 09:41:41,103 - routes - INFO - \ud83d\udcca Getting profile views for profile_owner\n2025-10-13 09:41:41,104 - routes - ERROR - \u274c Error fetching profile views: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2634, in get_profile_views\n    all_views = await db.profile_views.find({\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:41:41,105 - main - INFO - \u274c GET /api/users/profile-views/profile_owner - Status: 500 - Duration: 0.010s\n2025-10-13 09:41:41,107 - httpx - INFO - HTTP Request: GET http://testserver/api/users/profile-views/profile_owner \"HTTP/1.1 500 Internal Server Error\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/profile-views/profile_owner\nINFO     routes:routes.py:2630 \ud83d\udcca Getting profile views for profile_owner\nERROR    routes:routes.py:2726 \u274c Error fetching profile views: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2634, in get_profile_views\n    all_views = await db.profile_views.find({\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nINFO     main:main.py:111 \u274c GET /api/users/profile-views/profile_owner - Status: 500 - Duration: 0.010s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/users/profile-views/profile_owner \"HTTP/1.1 500 Internal Server Error\"\n_______________ TestProfileViewCount.test_get_view_count_success _______________\n\nself = <test_profile_views.TestProfileViewCount object at 0x107e2e210>\ntest_users = [{'_id': ObjectId('68ed2bc507cd87bd4dd2abdc'), 'contactEmail': 'viewer1@test.com', 'firstName': 'John', 'lastName': 'V...ectId('68ed2bc507cd87bd4dd2abde'), 'contactEmail': 'owner@test.com', 'firstName': 'Profile', 'lastName': 'Owner', ...}]\nmultiple_views = [{'_id': ObjectId('68ed2bc507cd87bd4dd2abdf'), 'createdAt': datetime.datetime(2025, 10, 13, 16, 41, 41, 342921), 'prof...41, 342960), 'profileUsername': 'profile_owner', 'viewedAt': datetime.datetime(2025, 10, 13, 16, 41, 41, 342954), ...}]\ncleanup_profile_views = None\n\n    def test_get_view_count_success(self, test_users, multiple_views, cleanup_profile_views):\n        \"\"\"Test getting profile view count statistics\"\"\"\n        response = client.get(\"/api/users/profile-views/profile_owner/count\")\n    \n>       assert response.status_code == 200\nE       assert 500 == 200\nE        +  where 500 = <Response [500 Internal Server Error]>.status_code\n\ntests/test_profile_views.py:277: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:41,473 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/profile-views/profile_owner/count\n2025-10-13 09:41:41,475 - routes - INFO - \ud83d\udcc8 Getting profile view count for profile_owner\n2025-10-13 09:41:41,476 - routes - ERROR - \u274c Error getting profile view count: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2738, in get_profile_view_count\n    total_views = await db.profile_views.count_documents({\"profileUsername\": username})\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:41:41,477 - main - INFO - \u274c GET /api/users/profile-views/profile_owner/count - Status: 500 - Duration: 0.004s\n2025-10-13 09:41:41,483 - httpx - INFO - HTTP Request: GET http://testserver/api/users/profile-views/profile_owner/count \"HTTP/1.1 500 Internal Server Error\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/profile-views/profile_owner/count\nINFO     routes:routes.py:2735 \ud83d\udcc8 Getting profile view count for profile_owner\nERROR    routes:routes.py:2748 \u274c Error getting profile view count: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2738, in get_profile_view_count\n    total_views = await db.profile_views.count_documents({\"profileUsername\": username})\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nINFO     main:main.py:111 \u274c GET /api/users/profile-views/profile_owner/count - Status: 500 - Duration: 0.004s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/users/profile-views/profile_owner/count \"HTTP/1.1 500 Internal Server Error\"\n______________ TestProfileViewCount.test_get_view_count_no_views _______________\n\nself = <test_profile_views.TestProfileViewCount object at 0x107de1580>\ntest_users = [{'_id': ObjectId('68ed2bc507cd87bd4dd2abe3'), 'contactEmail': 'viewer1@test.com', 'firstName': 'John', 'lastName': 'V...ectId('68ed2bc507cd87bd4dd2abe5'), 'contactEmail': 'owner@test.com', 'firstName': 'Profile', 'lastName': 'Owner', ...}]\ncleanup_profile_views = None\n\n    def test_get_view_count_no_views(self, test_users, cleanup_profile_views):\n        \"\"\"Test getting view count when no views exist\"\"\"\n        response = client.get(\"/api/users/profile-views/profile_owner/count\")\n    \n>       assert response.status_code == 200\nE       assert 500 == 200\nE        +  where 500 = <Response [500 Internal Server Error]>.status_code\n\ntests/test_profile_views.py:288: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:41,621 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/profile-views/profile_owner/count\n2025-10-13 09:41:41,636 - routes - INFO - \ud83d\udcc8 Getting profile view count for profile_owner\n2025-10-13 09:41:41,636 - routes - ERROR - \u274c Error getting profile view count: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2738, in get_profile_view_count\n    total_views = await db.profile_views.count_documents({\"profileUsername\": username})\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:41:41,641 - main - INFO - \u274c GET /api/users/profile-views/profile_owner/count - Status: 500 - Duration: 0.020s\n2025-10-13 09:41:41,649 - httpx - INFO - HTTP Request: GET http://testserver/api/users/profile-views/profile_owner/count \"HTTP/1.1 500 Internal Server Error\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/profile-views/profile_owner/count\nINFO     routes:routes.py:2735 \ud83d\udcc8 Getting profile view count for profile_owner\nERROR    routes:routes.py:2748 \u274c Error getting profile view count: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2738, in get_profile_view_count\n    total_views = await db.profile_views.count_documents({\"profileUsername\": username})\n                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nINFO     main:main.py:111 \u274c GET /api/users/profile-views/profile_owner/count - Status: 500 - Duration: 0.020s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/users/profile-views/profile_owner/count \"HTTP/1.1 500 Internal Server Error\"\n__________ TestProfileViewIntegration.test_full_profile_view_workflow __________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py\", line 299, in test_full_profile_view_workflow\n    |     track_response = client.post(\n    |                      ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    |     profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | TypeError: object MagicMock can't be used in 'await' expression\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_profile_views.TestProfileViewIntegration object at 0x107de06e0>\ntest_users = [{'_id': ObjectId('68ed2bc507cd87bd4dd2abe7'), 'contactEmail': 'viewer1@test.com', 'firstName': 'John', 'lastName': 'V...ectId('68ed2bc507cd87bd4dd2abe9'), 'contactEmail': 'owner@test.com', 'firstName': 'Profile', 'lastName': 'Owner', ...}]\ncleanup_profile_views = None\n\n    def test_full_profile_view_workflow(self, test_users, cleanup_profile_views):\n        \"\"\"Test complete workflow: track view, retrieve views, get count\"\"\"\n        # Step 1: Track a view\n>       track_response = client.post(\n            \"/api/users/profile-views\",\n            json={\n                \"profileUsername\": \"profile_owner\",\n                \"viewedByUsername\": \"viewer1\"\n            }\n        )\n\ntests/test_profile_views.py:299: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nprofile_view = ProfileViewCreate(profileUsername='profile_owner', viewedByUsername='viewer1')\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.post(\"/profile-views\")\n    async def track_profile_view(\n        profile_view: ProfileViewCreate,\n        db = Depends(get_database)\n    ):\n        \"\"\"Track when a user views another user's profile\"\"\"\n        logger.info(f\"\ud83d\udc41\ufe0f Profile view: {profile_view.viewedByUsername} viewed {profile_view.profileUsername}\")\n    \n        # Don't track if user views their own profile\n        if profile_view.profileUsername == profile_view.viewedByUsername:\n            return {\"message\": \"Self-view not tracked\"}\n    \n        # Check if both users exist\n>       profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\nE       TypeError: object MagicMock can't be used in 'await' expression\n\nroutes.py:2569: TypeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:41,843 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/profile-views\n2025-10-13 09:41:41,853 - routes - INFO - \ud83d\udc41\ufe0f Profile view: viewer1 viewed profile_owner\n2025-10-13 09:41:41,854 - main - ERROR - \u274c Error processing POST /api/users/profile-views - Duration: 0.011s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/profile-views\nINFO     routes:routes.py:2562 \ud83d\udc41\ufe0f Profile view: viewer1 viewed profile_owner\nERROR    main:main.py:120 \u274c Error processing POST /api/users/profile-views - Duration: 0.011s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n__________ TestProfileViewIntegration.test_multiple_profiles_isolated __________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py\", line 322, in test_multiple_profiles_isolated\n    |     client.post(\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    |     profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | TypeError: object MagicMock can't be used in 'await' expression\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_profile_views.TestProfileViewIntegration object at 0x107de1b80>\ntest_users = [{'_id': ObjectId('68ed2bc607cd87bd4dd2abeb'), 'contactEmail': 'viewer1@test.com', 'firstName': 'John', 'lastName': 'V...ectId('68ed2bc607cd87bd4dd2abed'), 'contactEmail': 'owner@test.com', 'firstName': 'Profile', 'lastName': 'Owner', ...}]\ncleanup_profile_views = None\n\n    def test_multiple_profiles_isolated(self, test_users, cleanup_profile_views):\n        \"\"\"Test that views for different profiles are isolated\"\"\"\n        # Track view for profile_owner\n>       client.post(\n            \"/api/users/profile-views\",\n            json={\n                \"profileUsername\": \"profile_owner\",\n                \"viewedByUsername\": \"viewer1\"\n            }\n        )\n\ntests/test_profile_views.py:322: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nprofile_view = ProfileViewCreate(profileUsername='profile_owner', viewedByUsername='viewer1')\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.post(\"/profile-views\")\n    async def track_profile_view(\n        profile_view: ProfileViewCreate,\n        db = Depends(get_database)\n    ):\n        \"\"\"Track when a user views another user's profile\"\"\"\n        logger.info(f\"\ud83d\udc41\ufe0f Profile view: {profile_view.viewedByUsername} viewed {profile_view.profileUsername}\")\n    \n        # Don't track if user views their own profile\n        if profile_view.profileUsername == profile_view.viewedByUsername:\n            return {\"message\": \"Self-view not tracked\"}\n    \n        # Check if both users exist\n>       profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\nE       TypeError: object MagicMock can't be used in 'await' expression\n\nroutes.py:2569: TypeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:43,041 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/profile-views\n2025-10-13 09:41:43,043 - routes - INFO - \ud83d\udc41\ufe0f Profile view: viewer1 viewed profile_owner\n2025-10-13 09:41:43,043 - main - ERROR - \u274c Error processing POST /api/users/profile-views - Duration: 0.002s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/profile-views\nINFO     routes:routes.py:2562 \ud83d\udc41\ufe0f Profile view: viewer1 viewed profile_owner\nERROR    main:main.py:120 \u274c Error processing POST /api/users/profile-views - Duration: 0.002s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n____________ TestProfileViewEdgeCases.test_invalid_username_format _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py\", line 352, in test_invalid_username_format\n    |     response = client.post(\n    |                ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    |     profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | TypeError: object MagicMock can't be used in 'await' expression\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_profile_views.TestProfileViewEdgeCases object at 0x107de04a0>\ncleanup_profile_views = None\n\n    def test_invalid_username_format(self, cleanup_profile_views):\n        \"\"\"Test handling of invalid username format\"\"\"\n>       response = client.post(\n            \"/api/users/profile-views\",\n            json={\n                \"profileUsername\": \"\",\n                \"viewedByUsername\": \"viewer1\"\n            }\n        )\n\ntests/test_profile_views.py:352: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nprofile_view = ProfileViewCreate(profileUsername='', viewedByUsername='viewer1')\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.post(\"/profile-views\")\n    async def track_profile_view(\n        profile_view: ProfileViewCreate,\n        db = Depends(get_database)\n    ):\n        \"\"\"Track when a user views another user's profile\"\"\"\n        logger.info(f\"\ud83d\udc41\ufe0f Profile view: {profile_view.viewedByUsername} viewed {profile_view.profileUsername}\")\n    \n        # Don't track if user views their own profile\n        if profile_view.profileUsername == profile_view.viewedByUsername:\n            return {\"message\": \"Self-view not tracked\"}\n    \n        # Check if both users exist\n>       profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\nE       TypeError: object MagicMock can't be used in 'await' expression\n\nroutes.py:2569: TypeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:44,061 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/profile-views\n2025-10-13 09:41:44,074 - routes - INFO - \ud83d\udc41\ufe0f Profile view: viewer1 viewed \n2025-10-13 09:41:44,075 - main - ERROR - \u274c Error processing POST /api/users/profile-views - Duration: 0.014s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/profile-views\nINFO     routes:routes.py:2562 \ud83d\udc41\ufe0f Profile view: viewer1 viewed \nERROR    main:main.py:120 \u274c Error processing POST /api/users/profile-views - Duration: 0.014s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2569, in track_profile_view\n    profile_user = await db.users.find_one({\"username\": profile_view.profileUsername})\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n_______________ TestUserRegistration.test_register_user_success ________________\n\nself = <test_routes_integration.TestUserRegistration object at 0x107de3350>\nclient = <starlette.testclient.TestClient object at 0x1084d0380>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_register_user_success(self, client, sample_user_data):\n        \"\"\"Test successful user registration.\"\"\"\n        response = client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n>       assert response.status_code == 201\nE       assert 422 == 201\nE        +  where 422 = <Response [422 Unprocessable Entity]>.status_code\n\ntests/test_routes_integration.py:19: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:46,559 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:46,578 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.020s\n2025-10-13 09:41:46,587 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.020s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n__________ TestUserRegistration.test_register_user_duplicate_username __________\n\nself = <test_routes_integration.TestUserRegistration object at 0x107de34a0>\nclient = <starlette.testclient.TestClient object at 0x1084e3ec0>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_register_user_duplicate_username(self, client, sample_user_data):\n        \"\"\"Test registration with duplicate username.\"\"\"\n        # Register first user\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        # Try to register again with same username\n        response = client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n>       assert response.status_code == 409\nE       assert 422 == 409\nE        +  where 422 = <Response [422 Unprocessable Entity]>.status_code\n\ntests/test_routes_integration.py:39: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:46,736 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:46,740 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\n2025-10-13 09:41:46,760 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:46,768 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:46,787 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.018s\n2025-10-13 09:41:46,790 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.018s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n___________ TestUserRegistration.test_register_user_duplicate_email ____________\n\nself = <test_routes_integration.TestUserRegistration object at 0x107de3680>\nclient = <starlette.testclient.TestClient object at 0x10808e3c0>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_register_user_duplicate_email(self, client, sample_user_data):\n        \"\"\"Test registration with duplicate email.\"\"\"\n        # Register first user\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        # Register second user with same email\n        user_data_2 = sample_user_data.copy()\n        user_data_2[\"username\"] = \"user2\"\n    \n        response = client.post(\n            \"/api/users/register\",\n            data=user_data_2\n        )\n    \n>       assert response.status_code == 409\nE       assert 422 == 409\nE        +  where 422 = <Response [422 Unprocessable Entity]>.status_code\n\ntests/test_routes_integration.py:59: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:46,980 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:46,985 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\n2025-10-13 09:41:46,987 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:46,990 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:47,010 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.020s\n2025-10-13 09:41:47,028 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.020s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n___________ TestUserRegistration.test_register_user_too_many_images ____________\n\nself = <test_routes_integration.TestUserRegistration object at 0x107de0b30>\nclient = <starlette.testclient.TestClient object at 0x1080332c0>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_register_user_too_many_images(self, client, sample_user_data):\n        \"\"\"Test registration with too many images.\"\"\"\n        # Create 6 mock image files\n        files = []\n        for i in range(6):\n            files.append((\"images\", (f\"test{i}.jpg\", b\"fake image content\", \"image/jpeg\")))\n    \n        response = client.post(\n            \"/api/users/register\",\n            data=sample_user_data,\n            files=files\n        )\n    \n>       assert response.status_code == 400\nE       assert 422 == 400\nE        +  where 422 = <Response [422 Unprocessable Entity]>.status_code\n\ntests/test_routes_integration.py:91: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:47,386 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:47,392 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.006s\n2025-10-13 09:41:47,410 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.006s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n_______________________ TestUserLogin.test_login_success _______________________\n\nself = <test_routes_integration.TestUserLogin object at 0x107de3a70>\nclient = <starlette.testclient.TestClient object at 0x108385520>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\nsample_login_data = {'password': 'testpass123', 'username': 'testuser'}\n\n    def test_login_success(self, client, sample_user_data, sample_login_data):\n        \"\"\"Test successful user login.\"\"\"\n        # Register user first\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        # Login\n        response = client.post(\"/api/users/login\", data=sample_login_data)\n    \n>       assert response.status_code == 200\nE       assert 422 == 200\nE        +  where 422 = <Response [422 Unprocessable Entity]>.status_code\n\ntests/test_routes_integration.py:109: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:47,560 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:47,581 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.021s\n2025-10-13 09:41:47,591 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:47,620 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/login\n2025-10-13 09:41:47,638 - main - INFO - \u274c POST /api/users/login - Status: 422 - Duration: 0.018s\n2025-10-13 09:41:47,641 - httpx - INFO - HTTP Request: POST http://testserver/api/users/login \"HTTP/1.1 422 Unprocessable Entity\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.021s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/login\nINFO     main:main.py:111 \u274c POST /api/users/login - Status: 422 - Duration: 0.018s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/login \"HTTP/1.1 422 Unprocessable Entity\"\n_________________ TestUserLogin.test_login_invalid_credentials _________________\n\nself = <test_routes_integration.TestUserLogin object at 0x107de3bf0>\nclient = <starlette.testclient.TestClient object at 0x107fed8b0>\n\n    def test_login_invalid_credentials(self, client):\n        \"\"\"Test login with invalid credentials.\"\"\"\n        login_data = {\n            \"username\": \"nonexistent\",\n            \"password\": \"wrongpassword\"\n        }\n    \n        response = client.post(\"/api/users/login\", data=login_data)\n    \n>       assert response.status_code == 400\nE       assert 422 == 400\nE        +  where 422 = <Response [422 Unprocessable Entity]>.status_code\n\ntests/test_routes_integration.py:124: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:47,789 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/login\n2025-10-13 09:41:47,810 - main - INFO - \u274c POST /api/users/login - Status: 422 - Duration: 0.020s\n2025-10-13 09:41:47,837 - httpx - INFO - HTTP Request: POST http://testserver/api/users/login \"HTTP/1.1 422 Unprocessable Entity\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/login\nINFO     main:main.py:111 \u274c POST /api/users/login - Status: 422 - Duration: 0.020s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/login \"HTTP/1.1 422 Unprocessable Entity\"\n____________________ TestUserLogin.test_login_admin_success ____________________\n\nself = <test_routes_integration.TestUserLogin object at 0x107de3da0>\nclient = <starlette.testclient.TestClient object at 0x108580c20>\n\n    def test_login_admin_success(self, client):\n        \"\"\"Test admin login with hardcoded credentials.\"\"\"\n        login_data = {\n            \"username\": \"admin\",\n            \"password\": \"admin\"\n        }\n    \n        response = client.post(\"/api/users/login\", data=login_data)\n    \n>       assert response.status_code == 200\nE       assert 422 == 200\nE        +  where 422 = <Response [422 Unprocessable Entity]>.status_code\n\ntests/test_routes_integration.py:136: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:47,943 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/login\n2025-10-13 09:41:47,963 - main - INFO - \u274c POST /api/users/login - Status: 422 - Duration: 0.020s\n2025-10-13 09:41:47,985 - httpx - INFO - HTTP Request: POST http://testserver/api/users/login \"HTTP/1.1 422 Unprocessable Entity\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/login\nINFO     main:main.py:111 \u274c POST /api/users/login - Status: 422 - Duration: 0.020s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/login \"HTTP/1.1 422 Unprocessable Entity\"\n__________________ TestUserProfile.test_get_user_profile_own ___________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 155, in test_get_user_profile_own\n    |     response = client.get(f\"/api/users/profile/{sample_user_data['username']}\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    |     user = await db.users.find_one({\"username\": username})\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestUserProfile object at 0x107ea8110>\nclient = <starlette.testclient.TestClient object at 0x1085812b0>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_get_user_profile_own(self, client, sample_user_data):\n        \"\"\"Test getting own profile.\"\"\"\n        # Register user\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        # Get profile as self\n>       response = client.get(f\"/api/users/profile/{sample_user_data['username']}\")\n\ntests/test_routes_integration.py:155: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'testuser', requester = None\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.get(\"/profile/{username}\")\n    async def get_user_profile(username: str, requester: str = None, db = Depends(get_database)):\n        \"\"\"Get user profile by username with PII masking\"\"\"\n        logger.info(f\"\ud83d\udc64 Profile request for username: {username} (requester: {requester})\")\n    \n        # Find user\n        logger.debug(f\"Fetching profile for user '{username}'...\")\n>       user = await db.users.find_one({\"username\": username})\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:469: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:48,043 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:48,045 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.002s\n2025-10-13 09:41:48,051 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:48,053 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/profile/testuser\n2025-10-13 09:41:48,054 - routes - INFO - \ud83d\udc64 Profile request for username: testuser (requester: None)\n2025-10-13 09:41:48,055 - main - ERROR - \u274c Error processing GET /api/users/profile/testuser - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    user = await db.users.find_one({\"username\": username})\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.002s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/profile/testuser\nINFO     routes:routes.py:465 \ud83d\udc64 Profile request for username: testuser (requester: None)\nERROR    main:main.py:120 \u274c Error processing GET /api/users/profile/testuser - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    user = await db.users.find_one({\"username\": username})\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n_______________ TestUserProfile.test_get_user_profile_other_user _______________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 180, in test_get_user_profile_other_user\n    |     response = client.get(\n    |                ^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    |     user = await db.users.find_one({\"username\": username})\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestUserProfile object at 0x107ea8260>\nclient = <starlette.testclient.TestClient object at 0x1080330b0>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_get_user_profile_other_user(self, client, sample_user_data):\n        \"\"\"Test getting another user's profile (should be masked).\"\"\"\n        # Register two users\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        user_data_2 = sample_user_data.copy()\n        user_data_2[\"username\"] = \"user2\"\n        user_data_2[\"contactEmail\"] = \"user2@example.com\"\n    \n        client.post(\n            \"/api/users/register\",\n            data=user_data_2\n        )\n    \n        # Get first user's profile as second user (should be masked)\n>       response = client.get(\n            f\"/api/users/profile/{sample_user_data['username']}\",\n            params={\"requester\": \"user2\"}\n        )\n\ntests/test_routes_integration.py:180: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'testuser', requester = 'user2'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.get(\"/profile/{username}\")\n    async def get_user_profile(username: str, requester: str = None, db = Depends(get_database)):\n        \"\"\"Get user profile by username with PII masking\"\"\"\n        logger.info(f\"\ud83d\udc64 Profile request for username: {username} (requester: {requester})\")\n    \n        # Find user\n        logger.debug(f\"Fetching profile for user '{username}'...\")\n>       user = await db.users.find_one({\"username\": username})\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:469: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:49,262 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:49,267 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\n2025-10-13 09:41:49,288 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:49,291 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:49,313 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.022s\n2025-10-13 09:41:49,315 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:49,319 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/profile/testuser\n2025-10-13 09:41:49,336 - routes - INFO - \ud83d\udc64 Profile request for username: testuser (requester: user2)\n2025-10-13 09:41:49,337 - main - ERROR - \u274c Error processing GET /api/users/profile/testuser - Duration: 0.019s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    user = await db.users.find_one({\"username\": username})\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.022s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/profile/testuser\nINFO     routes:routes.py:465 \ud83d\udc64 Profile request for username: testuser (requester: user2)\nERROR    main:main.py:120 \u274c Error processing GET /api/users/profile/testuser - Duration: 0.019s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    user = await db.users.find_one({\"username\": username})\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n_______________ TestUserProfile.test_get_user_profile_not_found ________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 193, in test_get_user_profile_not_found\n    |     response = client.get(\"/api/users/profile/nonexistent\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    |     user = await db.users.find_one({\"username\": username})\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestUserProfile object at 0x107ea8410>\nclient = <starlette.testclient.TestClient object at 0x1080753d0>\n\n    def test_get_user_profile_not_found(self, client):\n        \"\"\"Test getting non-existent user profile.\"\"\"\n>       response = client.get(\"/api/users/profile/nonexistent\")\n\ntests/test_routes_integration.py:193: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'nonexistent', requester = None\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.get(\"/profile/{username}\")\n    async def get_user_profile(username: str, requester: str = None, db = Depends(get_database)):\n        \"\"\"Get user profile by username with PII masking\"\"\"\n        logger.info(f\"\ud83d\udc64 Profile request for username: {username} (requester: {requester})\")\n    \n        # Find user\n        logger.debug(f\"Fetching profile for user '{username}'...\")\n>       user = await db.users.find_one({\"username\": username})\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:469: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:50,388 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/profile/nonexistent\n2025-10-13 09:41:50,389 - routes - INFO - \ud83d\udc64 Profile request for username: nonexistent (requester: None)\n2025-10-13 09:41:50,392 - main - ERROR - \u274c Error processing GET /api/users/profile/nonexistent - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    user = await db.users.find_one({\"username\": username})\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/profile/nonexistent\nINFO     routes:routes.py:465 \ud83d\udc64 Profile request for username: nonexistent (requester: None)\nERROR    main:main.py:120 \u274c Error processing GET /api/users/profile/nonexistent - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 469, in get_user_profile\n    user = await db.users.find_one({\"username\": username})\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n___________________ TestUserProfile.test_update_user_profile ___________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 212, in test_update_user_profile\n    |     response = client.put(f\"/api/users/profile/{sample_user_data['username']}\", data=update_data)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 630, in put\n    |     return super().put(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1183, in put\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 560, in update_user_profile\n    |     user = await db.users.find_one({\"username\": username})\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestUserProfile object at 0x107ea8590>\nclient = <starlette.testclient.TestClient object at 0x1082cfbf0>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_update_user_profile(self, client, sample_user_data):\n        \"\"\"Test updating user profile.\"\"\"\n        # Register user\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        # Update profile\n        update_data = {\n            \"firstName\": \"Updated\",\n            \"lastName\": \"Name\"\n        }\n    \n>       response = client.put(f\"/api/users/profile/{sample_user_data['username']}\", data=update_data)\n\ntests/test_routes_integration.py:212: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:630: in put\n    return super().put(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1183: in put\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'testuser', firstName = 'Updated', lastName = 'Name'\ncontactNumber = None, contactEmail = None, dob = None, dateOfBirth = None\nsex = None, gender = None, height = None, religion = None\nlanguagesSpoken = None, countryOfOrigin = None, countryOfResidence = None\nstate = None, caste = None, motherTongue = None, familyType = None\nfamilyValues = None, castePreference = None, eatingPreference = None\nlocation = None, education = None, educationHistory = None\nworkExperience = None, workLocation = None, linkedinUrl = None\nworkingStatus = None, workplace = None, citizenshipStatus = None\nrelationshipStatus = None, lookingFor = None, bodyType = None, drinking = None\nsmoking = None, hasChildren = None, wantsChildren = None, pets = None\ninterests = None, languages = None, familyBackground = None, aboutYou = None\naboutMe = None, partnerPreference = None, partnerCriteria = None, images = []\nimagesToDelete = None\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.put(\"/profile/{username}\")\n    async def update_user_profile(\n        username: str,\n        firstName: Optional[str] = Form(None),\n        lastName: Optional[str] = Form(None),\n        contactNumber: Optional[str] = Form(None),\n        contactEmail: Optional[str] = Form(None),\n        dob: Optional[str] = Form(None),\n        dateOfBirth: Optional[str] = Form(None),  # NEW: consistent naming\n        sex: Optional[str] = Form(None),\n        gender: Optional[str] = Form(None),  # NEW: consistent naming\n        height: Optional[str] = Form(None),\n        # Regional/Cultural fields\n        religion: Optional[str] = Form(None),  # NEW\n        languagesSpoken: Optional[str] = Form(None),  # NEW: JSON array\n        countryOfOrigin: Optional[str] = Form(None),  # NEW\n        countryOfResidence: Optional[str] = Form(None),  # NEW\n        state: Optional[str] = Form(None),  # NEW\n        caste: Optional[str] = Form(None),  # NEW: India-specific\n        motherTongue: Optional[str] = Form(None),  # NEW: India-specific\n        familyType: Optional[str] = Form(None),  # NEW\n        familyValues: Optional[str] = Form(None),  # NEW\n        castePreference: Optional[str] = Form(None),\n        eatingPreference: Optional[str] = Form(None),\n        location: Optional[str] = Form(None),\n        # Education & Work\n        education: Optional[str] = Form(None),\n        educationHistory: Optional[str] = Form(None),  # JSON string\n        workExperience: Optional[str] = Form(None),  # JSON string\n        workLocation: Optional[str] = Form(None),  # NEW\n        linkedinUrl: Optional[str] = Form(None),\n        workingStatus: Optional[str] = Form(None),\n        workplace: Optional[str] = Form(None),\n        citizenshipStatus: Optional[str] = Form(None),\n        # Personal/Lifestyle fields\n        relationshipStatus: Optional[str] = Form(None),  # NEW\n        lookingFor: Optional[str] = Form(None),  # NEW\n        bodyType: Optional[str] = Form(None),  # NEW\n        drinking: Optional[str] = Form(None),  # NEW\n        smoking: Optional[str] = Form(None),  # NEW\n        hasChildren: Optional[str] = Form(None),  # NEW\n        wantsChildren: Optional[str] = Form(None),  # NEW\n        pets: Optional[str] = Form(None),  # NEW\n        interests: Optional[str] = Form(None),  # NEW: comma-separated text\n        languages: Optional[str] = Form(None),  # NEW: comma-separated text (different from languagesSpoken)\n        # Background & About\n        familyBackground: Optional[str] = Form(None),\n        aboutYou: Optional[str] = Form(None),\n        aboutMe: Optional[str] = Form(None),  # NEW: consistent naming\n        partnerPreference: Optional[str] = Form(None),\n        partnerCriteria: Optional[str] = Form(None),  # NEW: JSON object with all criteria\n        images: List[UploadFile] = File(default=[]),\n        imagesToDelete: Optional[str] = Form(None),\n        db = Depends(get_database)\n    ):\n        \"\"\"Update user profile\"\"\"\n        logger.info(f\"\ud83d\udcdd Update request for user '{username}'\")\n    \n        # Find user\n        logger.debug(f\"Looking up user '{username}' for update...\")\n>       user = await db.users.find_one({\"username\": username})\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:560: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:51,668 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:51,672 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\n2025-10-13 09:41:51,692 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:51,712 - main - INFO - \ud83d\udce8 Incoming PUT request to /api/users/profile/testuser\n2025-10-13 09:41:51,720 - routes - INFO - \ud83d\udcdd Update request for user 'testuser'\n2025-10-13 09:41:51,735 - main - ERROR - \u274c Error processing PUT /api/users/profile/testuser - Duration: 0.023s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 560, in update_user_profile\n    user = await db.users.find_one({\"username\": username})\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming PUT request to /api/users/profile/testuser\nINFO     routes:routes.py:556 \ud83d\udcdd Update request for user 'testuser'\nERROR    main:main.py:120 \u274c Error processing PUT /api/users/profile/testuser - Duration: 0.023s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 560, in update_user_profile\n    user = await db.users.find_one({\"username\": username})\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n______________________ TestSearch.test_search_users_basic ______________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 233, in test_search_users_basic\n    |     response = client.get(\n    |                ^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestSearch object at 0x107ea88c0>\nclient = <starlette.testclient.TestClient object at 0x1085ab3e0>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_search_users_basic(self, client, sample_user_data):\n        \"\"\"Test basic user search.\"\"\"\n        # Register test user\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        # Search for user\n>       response = client.get(\n            \"/api/users/search\",\n            params={\"keyword\": sample_user_data[\"firstName\"]}\n        )\n\ntests/test_routes_integration.py:233: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = 'Test', gender = '', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:52,766 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:52,769 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\n2025-10-13 09:41:52,772 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:52,774 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:41:52,775 - routes - INFO - \ud83d\udd0d Search request - keyword: 'Test', status: '', page: 1, limit: 20\n2025-10-13 09:41:52,775 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'Test', '$options': 'i'}}, {'lastName': {'$regex': 'Test', '$options': 'i'}}, {'username': {'$regex': 'Test', '$options': 'i'}}, {'location': {'$regex': 'Test', '$options': 'i'}}, {'education': {'$regex': 'Test', '$options': 'i'}}, {'occupation': {'$regex': 'Test', '$options': 'i'}}, {'aboutYou': {'$regex': 'Test', '$options': 'i'}}, {'bio': {'$regex': 'Test', '$options': 'i'}}, {'interests': {'$regex': 'Test', '$options': 'i'}}]}\n2025-10-13 09:41:52,776 - routes - ERROR - \u274c Search execution error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\n2025-10-13 09:41:52,776 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.002s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: 'Test', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'Test', '$options': 'i'}}, {'lastName': {'$regex': 'Test', '$options': 'i'}}, {'username': {'$regex': 'Test', '$options': 'i'}}, {'location': {'$regex': 'Test', '$options': 'i'}}, {'education': {'$regex': 'Test', '$options': 'i'}}, {'occupation': {'$regex': 'Test', '$options': 'i'}}, {'aboutYou': {'$regex': 'Test', '$options': 'i'}}, {'bio': {'$regex': 'Test', '$options': 'i'}}, {'interests': {'$regex': 'Test', '$options': 'i'}}]}\nERROR    routes:routes.py:1266 \u274c Search execution error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.002s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n__________________ TestSearch.test_search_users_with_filters ___________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 253, in test_search_users_with_filters\n    |     response = client.get(\n    |                ^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestSearch object at 0x107ea8a10>\nclient = <starlette.testclient.TestClient object at 0x108c90ef0>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_search_users_with_filters(self, client, sample_user_data):\n        \"\"\"Test search with filters.\"\"\"\n        # Register test user\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        # Search with gender filter\n>       response = client.get(\n            \"/api/users/search\",\n            params={\n                \"gender\": sample_user_data[\"sex\"],\n                \"location\": sample_user_data[\"location\"]\n            }\n        )\n\ntests/test_routes_integration.py:253: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = 'Male', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = 'Test City', education = '', occupation = ''\nreligion = '', caste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:53,741 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:53,744 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\n2025-10-13 09:41:53,752 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:53,754 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:41:53,756 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:41:53,756 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'sex': 'Male', 'location': {'$regex': 'Test City', '$options': 'i'}}\n2025-10-13 09:41:53,757 - routes - ERROR - \u274c Search execution error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\n2025-10-13 09:41:53,759 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.004s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'sex': 'Male', 'location': {'$regex': 'Test City', '$options': 'i'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.004s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n___________________ TestSearch.test_search_users_pagination ____________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 274, in test_search_users_pagination\n    |     response = client.get(\n    |                ^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestSearch object at 0x107ea8bc0>\nclient = <starlette.testclient.TestClient object at 0x108c91010>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_search_users_pagination(self, client, sample_user_data):\n        \"\"\"Test search pagination.\"\"\"\n        # Register test user\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        # Search with pagination\n>       response = client.get(\n            \"/api/users/search\",\n            params={\"page\": 1, \"limit\": 10}\n        )\n\ntests/test_routes_integration.py:274: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 0\nlocation = '', education = '', occupation = '', religion = '', caste = ''\neatingPreference = '', drinking = '', smoking = '', relationshipStatus = ''\nbodyType = '', newlyAdded = False, status = '', sortBy = 'newest'\nsortOrder = 'desc', page = 1, limit = 10\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:55,012 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:55,023 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.012s\n2025-10-13 09:41:55,026 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:55,029 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:41:55,031 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 10\n2025-10-13 09:41:55,032 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}}\n2025-10-13 09:41:55,034 - routes - ERROR - \u274c Search execution error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\n2025-10-13 09:41:55,037 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.008s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.012s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 10\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.008s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_________________ TestAdminEndpoints.test_get_all_users_admin __________________\n\nself = <test_routes_integration.TestAdminEndpoints object at 0x107ea8890>\nclient = <starlette.testclient.TestClient object at 0x108c5ddf0>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_get_all_users_admin(self, client, sample_user_data):\n        \"\"\"Test getting all users as admin.\"\"\"\n        # Login as admin\n        admin_login = client.post(\"/api/users/login\", data={\n            \"username\": \"admin\",\n            \"password\": \"admin\"\n        })\n>       admin_token = admin_login.json()[\"access_token\"]\nE       KeyError: 'access_token'\n\ntests/test_routes_integration.py:296: KeyError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:56,343 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/login\n2025-10-13 09:41:56,344 - main - INFO - \u274c POST /api/users/login - Status: 422 - Duration: 0.002s\n2025-10-13 09:41:56,347 - httpx - INFO - HTTP Request: POST http://testserver/api/users/login \"HTTP/1.1 422 Unprocessable Entity\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/login\nINFO     main:main.py:111 \u274c POST /api/users/login - Status: 422 - Duration: 0.002s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/login \"HTTP/1.1 422 Unprocessable Entity\"\n________________ TestAccessRequests.test_create_access_request _________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 348, in test_create_access_request\n    |     response = client.post(\"/api/users/access-request\", data={\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1015, in create_pii_access_request\n    |     result = await create_access_request(db, requester, requested_user, message)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/pii_security.py\", line 170, in create_access_request\n    |     existing = await db.access_requests.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestAccessRequests object at 0x107ea8ec0>\nclient = <starlette.testclient.TestClient object at 0x1084e1190>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_create_access_request(self, client, sample_user_data):\n        \"\"\"Test creating PII access request.\"\"\"\n        # Register two users\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        user_data_2 = sample_user_data.copy()\n        user_data_2[\"username\"] = \"user2\"\n        client.post(\n            \"/api/users/register\",\n            data=user_data_2\n        )\n    \n        # Create access request\n>       response = client.post(\"/api/users/access-request\", data={\n            \"requester\": \"user2\",\n            \"requested_user\": sample_user_data[\"username\"],\n            \"message\": \"Please grant access\"\n        })\n\ntests/test_routes_integration.py:348: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\nroutes.py:1015: in create_pii_access_request\n    result = await create_access_request(db, requester, requested_user, message)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\nrequester_id = 'user2', requested_user_id = 'testuser'\nmessage = 'Please grant access'\n\n    async def create_access_request(db, requester_id, requested_user_id, message=None):\n        \"\"\"\n        Create a new PII access request\n    \n        Args:\n            db: Database connection\n            requester_id: Username of requester\n            requested_user_id: Username of profile owner\n            message: Optional message from requester\n    \n        Returns:\n            Created request document\n        \"\"\"\n        from datetime import datetime\n    \n        # Check if request already exists\n>       existing = await db.access_requests.find_one({\n            'requesterId': requester_id,\n            'requestedUserId': requested_user_id\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\npii_security.py:170: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:56,499 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:56,503 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\n2025-10-13 09:41:56,506 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:56,509 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:56,512 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\n2025-10-13 09:41:56,515 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:56,517 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/access-request\n2025-10-13 09:41:56,520 - routes - INFO - \ud83d\udd10 Access request: user2 \u2192 testuser\n2025-10-13 09:41:56,521 - main - ERROR - \u274c Error processing POST /api/users/access-request - Duration: 0.004s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1015, in create_pii_access_request\n    result = await create_access_request(db, requester, requested_user, message)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/pii_security.py\", line 170, in create_access_request\n    existing = await db.access_requests.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/access-request\nINFO     routes:routes.py:1012 \ud83d\udd10 Access request: user2 \u2192 testuser\nERROR    main:main.py:120 \u274c Error processing POST /api/users/access-request - Duration: 0.004s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1015, in create_pii_access_request\n    result = await create_access_request(db, requester, requested_user, message)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/pii_security.py\", line 170, in create_access_request\n    existing = await db.access_requests.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n___________ TestAccessRequests.test_create_duplicate_access_request ____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 374, in test_create_duplicate_access_request\n    |     client.post(\"/api/users/access-request\", data={\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1015, in create_pii_access_request\n    |     result = await create_access_request(db, requester, requested_user, message)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/pii_security.py\", line 170, in create_access_request\n    |     existing = await db.access_requests.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestAccessRequests object at 0x107ea9010>\nclient = <starlette.testclient.TestClient object at 0x1084e15b0>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_create_duplicate_access_request(self, client, sample_user_data):\n        \"\"\"Test creating duplicate access request.\"\"\"\n        # Register two users\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        user_data_2 = sample_user_data.copy()\n        user_data_2[\"username\"] = \"user2\"\n        client.post(\n            \"/api/users/register\",\n            data=user_data_2\n        )\n    \n        # Create first request\n>       client.post(\"/api/users/access-request\", data={\n            \"requester\": \"user2\",\n            \"requested_user\": sample_user_data[\"username\"]\n        })\n\ntests/test_routes_integration.py:374: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\nroutes.py:1015: in create_pii_access_request\n    result = await create_access_request(db, requester, requested_user, message)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\nrequester_id = 'user2', requested_user_id = 'testuser', message = None\n\n    async def create_access_request(db, requester_id, requested_user_id, message=None):\n        \"\"\"\n        Create a new PII access request\n    \n        Args:\n            db: Database connection\n            requester_id: Username of requester\n            requested_user_id: Username of profile owner\n            message: Optional message from requester\n    \n        Returns:\n            Created request document\n        \"\"\"\n        from datetime import datetime\n    \n        # Check if request already exists\n>       existing = await db.access_requests.find_one({\n            'requesterId': requester_id,\n            'requestedUserId': requested_user_id\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\npii_security.py:170: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:57,722 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:57,725 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\n2025-10-13 09:41:57,728 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:57,735 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:57,739 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\n2025-10-13 09:41:57,742 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:57,745 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/access-request\n2025-10-13 09:41:57,747 - routes - INFO - \ud83d\udd10 Access request: user2 \u2192 testuser\n2025-10-13 09:41:57,749 - main - ERROR - \u274c Error processing POST /api/users/access-request - Duration: 0.004s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1015, in create_pii_access_request\n    result = await create_access_request(db, requester, requested_user, message)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/pii_security.py\", line 170, in create_access_request\n    existing = await db.access_requests.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/access-request\nINFO     routes:routes.py:1012 \ud83d\udd10 Access request: user2 \u2192 testuser\nERROR    main:main.py:120 \u274c Error processing POST /api/users/access-request - Duration: 0.004s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1015, in create_pii_access_request\n    result = await create_access_request(db, requester, requested_user, message)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/pii_security.py\", line 170, in create_access_request\n    existing = await db.access_requests.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n_________________ TestAccessRequests.test_get_access_requests __________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 403, in test_get_access_requests\n    |     client.post(\"/api/users/access-request\", data={\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1015, in create_pii_access_request\n    |     result = await create_access_request(db, requester, requested_user, message)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/pii_security.py\", line 170, in create_access_request\n    |     existing = await db.access_requests.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestAccessRequests object at 0x107ea91c0>\nclient = <starlette.testclient.TestClient object at 0x108c5fd10>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_get_access_requests(self, client, sample_user_data):\n        \"\"\"Test getting access requests.\"\"\"\n        # Register two users and create request\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        user_data_2 = sample_user_data.copy()\n        user_data_2[\"username\"] = \"user2\"\n        client.post(\n            \"/api/users/register\",\n            data=user_data_2\n        )\n    \n>       client.post(\"/api/users/access-request\", data={\n            \"requester\": \"user2\",\n            \"requested_user\": sample_user_data[\"username\"]\n        })\n\ntests/test_routes_integration.py:403: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\nroutes.py:1015: in create_pii_access_request\n    result = await create_access_request(db, requester, requested_user, message)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\nrequester_id = 'user2', requested_user_id = 'testuser', message = None\n\n    async def create_access_request(db, requester_id, requested_user_id, message=None):\n        \"\"\"\n        Create a new PII access request\n    \n        Args:\n            db: Database connection\n            requester_id: Username of requester\n            requested_user_id: Username of profile owner\n            message: Optional message from requester\n    \n        Returns:\n            Created request document\n        \"\"\"\n        from datetime import datetime\n    \n        # Check if request already exists\n>       existing = await db.access_requests.find_one({\n            'requesterId': requester_id,\n            'requestedUserId': requested_user_id\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\npii_security.py:170: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:41:58,894 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:58,897 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\n2025-10-13 09:41:58,902 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:58,905 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:41:58,907 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\n2025-10-13 09:41:58,909 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:41:58,911 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/access-request\n2025-10-13 09:41:58,913 - routes - INFO - \ud83d\udd10 Access request: user2 \u2192 testuser\n2025-10-13 09:41:58,914 - main - ERROR - \u274c Error processing POST /api/users/access-request - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1015, in create_pii_access_request\n    result = await create_access_request(db, requester, requested_user, message)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/pii_security.py\", line 170, in create_access_request\n    existing = await db.access_requests.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/access-request\nINFO     routes:routes.py:1012 \ud83d\udd10 Access request: user2 \u2192 testuser\nERROR    main:main.py:120 \u274c Error processing POST /api/users/access-request - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1015, in create_pii_access_request\n    result = await create_access_request(db, requester, requested_user, message)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/pii_security.py\", line 170, in create_access_request\n    existing = await db.access_requests.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n_____________________ TestFavorites.test_add_to_favorites ______________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 436, in test_add_to_favorites\n    |     response = client.post(f\"/api/users/favorites/user2\",\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    |     existing = await db.favorites.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestFavorites object at 0x107ea94f0>\nclient = <starlette.testclient.TestClient object at 0x108c5cef0>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_add_to_favorites(self, client, sample_user_data):\n        \"\"\"Test adding user to favorites.\"\"\"\n        # Register two users\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        user_data_2 = sample_user_data.copy()\n        user_data_2[\"username\"] = \"user2\"\n        client.post(\n            \"/api/users/register\",\n            data=user_data_2\n        )\n    \n        # Add to favorites\n>       response = client.post(f\"/api/users/favorites/user2\",\n                                    params={\"username\": sample_user_data[\"username\"]})\n\ntests/test_routes_integration.py:436: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'testuser', target_username = 'user2'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/favorites/{target_username}\")\n    async def add_to_favorites(username: str, target_username: str, db = Depends(get_database)):\n        \"\"\"Add user to favorites\"\"\"\n        logger.info(f\"\u2b50 Adding {target_username} to {username}'s favorites\")\n    \n        # Check if already in favorites\n>       existing = await db.favorites.find_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1463: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:00,018 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:42:00,022 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\n2025-10-13 09:42:00,025 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:42:00,027 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:42:00,034 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.007s\n2025-10-13 09:42:00,037 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:42:00,040 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/favorites/user2\n2025-10-13 09:42:00,041 - routes - INFO - \u2b50 Adding user2 to testuser's favorites\n2025-10-13 09:42:00,042 - main - ERROR - \u274c Error processing POST /api/users/favorites/user2 - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.007s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/favorites/user2\nINFO     routes:routes.py:1460 \u2b50 Adding user2 to testuser's favorites\nERROR    main:main.py:120 \u274c Error processing POST /api/users/favorites/user2 - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n________________ TestFavorites.test_add_duplicate_to_favorites _________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 458, in test_add_duplicate_to_favorites\n    |     client.post(f\"/api/users/favorites/user2\",\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    |     existing = await db.favorites.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestFavorites object at 0x107ea9640>\nclient = <starlette.testclient.TestClient object at 0x108c95970>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_add_duplicate_to_favorites(self, client, sample_user_data):\n        \"\"\"Test adding same user to favorites twice.\"\"\"\n        # Register two users\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        user_data_2 = sample_user_data.copy()\n        user_data_2[\"username\"] = \"user2\"\n        client.post(\n            \"/api/users/register\",\n            data=user_data_2\n        )\n    \n        # Add to favorites first time\n>       client.post(f\"/api/users/favorites/user2\",\n                         params={\"username\": sample_user_data[\"username\"]})\n\ntests/test_routes_integration.py:458: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'testuser', target_username = 'user2'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/favorites/{target_username}\")\n    async def add_to_favorites(username: str, target_username: str, db = Depends(get_database)):\n        \"\"\"Add user to favorites\"\"\"\n        logger.info(f\"\u2b50 Adding {target_username} to {username}'s favorites\")\n    \n        # Check if already in favorites\n>       existing = await db.favorites.find_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1463: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:01,334 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:42:01,340 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.006s\n2025-10-13 09:42:01,349 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:42:01,353 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:42:01,356 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\n2025-10-13 09:42:01,361 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:42:01,365 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/favorites/user2\n2025-10-13 09:42:01,366 - routes - INFO - \u2b50 Adding user2 to testuser's favorites\n2025-10-13 09:42:01,368 - main - ERROR - \u274c Error processing POST /api/users/favorites/user2 - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.006s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/favorites/user2\nINFO     routes:routes.py:1460 \u2b50 Adding user2 to testuser's favorites\nERROR    main:main.py:120 \u274c Error processing POST /api/users/favorites/user2 - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n_______________________ TestFavorites.test_get_favorites _______________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 483, in test_get_favorites\n    |     client.post(f\"/api/users/favorites/user2\",\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    |     existing = await db.favorites.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestFavorites object at 0x107ea97f0>\nclient = <starlette.testclient.TestClient object at 0x108c95c70>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_get_favorites(self, client, sample_user_data):\n        \"\"\"Test getting user's favorites.\"\"\"\n        # Register two users and add to favorites\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        user_data_2 = sample_user_data.copy()\n        user_data_2[\"username\"] = \"user2\"\n        client.post(\n            \"/api/users/register\",\n            data=user_data_2\n        )\n    \n>       client.post(f\"/api/users/favorites/user2\",\n                         params={\"username\": sample_user_data[\"username\"]})\n\ntests/test_routes_integration.py:483: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'testuser', target_username = 'user2'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/favorites/{target_username}\")\n    async def add_to_favorites(username: str, target_username: str, db = Depends(get_database)):\n        \"\"\"Add user to favorites\"\"\"\n        logger.info(f\"\u2b50 Adding {target_username} to {username}'s favorites\")\n    \n        # Check if already in favorites\n>       existing = await db.favorites.find_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1463: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:02,716 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:42:02,720 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\n2025-10-13 09:42:02,723 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:42:02,725 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:42:02,727 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.002s\n2025-10-13 09:42:02,730 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:42:02,735 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/favorites/user2\n2025-10-13 09:42:02,737 - routes - INFO - \u2b50 Adding user2 to testuser's favorites\n2025-10-13 09:42:02,739 - main - ERROR - \u274c Error processing POST /api/users/favorites/user2 - Duration: 0.004s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.002s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/favorites/user2\nINFO     routes:routes.py:1460 \u2b50 Adding user2 to testuser's favorites\nERROR    main:main.py:120 \u274c Error processing POST /api/users/favorites/user2 - Duration: 0.004s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n_______________________ TestMessaging.test_send_message ________________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 514, in test_send_message\n    |     response = client.post(\"/api/users/messages\", data={\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1889, in send_message\n    |     recipient = await db.users.find_one({\"username\": to_username})\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestMessaging object at 0x107ea9b20>\nclient = <starlette.testclient.TestClient object at 0x108580980>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_send_message(self, client, sample_user_data):\n        \"\"\"Test sending a message.\"\"\"\n        # Register two users\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        user_data_2 = sample_user_data.copy()\n        user_data_2[\"username\"] = \"user2\"\n        client.post(\n            \"/api/users/register\",\n            data=user_data_2\n        )\n    \n        # Send message\n>       response = client.post(\"/api/users/messages\", data={\n            \"from_username\": sample_user_data[\"username\"],\n            \"to_username\": \"user2\",\n            \"content\": \"Hello, this is a test message!\"\n        })\n\ntests/test_routes_integration.py:514: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nfrom_username = 'testuser', to_username = 'user2'\ncontent = 'Hello, this is a test message!'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/messages\")\n    async def send_message(\n        from_username: str = Form(...),\n        to_username: str = Form(...),\n        content: str = Form(...),\n        db = Depends(get_database)\n    ):\n        \"\"\"Send a message to another user\"\"\"\n        logger.info(f\"\ud83d\udcac Message from {from_username} to {to_username}\")\n    \n        if len(content.strip()) == 0:\n            raise HTTPException(\n                status_code=status.HTTP_400_BAD_REQUEST,\n                detail=\"Message content cannot be empty\"\n            )\n    \n        if len(content) > 1000:\n            raise HTTPException(\n                status_code=status.HTTP_400_BAD_REQUEST,\n                detail=\"Message too long (max 1000 characters)\"\n            )\n    \n        # Check if recipient exists\n>       recipient = await db.users.find_one({\"username\": to_username})\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1889: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:03,874 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:42:03,878 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\n2025-10-13 09:42:03,886 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:42:03,888 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:42:03,892 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\n2025-10-13 09:42:03,895 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:42:03,903 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/messages\n2025-10-13 09:42:03,906 - routes - INFO - \ud83d\udcac Message from testuser to user2\n2025-10-13 09:42:03,909 - main - ERROR - \u274c Error processing POST /api/users/messages - Duration: 0.006s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1889, in send_message\n    recipient = await db.users.find_one({\"username\": to_username})\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.004s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.003s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/messages\nINFO     routes:routes.py:1874 \ud83d\udcac Message from testuser to user2\nERROR    main:main.py:120 \u274c Error processing POST /api/users/messages - Duration: 0.006s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1889, in send_message\n    recipient = await db.users.find_one({\"username\": to_username})\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n_______________________ TestMessaging.test_get_messages ________________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_routes_integration.py\", line 563, in test_get_messages\n    |     client.post(\"/api/users/messages\", data={\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1889, in send_message\n    |     recipient = await db.users.find_one({\"username\": to_username})\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_routes_integration.TestMessaging object at 0x107ea9e20>\nclient = <starlette.testclient.TestClient object at 0x108873ce0>\nsample_user_data = {'citizenshipStatus': 'Citizen', 'contactEmail': 'test@example.com', 'contactNumber': '1234567890', 'dob': '1990-01-01', ...}\n\n    def test_get_messages(self, client, sample_user_data):\n        \"\"\"Test getting messages for user.\"\"\"\n        # Register two users and send message\n        client.post(\n            \"/api/users/register\",\n            data=sample_user_data\n        )\n    \n        user_data_2 = sample_user_data.copy()\n        user_data_2[\"username\"] = \"user2\"\n        client.post(\n            \"/api/users/register\",\n            data=user_data_2\n        )\n    \n>       client.post(\"/api/users/messages\", data={\n            \"from_username\": sample_user_data[\"username\"],\n            \"to_username\": \"user2\",\n            \"content\": \"Test message\"\n        })\n\ntests/test_routes_integration.py:563: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nfrom_username = 'testuser', to_username = 'user2', content = 'Test message'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/messages\")\n    async def send_message(\n        from_username: str = Form(...),\n        to_username: str = Form(...),\n        content: str = Form(...),\n        db = Depends(get_database)\n    ):\n        \"\"\"Send a message to another user\"\"\"\n        logger.info(f\"\ud83d\udcac Message from {from_username} to {to_username}\")\n    \n        if len(content.strip()) == 0:\n            raise HTTPException(\n                status_code=status.HTTP_400_BAD_REQUEST,\n                detail=\"Message content cannot be empty\"\n            )\n    \n        if len(content) > 1000:\n            raise HTTPException(\n                status_code=status.HTTP_400_BAD_REQUEST,\n                detail=\"Message too long (max 1000 characters)\"\n            )\n    \n        # Check if recipient exists\n>       recipient = await db.users.find_one({\"username\": to_username})\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1889: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:05,100 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:42:05,105 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.005s\n2025-10-13 09:42:05,109 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:42:05,112 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/register\n2025-10-13 09:42:05,119 - main - INFO - \u274c POST /api/users/register - Status: 422 - Duration: 0.007s\n2025-10-13 09:42:05,123 - httpx - INFO - HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\n2025-10-13 09:42:05,126 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/messages\n2025-10-13 09:42:05,128 - routes - INFO - \ud83d\udcac Message from testuser to user2\n2025-10-13 09:42:05,129 - main - ERROR - \u274c Error processing POST /api/users/messages - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1889, in send_message\n    recipient = await db.users.find_one({\"username\": to_username})\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.005s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/register\nINFO     main:main.py:111 \u274c POST /api/users/register - Status: 422 - Duration: 0.007s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/register \"HTTP/1.1 422 Unprocessable Entity\"\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/messages\nINFO     routes:routes.py:1874 \ud83d\udcac Message from testuser to user2\nERROR    main:main.py:120 \u274c Error processing POST /api/users/messages - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1889, in send_message\n    recipient = await db.users.find_one({\"username\": to_username})\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n_________________ TestKeywordSearch.test_search_by_first_name __________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 112, in test_search_by_first_name\n    |     response = client.get(\"/api/users/search?keyword=John\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestKeywordSearch object at 0x107eab590>\nsearch_test_users = [{'_id': ObjectId('68ed2bde07cd87bd4dd2ac15'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bde07cd87bd4dd2ac19'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_first_name(self, search_test_users):\n        \"\"\"Test searching by first name\"\"\"\n>       response = client.get(\"/api/users/search?keyword=John\")\n\ntests/test_search.py:112: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = 'John', gender = '', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:06,592 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:06,594 - routes - INFO - \ud83d\udd0d Search request - keyword: 'John', status: '', page: 1, limit: 20\n2025-10-13 09:42:06,595 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'John', '$options': 'i'}}, {'lastName': {'$regex': 'John', '$options': 'i'}}, {'username': {'$regex': 'John', '$options': 'i'}}, {'location': {'$regex': 'John', '$options': 'i'}}, {'education': {'$regex': 'John', '$options': 'i'}}, {'occupation': {'$regex': 'John', '$options': 'i'}}, {'aboutYou': {'$regex': 'John', '$options': 'i'}}, {'bio': {'$regex': 'John', '$options': 'i'}}, {'interests': {'$regex': 'John', '$options': 'i'}}]}\n2025-10-13 09:42:06,599 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:06,601 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.009s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: 'John', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'John', '$options': 'i'}}, {'lastName': {'$regex': 'John', '$options': 'i'}}, {'username': {'$regex': 'John', '$options': 'i'}}, {'location': {'$regex': 'John', '$options': 'i'}}, {'education': {'$regex': 'John', '$options': 'i'}}, {'occupation': {'$regex': 'John', '$options': 'i'}}, {'aboutYou': {'$regex': 'John', '$options': 'i'}}, {'bio': {'$regex': 'John', '$options': 'i'}}, {'interests': {'$regex': 'John', '$options': 'i'}}]}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.009s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n__________________ TestKeywordSearch.test_search_by_last_name __________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 124, in test_search_by_last_name\n    |     response = client.get(\"/api/users/search?keyword=Smith\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestKeywordSearch object at 0x107eab6b0>\nsearch_test_users = [{'_id': ObjectId('68ed2bdf07cd87bd4dd2ac1b'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bdf07cd87bd4dd2ac1f'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_last_name(self, search_test_users):\n        \"\"\"Test searching by last name\"\"\"\n>       response = client.get(\"/api/users/search?keyword=Smith\")\n\ntests/test_search.py:124: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = 'Smith', gender = '', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:07,915 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:07,919 - routes - INFO - \ud83d\udd0d Search request - keyword: 'Smith', status: '', page: 1, limit: 20\n2025-10-13 09:42:07,919 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'Smith', '$options': 'i'}}, {'lastName': {'$regex': 'Smith', '$options': 'i'}}, {'username': {'$regex': 'Smith', '$options': 'i'}}, {'location': {'$regex': 'Smith', '$options': 'i'}}, {'education': {'$regex': 'Smith', '$options': 'i'}}, {'occupation': {'$regex': 'Smith', '$options': 'i'}}, {'aboutYou': {'$regex': 'Smith', '$options': 'i'}}, {'bio': {'$regex': 'Smith', '$options': 'i'}}, {'interests': {'$regex': 'Smith', '$options': 'i'}}]}\n2025-10-13 09:42:07,921 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:07,922 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.007s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: 'Smith', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'Smith', '$options': 'i'}}, {'lastName': {'$regex': 'Smith', '$options': 'i'}}, {'username': {'$regex': 'Smith', '$options': 'i'}}, {'location': {'$regex': 'Smith', '$options': 'i'}}, {'education': {'$regex': 'Smith', '$options': 'i'}}, {'occupation': {'$regex': 'Smith', '$options': 'i'}}, {'aboutYou': {'$regex': 'Smith', '$options': 'i'}}, {'bio': {'$regex': 'Smith', '$options': 'i'}}, {'interests': {'$regex': 'Smith', '$options': 'i'}}]}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.007s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n__________________ TestKeywordSearch.test_search_by_location ___________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 134, in test_search_by_location\n    |     response = client.get(\"/api/users/search?keyword=New York\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestKeywordSearch object at 0x107eab170>\nsearch_test_users = [{'_id': ObjectId('68ed2be007cd87bd4dd2ac21'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2be007cd87bd4dd2ac25'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_location(self, search_test_users):\n        \"\"\"Test searching by location\"\"\"\n>       response = client.get(\"/api/users/search?keyword=New York\")\n\ntests/test_search.py:134: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = 'New York', gender = '', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:09,118 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:09,124 - routes - INFO - \ud83d\udd0d Search request - keyword: 'New York', status: '', page: 1, limit: 20\n2025-10-13 09:42:09,125 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'New York', '$options': 'i'}}, {'lastName': {'$regex': 'New York', '$options': 'i'}}, {'username': {'$regex': 'New York', '$options': 'i'}}, {'location': {'$regex': 'New York', '$options': 'i'}}, {'education': {'$regex': 'New York', '$options': 'i'}}, {'occupation': {'$regex': 'New York', '$options': 'i'}}, {'aboutYou': {'$regex': 'New York', '$options': 'i'}}, {'bio': {'$regex': 'New York', '$options': 'i'}}, {'interests': {'$regex': 'New York', '$options': 'i'}}]}\n2025-10-13 09:42:09,125 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:09,126 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.008s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: 'New York', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'New York', '$options': 'i'}}, {'lastName': {'$regex': 'New York', '$options': 'i'}}, {'username': {'$regex': 'New York', '$options': 'i'}}, {'location': {'$regex': 'New York', '$options': 'i'}}, {'education': {'$regex': 'New York', '$options': 'i'}}, {'occupation': {'$regex': 'New York', '$options': 'i'}}, {'aboutYou': {'$regex': 'New York', '$options': 'i'}}, {'bio': {'$regex': 'New York', '$options': 'i'}}, {'interests': {'$regex': 'New York', '$options': 'i'}}]}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.008s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n________________ TestKeywordSearch.test_search_case_insensitive ________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 142, in test_search_case_insensitive\n    |     response1 = client.get(\"/api/users/search?keyword=john\")\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestKeywordSearch object at 0x107eaaf00>\nsearch_test_users = [{'_id': ObjectId('68ed2be207cd87bd4dd2ac27'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2be207cd87bd4dd2ac2b'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_case_insensitive(self, search_test_users):\n        \"\"\"Test that search is case-insensitive\"\"\"\n>       response1 = client.get(\"/api/users/search?keyword=john\")\n\ntests/test_search.py:142: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = 'john', gender = '', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:10,492 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:10,493 - routes - INFO - \ud83d\udd0d Search request - keyword: 'john', status: '', page: 1, limit: 20\n2025-10-13 09:42:10,493 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'john', '$options': 'i'}}, {'lastName': {'$regex': 'john', '$options': 'i'}}, {'username': {'$regex': 'john', '$options': 'i'}}, {'location': {'$regex': 'john', '$options': 'i'}}, {'education': {'$regex': 'john', '$options': 'i'}}, {'occupation': {'$regex': 'john', '$options': 'i'}}, {'aboutYou': {'$regex': 'john', '$options': 'i'}}, {'bio': {'$regex': 'john', '$options': 'i'}}, {'interests': {'$regex': 'john', '$options': 'i'}}]}\n2025-10-13 09:42:10,494 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:10,495 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.003s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: 'john', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'john', '$options': 'i'}}, {'lastName': {'$regex': 'john', '$options': 'i'}}, {'username': {'$regex': 'john', '$options': 'i'}}, {'location': {'$regex': 'john', '$options': 'i'}}, {'education': {'$regex': 'john', '$options': 'i'}}, {'occupation': {'$regex': 'john', '$options': 'i'}}, {'aboutYou': {'$regex': 'john', '$options': 'i'}}, {'bio': {'$regex': 'john', '$options': 'i'}}, {'interests': {'$regex': 'john', '$options': 'i'}}]}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.003s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_________________ TestKeywordSearch.test_search_partial_match __________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 156, in test_search_partial_match\n    |     response = client.get(\"/api/users/search?keyword=Jo\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestKeywordSearch object at 0x107eab0e0>\nsearch_test_users = [{'_id': ObjectId('68ed2be307cd87bd4dd2ac2d'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2be307cd87bd4dd2ac31'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_partial_match(self, search_test_users):\n        \"\"\"Test partial keyword matching\"\"\"\n>       response = client.get(\"/api/users/search?keyword=Jo\")\n\ntests/test_search.py:156: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = 'Jo', gender = '', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:11,712 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:11,722 - routes - INFO - \ud83d\udd0d Search request - keyword: 'Jo', status: '', page: 1, limit: 20\n2025-10-13 09:42:11,722 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'Jo', '$options': 'i'}}, {'lastName': {'$regex': 'Jo', '$options': 'i'}}, {'username': {'$regex': 'Jo', '$options': 'i'}}, {'location': {'$regex': 'Jo', '$options': 'i'}}, {'education': {'$regex': 'Jo', '$options': 'i'}}, {'occupation': {'$regex': 'Jo', '$options': 'i'}}, {'aboutYou': {'$regex': 'Jo', '$options': 'i'}}, {'bio': {'$regex': 'Jo', '$options': 'i'}}, {'interests': {'$regex': 'Jo', '$options': 'i'}}]}\n2025-10-13 09:42:11,723 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:11,724 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.012s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: 'Jo', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'Jo', '$options': 'i'}}, {'lastName': {'$regex': 'Jo', '$options': 'i'}}, {'username': {'$regex': 'Jo', '$options': 'i'}}, {'location': {'$regex': 'Jo', '$options': 'i'}}, {'education': {'$regex': 'Jo', '$options': 'i'}}, {'occupation': {'$regex': 'Jo', '$options': 'i'}}, {'aboutYou': {'$regex': 'Jo', '$options': 'i'}}, {'bio': {'$regex': 'Jo', '$options': 'i'}}, {'interests': {'$regex': 'Jo', '$options': 'i'}}]}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.012s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_________________ TestAgeRangeSearch.test_search_by_age_range __________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 168, in test_search_by_age_range\n    |     response = client.get(\"/api/users/search?ageMin=30&ageMax=35\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestAgeRangeSearch object at 0x107eaab70>\nsearch_test_users = [{'_id': ObjectId('68ed2be407cd87bd4dd2ac33'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2be407cd87bd4dd2ac37'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_age_range(self, search_test_users):\n        \"\"\"Test searching within age range\"\"\"\n        # Search for users aged 30-35\n>       response = client.get(\"/api/users/search?ageMin=30&ageMax=35\")\n\ntests/test_search.py:168: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 30, ageMax = 35, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:13,152 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:13,202 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:13,203 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'dob': {'$lte': '1990-10-13', '$gte': '1995-10-13'}}\n2025-10-13 09:42:13,204 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:13,205 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.052s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'dob': {'$lte': '1990-10-13', '$gte': '1995-10-13'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.052s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n________________ TestAgeRangeSearch.test_search_by_min_age_only ________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 180, in test_search_by_min_age_only\n    |     response = client.get(\"/api/users/search?ageMin=30\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestAgeRangeSearch object at 0x107eaa9c0>\nsearch_test_users = [{'_id': ObjectId('68ed2be607cd87bd4dd2ac39'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2be607cd87bd4dd2ac3d'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_min_age_only(self, search_test_users):\n        \"\"\"Test searching with only minimum age\"\"\"\n>       response = client.get(\"/api/users/search?ageMin=30\")\n\ntests/test_search.py:180: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 30, ageMax = 0, heightMin = 0, heightMax = 0\nlocation = '', education = '', occupation = '', religion = '', caste = ''\neatingPreference = '', drinking = '', smoking = '', relationshipStatus = ''\nbodyType = '', newlyAdded = False, status = '', sortBy = 'newest'\nsortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:14,393 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:14,394 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:14,395 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'dob': {'$gte': '1995-10-13'}}\n2025-10-13 09:42:14,395 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:14,400 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.007s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'dob': {'$gte': '1995-10-13'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.007s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n________________ TestAgeRangeSearch.test_search_by_max_age_only ________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 191, in test_search_by_max_age_only\n    |     response = client.get(\"/api/users/search?ageMax=35\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestAgeRangeSearch object at 0x107eaa630>\nsearch_test_users = [{'_id': ObjectId('68ed2be707cd87bd4dd2ac3f'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2be707cd87bd4dd2ac43'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_max_age_only(self, search_test_users):\n        \"\"\"Test searching with only maximum age\"\"\"\n>       response = client.get(\"/api/users/search?ageMax=35\")\n\ntests/test_search.py:191: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 35, heightMin = 0, heightMax = 0\nlocation = '', education = '', occupation = '', religion = '', caste = ''\neatingPreference = '', drinking = '', smoking = '', relationshipStatus = ''\nbodyType = '', newlyAdded = False, status = '', sortBy = 'newest'\nsortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:15,620 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:15,623 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:15,623 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'dob': {'$lte': '1990-10-13'}}\n2025-10-13 09:42:15,624 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:15,625 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'dob': {'$lte': '1990-10-13'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_______________ TestAgeRangeSearch.test_search_invalid_age_range _______________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 202, in test_search_invalid_age_range\n    |     response = client.get(\"/api/users/search?ageMin=40&ageMax=30\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestAgeRangeSearch object at 0x107eaa4b0>\nsearch_test_users = [{'_id': ObjectId('68ed2be807cd87bd4dd2ac45'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2be807cd87bd4dd2ac49'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_invalid_age_range(self, search_test_users):\n        \"\"\"Test searching with invalid age range (min > max)\"\"\"\n>       response = client.get(\"/api/users/search?ageMin=40&ageMax=30\")\n\ntests/test_search.py:202: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 40, ageMax = 30, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:16,912 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:16,915 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:16,915 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'dob': {'$lte': '1995-10-13', '$gte': '1985-10-13'}}\n2025-10-13 09:42:16,916 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:16,917 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'dob': {'$lte': '1995-10-13', '$gte': '1985-10-13'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n______________ TestHeightRangeSearch.test_search_by_height_range _______________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 212, in test_search_by_height_range\n    |     response = client.get(\"/api/users/search?heightMin=66&heightMax=72\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestHeightRangeSearch object at 0x107eaa330>\nsearch_test_users = [{'_id': ObjectId('68ed2be907cd87bd4dd2ac4b'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2be907cd87bd4dd2ac4f'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_height_range(self, search_test_users):\n        \"\"\"Test searching within height range\"\"\"\n>       response = client.get(\"/api/users/search?heightMin=66&heightMax=72\")\n\ntests/test_search.py:212: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 66\nheightMax = 72, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:17,942 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:17,944 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:17,944 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'height': {'$gte': 66, '$lte': 72}}\n2025-10-13 09:42:17,945 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:17,946 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.004s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'height': {'$gte': 66, '$lte': 72}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.004s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_____________ TestHeightRangeSearch.test_search_by_min_height_only _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 219, in test_search_by_min_height_only\n    |     response = client.get(\"/api/users/search?heightMin=70\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestHeightRangeSearch object at 0x107eaa4e0>\nsearch_test_users = [{'_id': ObjectId('68ed2beb07cd87bd4dd2ac51'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2beb07cd87bd4dd2ac55'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_min_height_only(self, search_test_users):\n        \"\"\"Test searching with only minimum height\"\"\"\n>       response = client.get(\"/api/users/search?heightMin=70\")\n\ntests/test_search.py:219: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 70, heightMax = 0\nlocation = '', education = '', occupation = '', religion = '', caste = ''\neatingPreference = '', drinking = '', smoking = '', relationshipStatus = ''\nbodyType = '', newlyAdded = False, status = '', sortBy = 'newest'\nsortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:19,262 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:19,267 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:19,267 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'height': {'$gte': 70}}\n2025-10-13 09:42:19,268 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:19,269 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.007s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'height': {'$gte': 70}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.007s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_____________ TestHeightRangeSearch.test_search_by_max_height_only _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 226, in test_search_by_max_height_only\n    |     response = client.get(\"/api/users/search?heightMax=68\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestHeightRangeSearch object at 0x107eab4a0>\nsearch_test_users = [{'_id': ObjectId('68ed2bec07cd87bd4dd2ac57'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bec07cd87bd4dd2ac5b'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_max_height_only(self, search_test_users):\n        \"\"\"Test searching with only maximum height\"\"\"\n>       response = client.get(\"/api/users/search?heightMax=68\")\n\ntests/test_search.py:226: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 68\nlocation = '', education = '', occupation = '', religion = '', caste = ''\neatingPreference = '', drinking = '', smoking = '', relationshipStatus = ''\nbodyType = '', newlyAdded = False, status = '', sortBy = 'newest'\nsortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:20,391 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:20,393 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:20,393 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'height': {'$lte': 68}}\n2025-10-13 09:42:20,393 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:20,394 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.003s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'height': {'$lte': 68}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.003s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_________________ TestGenderSearch.test_search_by_gender_male __________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 236, in test_search_by_gender_male\n    |     response = client.get(\"/api/users/search?gender=Male\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestGenderSearch object at 0x107d61310>\nsearch_test_users = [{'_id': ObjectId('68ed2bed07cd87bd4dd2ac5d'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bed07cd87bd4dd2ac61'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_gender_male(self, search_test_users):\n        \"\"\"Test searching for male users\"\"\"\n>       response = client.get(\"/api/users/search?gender=Male\")\n\ntests/test_search.py:236: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = 'Male', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:21,492 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:21,495 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:21,495 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'sex': 'Male'}\n2025-10-13 09:42:21,495 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:21,496 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.004s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'sex': 'Male'}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.004s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n________________ TestGenderSearch.test_search_by_gender_female _________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 247, in test_search_by_gender_female\n    |     response = client.get(\"/api/users/search?gender=Female\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestGenderSearch object at 0x107d61a00>\nsearch_test_users = [{'_id': ObjectId('68ed2bee07cd87bd4dd2ac63'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bee07cd87bd4dd2ac67'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_gender_female(self, search_test_users):\n        \"\"\"Test searching for female users\"\"\"\n>       response = client.get(\"/api/users/search?gender=Female\")\n\ntests/test_search.py:247: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = 'Female', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:22,617 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:22,620 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:22,620 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'sex': 'Female'}\n2025-10-13 09:42:22,621 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:22,622 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'sex': 'Female'}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_______________ TestLocationSearch.test_search_by_exact_location _______________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 261, in test_search_by_exact_location\n    |     response = client.get(\"/api/users/search?location=New York, USA\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestLocationSearch object at 0x107d61340>\nsearch_test_users = [{'_id': ObjectId('68ed2bef07cd87bd4dd2ac69'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bef07cd87bd4dd2ac6d'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_exact_location(self, search_test_users):\n        \"\"\"Test searching by exact location\"\"\"\n>       response = client.get(\"/api/users/search?location=New York, USA\")\n\ntests/test_search.py:261: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 0\nlocation = 'New York, USA', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:23,942 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:23,944 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:23,944 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'location': {'$regex': 'New York, USA', '$options': 'i'}}\n2025-10-13 09:42:23,945 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:23,947 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'location': {'$regex': 'New York, USA', '$options': 'i'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_________________ TestLocationSearch.test_search_by_city_only __________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 269, in test_search_by_city_only\n    |     response = client.get(\"/api/users/search?location=Chicago\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestLocationSearch object at 0x107d61400>\nsearch_test_users = [{'_id': ObjectId('68ed2bf007cd87bd4dd2ac6f'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bf007cd87bd4dd2ac73'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_city_only(self, search_test_users):\n        \"\"\"Test searching by city name only\"\"\"\n>       response = client.get(\"/api/users/search?location=Chicago\")\n\ntests/test_search.py:269: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 0\nlocation = 'Chicago', education = '', occupation = '', religion = '', caste = ''\neatingPreference = '', drinking = '', smoking = '', relationshipStatus = ''\nbodyType = '', newlyAdded = False, status = '', sortBy = 'newest'\nsortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:25,169 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:25,172 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:25,172 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'location': {'$regex': 'Chicago', '$options': 'i'}}\n2025-10-13 09:42:25,173 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:25,174 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'location': {'$regex': 'Chicago', '$options': 'i'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n____________ TestEducationOccupationSearch.test_search_by_education ____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 280, in test_search_by_education\n    |     response = client.get(\"/api/users/search?education=Master's\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestEducationOccupationSearch object at 0x107d61670>\nsearch_test_users = [{'_id': ObjectId('68ed2bf207cd87bd4dd2ac75'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bf207cd87bd4dd2ac79'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_education(self, search_test_users):\n        \"\"\"Test searching by education level\"\"\"\n>       response = client.get(\"/api/users/search?education=Master's\")\n\ntests/test_search.py:280: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 0\nlocation = '', education = \"Master's\", occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:26,412 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:26,415 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:26,415 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'education': \"Master's\"}\n2025-10-13 09:42:26,416 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:26,417 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'education': \"Master's\"}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n___________ TestEducationOccupationSearch.test_search_by_occupation ____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 291, in test_search_by_occupation\n    |     response = client.get(\"/api/users/search?occupation=Engineer\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestEducationOccupationSearch object at 0x107d612e0>\nsearch_test_users = [{'_id': ObjectId('68ed2bf307cd87bd4dd2ac7b'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bf307cd87bd4dd2ac7f'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_occupation(self, search_test_users):\n        \"\"\"Test searching by occupation\"\"\"\n>       response = client.get(\"/api/users/search?occupation=Engineer\")\n\ntests/test_search.py:291: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 0\nlocation = '', education = '', occupation = 'Engineer', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:27,642 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:27,644 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:27,645 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'occupation': 'Engineer'}\n2025-10-13 09:42:27,645 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:27,647 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.004s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'occupation': 'Engineer'}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.004s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_____________ TestReligionEatingPreference.test_search_by_religion _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 304, in test_search_by_religion\n    |     response = client.get(\"/api/users/search?religion=Hindu\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestReligionEatingPreference object at 0x107d60560>\nsearch_test_users = [{'_id': ObjectId('68ed2bf407cd87bd4dd2ac81'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bf407cd87bd4dd2ac85'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_religion(self, search_test_users):\n        \"\"\"Test searching by religion\"\"\"\n>       response = client.get(\"/api/users/search?religion=Hindu\")\n\ntests/test_search.py:304: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 0\nlocation = '', education = '', occupation = '', religion = 'Hindu', caste = ''\neatingPreference = '', drinking = '', smoking = '', relationshipStatus = ''\nbodyType = '', newlyAdded = False, status = '', sortBy = 'newest'\nsortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:28,941 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:28,943 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:28,943 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'religion': 'Hindu'}\n2025-10-13 09:42:28,943 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:28,944 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.003s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'religion': 'Hindu'}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.003s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n________ TestReligionEatingPreference.test_search_by_eating_preference _________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 312, in test_search_by_eating_preference\n    |     response = client.get(\"/api/users/search?eatingPreference=Vegetarian\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestReligionEatingPreference object at 0x107d61040>\nsearch_test_users = [{'_id': ObjectId('68ed2bf607cd87bd4dd2ac87'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bf607cd87bd4dd2ac8b'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_by_eating_preference(self, search_test_users):\n        \"\"\"Test searching by eating preference\"\"\"\n>       response = client.get(\"/api/users/search?eatingPreference=Vegetarian\")\n\ntests/test_search.py:312: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 0\nlocation = '', education = '', occupation = '', religion = '', caste = ''\neatingPreference = 'Vegetarian', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:30,409 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:30,411 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:30,411 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'eatingPreference': 'Vegetarian'}\n2025-10-13 09:42:30,413 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:30,414 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'eatingPreference': 'Vegetarian'}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n____________ TestMultipleFilters.test_search_with_multiple_filters _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 323, in test_search_with_multiple_filters\n    |     response = client.get(\n    |                ^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestMultipleFilters object at 0x107d62e70>\nsearch_test_users = [{'_id': ObjectId('68ed2bf707cd87bd4dd2ac8d'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bf707cd87bd4dd2ac91'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_with_multiple_filters(self, search_test_users):\n        \"\"\"Test searching with multiple filters combined\"\"\"\n>       response = client.get(\n            \"/api/users/search?gender=Male&location=New York&ageMin=30&ageMax=40\"\n        )\n\ntests/test_search.py:323: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = 'Male', ageMin = 30, ageMax = 40, heightMin = 0\nheightMax = 0, location = 'New York', education = '', occupation = ''\nreligion = '', caste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:31,663 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:31,667 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:31,667 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'sex': 'Male', 'dob': {'$lte': '1985-10-13', '$gte': '1995-10-13'}, 'location': {'$regex': 'New York', '$options': 'i'}}\n2025-10-13 09:42:31,668 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:31,669 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.006s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'sex': 'Male', 'dob': {'$lte': '1985-10-13', '$gte': '1995-10-13'}, 'location': {'$regex': 'New York', '$options': 'i'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.006s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_____________ TestMultipleFilters.test_search_keyword_with_filters _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 339, in test_search_keyword_with_filters\n    |     response = client.get(\"/api/users/search?keyword=John&gender=Male\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestMultipleFilters object at 0x107d628d0>\nsearch_test_users = [{'_id': ObjectId('68ed2bf807cd87bd4dd2ac93'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bf807cd87bd4dd2ac97'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_keyword_with_filters(self, search_test_users):\n        \"\"\"Test combining keyword search with filters\"\"\"\n>       response = client.get(\"/api/users/search?keyword=John&gender=Male\")\n\ntests/test_search.py:339: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = 'John', gender = 'Male', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:32,862 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:32,864 - routes - INFO - \ud83d\udd0d Search request - keyword: 'John', status: '', page: 1, limit: 20\n2025-10-13 09:42:32,864 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'John', '$options': 'i'}}, {'lastName': {'$regex': 'John', '$options': 'i'}}, {'username': {'$regex': 'John', '$options': 'i'}}, {'location': {'$regex': 'John', '$options': 'i'}}, {'education': {'$regex': 'John', '$options': 'i'}}, {'occupation': {'$regex': 'John', '$options': 'i'}}, {'aboutYou': {'$regex': 'John', '$options': 'i'}}, {'bio': {'$regex': 'John', '$options': 'i'}}, {'interests': {'$regex': 'John', '$options': 'i'}}], 'sex': 'Male'}\n2025-10-13 09:42:32,865 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:32,867 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: 'John', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'John', '$options': 'i'}}, {'lastName': {'$regex': 'John', '$options': 'i'}}, {'username': {'$regex': 'John', '$options': 'i'}}, {'location': {'$regex': 'John', '$options': 'i'}}, {'education': {'$regex': 'John', '$options': 'i'}}, {'occupation': {'$regex': 'John', '$options': 'i'}}, {'aboutYou': {'$regex': 'John', '$options': 'i'}}, {'bio': {'$regex': 'John', '$options': 'i'}}, {'interests': {'$regex': 'John', '$options': 'i'}}], 'sex': 'Male'}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_____________ TestMultipleFilters.test_search_all_filters_combined _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 349, in test_search_all_filters_combined\n    |     response = client.get(\n    |                ^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestMultipleFilters object at 0x107d613d0>\nsearch_test_users = [{'_id': ObjectId('68ed2bf907cd87bd4dd2ac99'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bf907cd87bd4dd2ac9d'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_all_filters_combined(self, search_test_users):\n        \"\"\"Test using all available filters together\"\"\"\n>       response = client.get(\n            \"/api/users/search?\"\n            \"keyword=Engineer&\"\n            \"gender=Male&\"\n            \"ageMin=25&ageMax=40&\"\n            \"heightMin=66&heightMax=72&\"\n            \"location=New York&\"\n            \"education=Bachelor's&\"\n            \"religion=Christian\"\n        )\n\ntests/test_search.py:349: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = 'Engineer', gender = 'Male', ageMin = 25, ageMax = 40, heightMin = 66\nheightMax = 72, location = 'New York', education = \"Bachelor's\", occupation = ''\nreligion = 'Christian', caste = '', eatingPreference = '', drinking = ''\nsmoking = '', relationshipStatus = '', bodyType = '', newlyAdded = False\nstatus = '', sortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:34,020 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:34,023 - routes - INFO - \ud83d\udd0d Search request - keyword: 'Engineer', status: '', page: 1, limit: 20\n2025-10-13 09:42:34,023 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'Engineer', '$options': 'i'}}, {'lastName': {'$regex': 'Engineer', '$options': 'i'}}, {'username': {'$regex': 'Engineer', '$options': 'i'}}, {'location': {'$regex': 'Engineer', '$options': 'i'}}, {'education': {'$regex': 'Engineer', '$options': 'i'}}, {'occupation': {'$regex': 'Engineer', '$options': 'i'}}, {'aboutYou': {'$regex': 'Engineer', '$options': 'i'}}, {'bio': {'$regex': 'Engineer', '$options': 'i'}}, {'interests': {'$regex': 'Engineer', '$options': 'i'}}], 'sex': 'Male', 'dob': {'$lte': '1985-10-13', '$gte': '2000-10-13'}, 'height': {'$gte': 66, '$lte': 72}, 'location': {'$regex': 'New York', '$options': 'i'}, 'education': \"Bachelor's\", 'religion': 'Christian'}\n2025-10-13 09:42:34,024 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:34,024 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: 'Engineer', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'Engineer', '$options': 'i'}}, {'lastName': {'$regex': 'Engineer', '$options': 'i'}}, {'username': {'$regex': 'Engineer', '$options': 'i'}}, {'location': {'$regex': 'Engineer', '$options': 'i'}}, {'education': {'$regex': 'Engineer', '$options': 'i'}}, {'occupation': {'$regex': 'Engineer', '$options': 'i'}}, {'aboutYou': {'$regex': 'Engineer', '$options': 'i'}}, {'bio': {'$regex': 'Engineer', '$options': 'i'}}, {'interests': {'$regex': 'Engineer', '$options': 'i'}}], 'sex': 'Male', 'dob': {'$lte': '1985-10-13', '$gte': '2000-10-13'}, 'height': {'$gte': 66, '$lte': 72}, 'location': {'$regex': 'New York', '$options': 'i'}, 'education': \"Bachelor's\", 'religion': 'Christian'}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n__________________ TestPagination.test_search_with_pagination __________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 368, in test_search_with_pagination\n    |     response = client.get(\"/api/users/search?page=1&limit=2\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestPagination object at 0x107d60bf0>\nsearch_test_users = [{'_id': ObjectId('68ed2bfb07cd87bd4dd2ac9f'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bfb07cd87bd4dd2aca3'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_with_pagination(self, search_test_users):\n        \"\"\"Test paginated search results\"\"\"\n>       response = client.get(\"/api/users/search?page=1&limit=2\")\n\ntests/test_search.py:368: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 0\nlocation = '', education = '', occupation = '', religion = '', caste = ''\neatingPreference = '', drinking = '', smoking = '', relationshipStatus = ''\nbodyType = '', newlyAdded = False, status = '', sortBy = 'newest'\nsortOrder = 'desc', page = 1, limit = 2\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:35,393 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:35,396 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 2\n2025-10-13 09:42:35,396 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}}\n2025-10-13 09:42:35,397 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:35,400 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.007s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 2\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.007s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n______________________ TestPagination.test_search_page_2 _______________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 377, in test_search_page_2\n    |     response = client.get(\"/api/users/search?page=2&limit=2\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestPagination object at 0x107d606b0>\nsearch_test_users = [{'_id': ObjectId('68ed2bfc07cd87bd4dd2aca5'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bfc07cd87bd4dd2aca9'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_page_2(self, search_test_users):\n        \"\"\"Test retrieving second page of results\"\"\"\n>       response = client.get(\"/api/users/search?page=2&limit=2\")\n\ntests/test_search.py:377: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 0\nlocation = '', education = '', occupation = '', religion = '', caste = ''\neatingPreference = '', drinking = '', smoking = '', relationshipStatus = ''\nbodyType = '', newlyAdded = False, status = '', sortBy = 'newest'\nsortOrder = 'desc', page = 2, limit = 2\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:36,969 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:36,972 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 2, limit: 2\n2025-10-13 09:42:36,972 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}}\n2025-10-13 09:42:36,973 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:36,974 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 2, limit: 2\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_______________ TestPagination.test_search_different_page_sizes ________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 385, in test_search_different_page_sizes\n    |     response1 = client.get(\"/api/users/search?limit=1\")\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestPagination object at 0x107d60860>\nsearch_test_users = [{'_id': ObjectId('68ed2bfe07cd87bd4dd2acab'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bfe07cd87bd4dd2acaf'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_different_page_sizes(self, search_test_users):\n        \"\"\"Test different page sizes\"\"\"\n>       response1 = client.get(\"/api/users/search?limit=1\")\n\ntests/test_search.py:385: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 0\nlocation = '', education = '', occupation = '', religion = '', caste = ''\neatingPreference = '', drinking = '', smoking = '', relationshipStatus = ''\nbodyType = '', newlyAdded = False, status = '', sortBy = 'newest'\nsortOrder = 'desc', page = 1, limit = 1\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:38,194 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:38,197 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 1\n2025-10-13 09:42:38,197 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}}\n2025-10-13 09:42:38,198 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:38,201 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.008s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 1\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.008s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n________________ TestPagination.test_search_invalid_page_number ________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 396, in test_search_invalid_page_number\n    |     response = client.get(\"/api/users/search?page=0\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestPagination object at 0x107d607a0>\nsearch_test_users = [{'_id': ObjectId('68ed2bff07cd87bd4dd2acb1'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2bff07cd87bd4dd2acb5'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_invalid_page_number(self, search_test_users):\n        \"\"\"Test invalid page number\"\"\"\n>       response = client.get(\"/api/users/search?page=0\")\n\ntests/test_search.py:396: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 0\nlocation = '', education = '', occupation = '', religion = '', caste = ''\neatingPreference = '', drinking = '', smoking = '', relationshipStatus = ''\nbodyType = '', newlyAdded = False, status = '', sortBy = 'newest'\nsortOrder = 'desc', page = 0, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:39,294 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:39,296 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 0, limit: 20\n2025-10-13 09:42:39,296 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}}\n2025-10-13 09:42:39,297 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:39,300 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.006s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 0, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.006s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n___________________ TestEmptyResults.test_search_no_matches ____________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 406, in test_search_no_matches\n    |     response = client.get(\"/api/users/search?keyword=NonexistentName\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestEmptyResults object at 0x107d60470>\nsearch_test_users = [{'_id': ObjectId('68ed2c0007cd87bd4dd2acb7'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2c0007cd87bd4dd2acbb'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_no_matches(self, search_test_users):\n        \"\"\"Test search that returns no results\"\"\"\n>       response = client.get(\"/api/users/search?keyword=NonexistentName\")\n\ntests/test_search.py:406: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = 'NonexistentName', gender = '', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:40,601 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:40,607 - routes - INFO - \ud83d\udd0d Search request - keyword: 'NonexistentName', status: '', page: 1, limit: 20\n2025-10-13 09:42:40,608 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'NonexistentName', '$options': 'i'}}, {'lastName': {'$regex': 'NonexistentName', '$options': 'i'}}, {'username': {'$regex': 'NonexistentName', '$options': 'i'}}, {'location': {'$regex': 'NonexistentName', '$options': 'i'}}, {'education': {'$regex': 'NonexistentName', '$options': 'i'}}, {'occupation': {'$regex': 'NonexistentName', '$options': 'i'}}, {'aboutYou': {'$regex': 'NonexistentName', '$options': 'i'}}, {'bio': {'$regex': 'NonexistentName', '$options': 'i'}}, {'interests': {'$regex': 'NonexistentName', '$options': 'i'}}]}\n2025-10-13 09:42:40,608 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:40,609 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.008s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: 'NonexistentName', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'NonexistentName', '$options': 'i'}}, {'lastName': {'$regex': 'NonexistentName', '$options': 'i'}}, {'username': {'$regex': 'NonexistentName', '$options': 'i'}}, {'location': {'$regex': 'NonexistentName', '$options': 'i'}}, {'education': {'$regex': 'NonexistentName', '$options': 'i'}}, {'occupation': {'$regex': 'NonexistentName', '$options': 'i'}}, {'aboutYou': {'$regex': 'NonexistentName', '$options': 'i'}}, {'bio': {'$regex': 'NonexistentName', '$options': 'i'}}, {'interests': {'$regex': 'NonexistentName', '$options': 'i'}}]}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.008s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_______________ TestEmptyResults.test_search_impossible_filters ________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 415, in test_search_impossible_filters\n    |     response = client.get(\n    |                ^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestEmptyResults object at 0x107d60410>\nsearch_test_users = [{'_id': ObjectId('68ed2c0107cd87bd4dd2acbd'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2c0107cd87bd4dd2acc1'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_impossible_filters(self, search_test_users):\n        \"\"\"Test search with impossible filter combination\"\"\"\n>       response = client.get(\n            \"/api/users/search?gender=Male&occupation=NonexistentJob\"\n        )\n\ntests/test_search.py:415: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = 'Male', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = 'NonexistentJob'\nreligion = '', caste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:41,911 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:41,913 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:41,913 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'sex': 'Male', 'occupation': 'NonexistentJob'}\n2025-10-13 09:42:41,914 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:41,915 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.004s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, 'sex': 'Male', 'occupation': 'NonexistentJob'}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.004s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_____________ TestSearchPerformance.test_search_with_many_results ______________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 429, in test_search_with_many_results\n    |     response = client.get(\"/api/users/search?limit=200\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestSearchPerformance object at 0x107cd82c0>\nsearch_test_users = [{'_id': ObjectId('68ed2c0207cd87bd4dd2acc3'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2c0207cd87bd4dd2acc7'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    @pytest.mark.slow\n    def test_search_with_many_results(self, search_test_users):\n        \"\"\"Test search performance with many results\"\"\"\n>       response = client.get(\"/api/users/search?limit=200\")\n\ntests/test_search.py:429: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 0\nlocation = '', education = '', occupation = '', religion = '', caste = ''\neatingPreference = '', drinking = '', smoking = '', relationshipStatus = ''\nbodyType = '', newlyAdded = False, status = '', sortBy = 'newest'\nsortOrder = 'desc', page = 1, limit = 200\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:43,167 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:43,170 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 200\n2025-10-13 09:42:43,171 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}}\n2025-10-13 09:42:43,171 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:43,172 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.006s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 200\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.006s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n____________ TestSearchPerformance.test_complex_search_performance _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 437, in test_complex_search_performance\n    |     response = client.get(\n    |                ^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestSearchPerformance object at 0x107cd9940>\nsearch_test_users = [{'_id': ObjectId('68ed2c0407cd87bd4dd2acc9'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2c0407cd87bd4dd2accd'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    @pytest.mark.slow\n    def test_complex_search_performance(self, search_test_users):\n        \"\"\"Test performance of complex multi-filter search\"\"\"\n>       response = client.get(\n            \"/api/users/search?\"\n            \"keyword=test&\"\n            \"gender=Male&\"\n            \"ageMin=25&ageMax=45&\"\n            \"location=USA\"\n        )\n\ntests/test_search.py:437: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = 'test', gender = 'Male', ageMin = 25, ageMax = 45, heightMin = 0\nheightMax = 0, location = 'USA', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:44,445 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:44,450 - routes - INFO - \ud83d\udd0d Search request - keyword: 'test', status: '', page: 1, limit: 20\n2025-10-13 09:42:44,450 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'test', '$options': 'i'}}, {'lastName': {'$regex': 'test', '$options': 'i'}}, {'username': {'$regex': 'test', '$options': 'i'}}, {'location': {'$regex': 'test', '$options': 'i'}}, {'education': {'$regex': 'test', '$options': 'i'}}, {'occupation': {'$regex': 'test', '$options': 'i'}}, {'aboutYou': {'$regex': 'test', '$options': 'i'}}, {'bio': {'$regex': 'test', '$options': 'i'}}, {'interests': {'$regex': 'test', '$options': 'i'}}], 'sex': 'Male', 'dob': {'$lte': '1980-10-13', '$gte': '2000-10-13'}, 'location': {'$regex': 'USA', '$options': 'i'}}\n2025-10-13 09:42:44,451 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:44,452 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.008s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: 'test', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'test', '$options': 'i'}}, {'lastName': {'$regex': 'test', '$options': 'i'}}, {'username': {'$regex': 'test', '$options': 'i'}}, {'location': {'$regex': 'test', '$options': 'i'}}, {'education': {'$regex': 'test', '$options': 'i'}}, {'occupation': {'$regex': 'test', '$options': 'i'}}, {'aboutYou': {'$regex': 'test', '$options': 'i'}}, {'bio': {'$regex': 'test', '$options': 'i'}}, {'interests': {'$regex': 'test', '$options': 'i'}}], 'sex': 'Male', 'dob': {'$lte': '1980-10-13', '$gte': '2000-10-13'}, 'location': {'$regex': 'USA', '$options': 'i'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.008s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n___________ TestSearchEdgeCases.test_search_with_special_characters ____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 453, in test_search_with_special_characters\n    |     response = client.get(\"/api/users/search?keyword=<script>alert('xss')</script>\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestSearchEdgeCases object at 0x107cd82f0>\nsearch_test_users = [{'_id': ObjectId('68ed2c0507cd87bd4dd2accf'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2c0507cd87bd4dd2acd3'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_with_special_characters(self, search_test_users):\n        \"\"\"Test search with special characters in keyword\"\"\"\n>       response = client.get(\"/api/users/search?keyword=<script>alert('xss')</script>\")\n\ntests/test_search.py:453: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = \"<script>alert('xss')</script>\", gender = '', ageMin = 0, ageMax = 0\nheightMin = 0, heightMax = 0, location = '', education = '', occupation = ''\nreligion = '', caste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:45,645 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:45,649 - routes - INFO - \ud83d\udd0d Search request - keyword: '<script>alert('xss')</script>', status: '', page: 1, limit: 20\n2025-10-13 09:42:45,649 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'lastName': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'username': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'location': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'education': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'occupation': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'aboutYou': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'bio': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'interests': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}]}\n2025-10-13 09:42:45,650 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:45,651 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.006s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '<script>alert('xss')</script>', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'lastName': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'username': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'location': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'education': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'occupation': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'aboutYou': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'bio': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}, {'interests': {'$regex': \"<script>alert('xss')</script>\", '$options': 'i'}}]}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.006s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n____________ TestSearchEdgeCases.test_search_with_very_long_keyword ____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 461, in test_search_with_very_long_keyword\n    |     response = client.get(f\"/api/users/search?keyword={long_keyword}\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestSearchEdgeCases object at 0x107cd8440>\nsearch_test_users = [{'_id': ObjectId('68ed2c0607cd87bd4dd2acd5'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2c0607cd87bd4dd2acd9'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_with_very_long_keyword(self, search_test_users):\n        \"\"\"Test search with extremely long keyword\"\"\"\n        long_keyword = \"a\" * 1000\n>       response = client.get(f\"/api/users/search?keyword={long_keyword}\")\n\ntests/test_search.py:461: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa...aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa'\ngender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 0, location = ''\neducation = '', occupation = '', religion = '', caste = ''\neatingPreference = '', drinking = '', smoking = '', relationshipStatus = ''\nbodyType = '', newlyAdded = False, status = '', sortBy = 'newest'\nsortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:46,762 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:46,768 - routes - INFO - \ud83d\udd0d Search request - keyword: 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', status: '', page: 1, limit: 20\n2025-10-13 09:42:46,768 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'lastName': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'username': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'location': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'education': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'occupation': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'aboutYou': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'bio': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'interests': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}]}\n2025-10-13 09:42:46,769 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:46,770 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.008s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'lastName': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'username': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'location': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'education': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'occupation': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'aboutYou': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'bio': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}, {'interests': {'$regex': 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa', '$options': 'i'}}]}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.008s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n__________ TestSearchEdgeCases.test_search_with_sql_injection_attempt __________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 468, in test_search_with_sql_injection_attempt\n    |     response = client.get(\"/api/users/search?keyword=' OR '1'='1\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestSearchEdgeCases object at 0x107d60770>\nsearch_test_users = [{'_id': ObjectId('68ed2c0707cd87bd4dd2acdb'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2c0707cd87bd4dd2acdf'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_with_sql_injection_attempt(self, search_test_users):\n        \"\"\"Test search with SQL injection attempt\"\"\"\n>       response = client.get(\"/api/users/search?keyword=' OR '1'='1\")\n\ntests/test_search.py:468: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = \"' OR '1'='1\", gender = '', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:48,020 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:48,023 - routes - INFO - \ud83d\udd0d Search request - keyword: '' OR '1'='1', status: '', page: 1, limit: 20\n2025-10-13 09:42:48,023 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'lastName': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'username': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'location': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'education': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'occupation': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'aboutYou': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'bio': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'interests': {'$regex': \"' OR '1'='1\", '$options': 'i'}}]}\n2025-10-13 09:42:48,023 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:48,024 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.004s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '' OR '1'='1', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'lastName': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'username': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'location': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'education': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'occupation': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'aboutYou': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'bio': {'$regex': \"' OR '1'='1\", '$options': 'i'}}, {'interests': {'$regex': \"' OR '1'='1\", '$options': 'i'}}]}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.004s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n____________ TestSearchEdgeCases.test_search_with_empty_parameters _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 475, in test_search_with_empty_parameters\n    |     response = client.get(\"/api/users/search?keyword=&gender=\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestSearchEdgeCases object at 0x107cd8200>\nsearch_test_users = [{'_id': ObjectId('68ed2c0907cd87bd4dd2ace1'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2c0907cd87bd4dd2ace5'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_with_empty_parameters(self, search_test_users):\n        \"\"\"Test search with empty parameter values\"\"\"\n>       response = client.get(\"/api/users/search?keyword=&gender=\")\n\ntests/test_search.py:475: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = '', gender = '', ageMin = 0, ageMax = 0, heightMin = 0, heightMax = 0\nlocation = '', education = '', occupation = '', religion = '', caste = ''\neatingPreference = '', drinking = '', smoking = '', relationshipStatus = ''\nbodyType = '', newlyAdded = False, status = '', sortBy = 'newest'\nsortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:49,424 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:49,427 - routes - INFO - \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\n2025-10-13 09:42:49,427 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}}\n2025-10-13 09:42:49,428 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:49,429 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: '', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.005s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n__________ TestSearchIntegration.test_search_to_profile_view_workflow __________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py\", line 486, in test_search_to_profile_view_workflow\n    |     search_response = client.get(\"/api/users/search?keyword=John\")\n    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 502, in get\n    |     return super().get(\n    |            ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1055, in get\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    |     status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_search.TestSearchIntegration object at 0x107cda2d0>\nsearch_test_users = [{'_id': ObjectId('68ed2c0a07cd87bd4dd2ace7'), 'dob': '1990-01-15', 'eatingPreference': 'Non-Veg', 'education': \"Bache...ctId('68ed2c0a07cd87bd4dd2aceb'), 'dob': '1985-12-05', 'eatingPreference': 'Eggetarian', 'education': \"Master's\", ...}]\n\n    def test_search_to_profile_view_workflow(self, search_test_users):\n        \"\"\"Test complete workflow from search to profile view\"\"\"\n        # Search for user\n>       search_response = client.get(\"/api/users/search?keyword=John\")\n\ntests/test_search.py:486: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:502: in get\n    return super().get(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1055: in get\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nkeyword = 'John', gender = '', ageMin = 0, ageMax = 0, heightMin = 0\nheightMax = 0, location = '', education = '', occupation = '', religion = ''\ncaste = '', eatingPreference = '', drinking = '', smoking = ''\nrelationshipStatus = '', bodyType = '', newlyAdded = False, status = ''\nsortBy = 'newest', sortOrder = 'desc', page = 1, limit = 20\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.get(\"/search\")\n    async def search_users(\n        keyword: str = \"\",\n        gender: str = \"\",\n        ageMin: int = 0,\n        ageMax: int = 0,\n        heightMin: int = 0,\n        heightMax: int = 0,\n        location: str = \"\",\n        education: str = \"\",\n        occupation: str = \"\",\n        religion: str = \"\",\n        caste: str = \"\",\n        eatingPreference: str = \"\",\n        drinking: str = \"\",\n        smoking: str = \"\",\n        relationshipStatus: str = \"\",\n        bodyType: str = \"\",\n        newlyAdded: bool = False,\n        status: str = \"\",\n        sortBy: str = \"newest\",\n        sortOrder: str = \"desc\",\n        page: int = 1,\n        limit: int = 20,\n        db = Depends(get_database)\n    ):\n        \"\"\"Advanced search for users with filters\"\"\"\n        logger.info(f\"\ud83d\udd0d Search request - keyword: '{keyword}', status: '{status}', page: {page}, limit: {limit}\")\n    \n        # Build query\n        query = {}\n    \n        # Status filter - only show active users by default\n        if status:\n            query[\"status.status\"] = {\"$regex\": f\"^{status}$\", \"$options\": \"i\"}\n        else:\n            # Default to active users only if no status specified\n            query[\"status.status\"] = {\"$regex\": \"^active$\", \"$options\": \"i\"}\n    \n        # Text search\n        if keyword:\n            query[\"$or\"] = [\n                {\"firstName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"lastName\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"username\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"location\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"education\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"occupation\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"aboutYou\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"bio\": {\"$regex\": keyword, \"$options\": \"i\"}},\n                {\"interests\": {\"$regex\": keyword, \"$options\": \"i\"}}\n            ]\n    \n        # Gender filter\n        if gender:\n            query[\"sex\"] = gender\n    \n        # Age filter\n        if ageMin > 0 or ageMax > 0:\n            from datetime import datetime, timedelta\n            now = datetime.now()\n    \n            if ageMax > 0:\n                max_date = now - timedelta(days=ageMax * 365.25)\n                query[\"dob\"] = {\"$lte\": max_date.strftime(\"%Y-%m-%d\")}\n    \n            if ageMin > 0:\n                min_date = now - timedelta(days=ageMin * 365.25)\n                if \"dob\" in query:\n                    query[\"dob\"][\"$gte\"] = min_date.strftime(\"%Y-%m-%d\")\n                else:\n                    query[\"dob\"] = {\"$gte\": min_date.strftime(\"%Y-%m-%d\")}\n    \n        # Height filter\n        if heightMin > 0 or heightMax > 0:\n            height_query = {}\n            if heightMin > 0:\n                height_query[\"$gte\"] = heightMin\n            if heightMax > 0:\n                height_query[\"$lte\"] = heightMax\n            query[\"height\"] = height_query\n    \n        # Other filters\n        if location:\n            query[\"location\"] = {\"$regex\": location, \"$options\": \"i\"}\n        if education:\n            query[\"education\"] = education\n        if occupation:\n            query[\"occupation\"] = occupation\n        if religion:\n            query[\"religion\"] = religion\n        if caste:\n            query[\"castePreference\"] = caste\n        if eatingPreference:\n            query[\"eatingPreference\"] = eatingPreference\n        if drinking:\n            query[\"drinking\"] = drinking\n        if smoking:\n            query[\"smoking\"] = smoking\n        if relationshipStatus:\n            query[\"relationshipStatus\"] = relationshipStatus\n        if bodyType:\n            query[\"bodyType\"] = bodyType\n    \n        # Newly added filter (last 7 days)\n        if newlyAdded:\n            from datetime import datetime, timedelta\n            seven_days_ago = datetime.now() - timedelta(days=7)\n            query[\"createdAt\"] = {\"$gte\": seven_days_ago.isoformat()}\n    \n        # Sort options\n        sort_options = {\n            \"newest\": [(\"createdAt\", -1)],\n            \"oldest\": [(\"createdAt\", 1)],\n            \"name\": [(\"firstName\", 1)],\n            \"age\": [(\"dob\", -1)],\n            \"location\": [(\"location\", 1)]\n        }\n    \n        sort = sort_options.get(sortBy, sort_options[\"newest\"])\n        if sortOrder == \"asc\":\n            sort = [(field, 1) if direction == -1 else (field, -1) for field, direction in sort]\n    \n        # Calculate skip for pagination\n        skip = (page - 1) * limit\n    \n        try:\n            # Execute search\n            logger.info(f\"\ud83d\udd0d Executing search with query: {query}\")\n            users_cursor = db.users.find(query).sort(sort).skip(skip).limit(limit)\n            users = await users_cursor.to_list(length=limit)\n    \n            # Get total count for pagination\n            total = await db.users.count_documents(query)\n    \n            # Remove sensitive data\n            for user in users:\n                user.pop(\"password\", None)\n                user.pop(\"_id\", None)\n                # Remove consent metadata (backend-only fields)\n                remove_consent_metadata(user)\n                user[\"images\"] = [get_full_image_url(img) for img in user.get(\"images\", [])]\n    \n            logger.info(f\"\u2705 Search completed - found {len(users)} users (total: {total})\")\n            return {\n                \"users\": users,\n                \"total\": total,\n                \"page\": page,\n                \"limit\": limit,\n                \"totalPages\": (total + limit - 1) // limit\n            }\n        except Exception as e:\n            logger.error(f\"\u274c Search execution error: {e}\", exc_info=True)\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Search failed: {str(e)}\"\n            )\nE           AttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\nroutes.py:1268: AttributeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:50,814 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/search\n2025-10-13 09:42:50,820 - routes - INFO - \ud83d\udd0d Search request - keyword: 'John', status: '', page: 1, limit: 20\n2025-10-13 09:42:50,821 - routes - INFO - \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'John', '$options': 'i'}}, {'lastName': {'$regex': 'John', '$options': 'i'}}, {'username': {'$regex': 'John', '$options': 'i'}}, {'location': {'$regex': 'John', '$options': 'i'}}, {'education': {'$regex': 'John', '$options': 'i'}}, {'occupation': {'$regex': 'John', '$options': 'i'}}, {'aboutYou': {'$regex': 'John', '$options': 'i'}}, {'bio': {'$regex': 'John', '$options': 'i'}}, {'interests': {'$regex': 'John', '$options': 'i'}}]}\n2025-10-13 09:42:50,823 - routes - ERROR - \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n2025-10-13 09:42:50,826 - main - ERROR - \u274c Error processing GET /api/users/search - Duration: 0.012s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/search\nINFO     routes:routes.py:1141 \ud83d\udd0d Search request - keyword: 'John', status: '', page: 1, limit: 20\nINFO     routes:routes.py:1242 \ud83d\udd0d Executing search with query: {'status.status': {'$regex': '^active$', '$options': 'i'}, '$or': [{'firstName': {'$regex': 'John', '$options': 'i'}}, {'lastName': {'$regex': 'John', '$options': 'i'}}, {'username': {'$regex': 'John', '$options': 'i'}}, {'location': {'$regex': 'John', '$options': 'i'}}, {'education': {'$regex': 'John', '$options': 'i'}}, {'occupation': {'$regex': 'John', '$options': 'i'}}, {'aboutYou': {'$regex': 'John', '$options': 'i'}}, {'bio': {'$regex': 'John', '$options': 'i'}}, {'interests': {'$regex': 'John', '$options': 'i'}}]}\nERROR    routes:routes.py:1266 \u274c Search execution error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1244, in search_users\n    users = await users_cursor.to_list(length=limit)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\nERROR    main:main.py:120 \u274c Error processing GET /api/users/search - Duration: 0.012s - Error: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1268, in search_users\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'str' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n_________________ TestFavorites.test_add_to_favorites_success __________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 66, in test_add_to_favorites_success\n    |     response = client.post(\n    |                ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    |     existing = await db.favorites.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestFavorites object at 0x107cda9f0>\nclient = <starlette.testclient.TestClient object at 0x108cffe00>\ninteraction_users = [{'_id': ObjectId('68ed2c0c07cd87bd4dd2acf3'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c0c07cd87bd4dd2acf5'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_add_to_favorites_success(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test successfully adding user to favorites\"\"\"\n>       response = client.post(\n            \"/api/users/favorites/user_b?username=user_a\"\n        )\n\ntests/test_user_interactions.py:66: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/favorites/{target_username}\")\n    async def add_to_favorites(username: str, target_username: str, db = Depends(get_database)):\n        \"\"\"Add user to favorites\"\"\"\n        logger.info(f\"\u2b50 Adding {target_username} to {username}'s favorites\")\n    \n        # Check if already in favorites\n>       existing = await db.favorites.find_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1463: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:52,492 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\n2025-10-13 09:42:52,512 - routes - INFO - \u2b50 Adding user_b to user_a's favorites\n2025-10-13 09:42:52,520 - main - ERROR - \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.028s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\nINFO     routes:routes.py:1460 \u2b50 Adding user_b to user_a's favorites\nERROR    main:main.py:120 \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.028s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n_____________ TestFavorites.test_add_to_favorites_nonexistent_user _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 76, in test_add_to_favorites_nonexistent_user\n    |     response = client.post(\n    |                ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    |     existing = await db.favorites.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestFavorites object at 0x107cda900>\nclient = <starlette.testclient.TestClient object at 0x108cd40b0>\ninteraction_users = [{'_id': ObjectId('68ed2c0d07cd87bd4dd2acf7'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c0d07cd87bd4dd2acf9'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_add_to_favorites_nonexistent_user(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test adding non-existent user to favorites\"\"\"\n>       response = client.post(\n            \"/api/users/favorites/nonexistent?username=user_a\"\n        )\n\ntests/test_user_interactions.py:76: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'nonexistent'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/favorites/{target_username}\")\n    async def add_to_favorites(username: str, target_username: str, db = Depends(get_database)):\n        \"\"\"Add user to favorites\"\"\"\n        logger.info(f\"\u2b50 Adding {target_username} to {username}'s favorites\")\n    \n        # Check if already in favorites\n>       existing = await db.favorites.find_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1463: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:53,961 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/favorites/nonexistent\n2025-10-13 09:42:53,962 - routes - INFO - \u2b50 Adding nonexistent to user_a's favorites\n2025-10-13 09:42:53,968 - main - ERROR - \u274c Error processing POST /api/users/favorites/nonexistent - Duration: 0.007s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/favorites/nonexistent\nINFO     routes:routes.py:1460 \u2b50 Adding nonexistent to user_a's favorites\nERROR    main:main.py:120 \u274c Error processing POST /api/users/favorites/nonexistent - Duration: 0.007s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n___________________ TestFavorites.test_add_self_to_favorites ___________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 84, in test_add_self_to_favorites\n    |     response = client.post(\n    |                ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    |     existing = await db.favorites.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestFavorites object at 0x107cda4e0>\nclient = <starlette.testclient.TestClient object at 0x10965e120>\ninteraction_users = [{'_id': ObjectId('68ed2c0f07cd87bd4dd2acfb'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c0f07cd87bd4dd2acfd'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_add_self_to_favorites(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test that user cannot favorite themselves\"\"\"\n>       response = client.post(\n            \"/api/users/favorites/user_a?username=user_a\"\n        )\n\ntests/test_user_interactions.py:84: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_a'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/favorites/{target_username}\")\n    async def add_to_favorites(username: str, target_username: str, db = Depends(get_database)):\n        \"\"\"Add user to favorites\"\"\"\n        logger.info(f\"\u2b50 Adding {target_username} to {username}'s favorites\")\n    \n        # Check if already in favorites\n>       existing = await db.favorites.find_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1463: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:55,361 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/favorites/user_a\n2025-10-13 09:42:55,362 - routes - INFO - \u2b50 Adding user_a to user_a's favorites\n2025-10-13 09:42:55,364 - main - ERROR - \u274c Error processing POST /api/users/favorites/user_a - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/favorites/user_a\nINFO     routes:routes.py:1460 \u2b50 Adding user_a to user_a's favorites\nERROR    main:main.py:120 \u274c Error processing POST /api/users/favorites/user_a - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n____________________ TestFavorites.test_duplicate_favorite _____________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 94, in test_duplicate_favorite\n    |     response1 = client.post(\n    |                 ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    |     existing = await db.favorites.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestFavorites object at 0x107cda510>\nclient = <starlette.testclient.TestClient object at 0x1095cd9d0>\ninteraction_users = [{'_id': ObjectId('68ed2c1007cd87bd4dd2acff'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c1007cd87bd4dd2ad01'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_duplicate_favorite(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test adding same user to favorites twice\"\"\"\n        # First add\n>       response1 = client.post(\n            \"/api/users/favorites/user_b?username=user_a\"\n        )\n\ntests/test_user_interactions.py:94: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/favorites/{target_username}\")\n    async def add_to_favorites(username: str, target_username: str, db = Depends(get_database)):\n        \"\"\"Add user to favorites\"\"\"\n        logger.info(f\"\u2b50 Adding {target_username} to {username}'s favorites\")\n    \n        # Check if already in favorites\n>       existing = await db.favorites.find_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1463: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:56,659 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\n2025-10-13 09:42:56,660 - routes - INFO - \u2b50 Adding user_b to user_a's favorites\n2025-10-13 09:42:56,661 - main - ERROR - \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\nINFO     routes:routes.py:1460 \u2b50 Adding user_b to user_a's favorites\nERROR    main:main.py:120 \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n_______________ TestFavorites.test_remove_from_favorites_success _______________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 110, in test_remove_from_favorites_success\n    |     client.post(\"/api/users/favorites/user_b?username=user_a\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    |     existing = await db.favorites.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestFavorites object at 0x107cda030>\nclient = <starlette.testclient.TestClient object at 0x109182000>\ninteraction_users = [{'_id': ObjectId('68ed2c1107cd87bd4dd2ad03'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c1107cd87bd4dd2ad05'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_remove_from_favorites_success(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test successfully removing user from favorites\"\"\"\n        # First add\n>       client.post(\"/api/users/favorites/user_b?username=user_a\")\n\ntests/test_user_interactions.py:110: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/favorites/{target_username}\")\n    async def add_to_favorites(username: str, target_username: str, db = Depends(get_database)):\n        \"\"\"Add user to favorites\"\"\"\n        logger.info(f\"\u2b50 Adding {target_username} to {username}'s favorites\")\n    \n        # Check if already in favorites\n>       existing = await db.favorites.find_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1463: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:58,145 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\n2025-10-13 09:42:58,146 - routes - INFO - \u2b50 Adding user_b to user_a's favorites\n2025-10-13 09:42:58,152 - main - ERROR - \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.007s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\nINFO     routes:routes.py:1460 \u2b50 Adding user_b to user_a's favorites\nERROR    main:main.py:120 \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.007s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n________________ TestFavorites.test_remove_nonexistent_favorite ________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 120, in test_remove_nonexistent_favorite\n    |     response = client.delete(\"/api/users/favorites/user_b?username=user_a\")\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 700, in delete\n    |     return super().delete(\n    |            ^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1253, in delete\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1500, in remove_from_favorites\n    |     result = await db.favorites.delete_one({\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestFavorites object at 0x107cda1b0>\nclient = <starlette.testclient.TestClient object at 0x108d5ce60>\ninteraction_users = [{'_id': ObjectId('68ed2c1307cd87bd4dd2ad07'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c1307cd87bd4dd2ad09'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_remove_nonexistent_favorite(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test removing user that's not in favorites\"\"\"\n>       response = client.delete(\"/api/users/favorites/user_b?username=user_a\")\n\ntests/test_user_interactions.py:120: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:700: in delete\n    return super().delete(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1253: in delete\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ntarget_username = 'user_b', username = 'user_a'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.delete(\"/favorites/{target_username}\")\n    async def remove_from_favorites(target_username: str, username: str = Query(...), db = Depends(get_database)):\n        \"\"\"Remove user from favorites\"\"\"\n        logger.info(f\"\u2b50 Removing {target_username} from {username}'s favorites\")\n    \n>       result = await db.favorites.delete_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1500: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:42:59,463 - main - INFO - \ud83d\udce8 Incoming DELETE request to /api/users/favorites/user_b\n2025-10-13 09:42:59,465 - routes - INFO - \u2b50 Removing user_b from user_a's favorites\n2025-10-13 09:42:59,469 - main - ERROR - \u274c Error processing DELETE /api/users/favorites/user_b - Duration: 0.007s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1500, in remove_from_favorites\n    result = await db.favorites.delete_one({\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming DELETE request to /api/users/favorites/user_b\nINFO     routes:routes.py:1498 \u2b50 Removing user_b from user_a's favorites\nERROR    main:main.py:120 \u274c Error processing DELETE /api/users/favorites/user_b - Duration: 0.007s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1500, in remove_from_favorites\n    result = await db.favorites.delete_one({\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n____________________ TestFavorites.test_get_favorites_list _____________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 128, in test_get_favorites_list\n    |     client.post(\"/api/users/favorites/user_b?username=user_a\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    |     existing = await db.favorites.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestFavorites object at 0x107cd94f0>\nclient = <starlette.testclient.TestClient object at 0x10949e870>\ninteraction_users = [{'_id': ObjectId('68ed2c1407cd87bd4dd2ad0b'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c1407cd87bd4dd2ad0d'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_get_favorites_list(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test retrieving list of favorites\"\"\"\n        # Add multiple favorites\n>       client.post(\"/api/users/favorites/user_b?username=user_a\")\n\ntests/test_user_interactions.py:128: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/favorites/{target_username}\")\n    async def add_to_favorites(username: str, target_username: str, db = Depends(get_database)):\n        \"\"\"Add user to favorites\"\"\"\n        logger.info(f\"\u2b50 Adding {target_username} to {username}'s favorites\")\n    \n        # Check if already in favorites\n>       existing = await db.favorites.find_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1463: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:00,642 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\n2025-10-13 09:43:00,643 - routes - INFO - \u2b50 Adding user_b to user_a's favorites\n2025-10-13 09:43:00,644 - main - ERROR - \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\nINFO     routes:routes.py:1460 \u2b50 Adding user_b to user_a's favorites\nERROR    main:main.py:120 \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n_________________ TestShortlist.test_add_to_shortlist_success __________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 144, in test_add_to_shortlist_success\n    |     response = client.post(\n    |                ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1573, in add_to_shortlist\n    |     existing = await db.shortlists.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestShortlist object at 0x107cd95b0>\nclient = <starlette.testclient.TestClient object at 0x1093c35f0>\ninteraction_users = [{'_id': ObjectId('68ed2c1507cd87bd4dd2ad0f'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c1507cd87bd4dd2ad11'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_add_to_shortlist_success(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test successfully adding user to shortlist\"\"\"\n>       response = client.post(\n            \"/api/users/shortlist/user_b?username=user_a\"\n        )\n\ntests/test_user_interactions.py:144: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b', notes = None\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/shortlist/{target_username}\")\n    async def add_to_shortlist(\n        username: str,\n        target_username: str,\n        notes: Optional[str] = Form(None),\n        db = Depends(get_database)\n    ):\n        \"\"\"Add user to shortlist\"\"\"\n        logger.info(f\"\ud83d\udcdd Adding {target_username} to {username}'s shortlist\")\n    \n        # Check if already in shortlist\n>       existing = await db.shortlists.find_one({\n            \"userUsername\": username,\n            \"shortlistedUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1573: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:01,810 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/shortlist/user_b\n2025-10-13 09:43:01,811 - routes - INFO - \ud83d\udcdd Adding user_b to user_a's shortlist\n2025-10-13 09:43:01,813 - main - ERROR - \u274c Error processing POST /api/users/shortlist/user_b - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1573, in add_to_shortlist\n    existing = await db.shortlists.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/shortlist/user_b\nINFO     routes:routes.py:1570 \ud83d\udcdd Adding user_b to user_a's shortlist\nERROR    main:main.py:120 \u274c Error processing POST /api/users/shortlist/user_b - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1573, in add_to_shortlist\n    existing = await db.shortlists.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n_______________ TestShortlist.test_remove_from_shortlist_success _______________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 159, in test_remove_from_shortlist_success\n    |     client.post(\"/api/users/shortlist/user_b?username=user_a\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1573, in add_to_shortlist\n    |     existing = await db.shortlists.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestShortlist object at 0x107cd9130>\nclient = <starlette.testclient.TestClient object at 0x1093c3e60>\ninteraction_users = [{'_id': ObjectId('68ed2c1707cd87bd4dd2ad17'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c1707cd87bd4dd2ad19'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_remove_from_shortlist_success(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test successfully removing user from shortlist\"\"\"\n        # First add\n>       client.post(\"/api/users/shortlist/user_b?username=user_a\")\n\ntests/test_user_interactions.py:159: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b', notes = None\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/shortlist/{target_username}\")\n    async def add_to_shortlist(\n        username: str,\n        target_username: str,\n        notes: Optional[str] = Form(None),\n        db = Depends(get_database)\n    ):\n        \"\"\"Add user to shortlist\"\"\"\n        logger.info(f\"\ud83d\udcdd Adding {target_username} to {username}'s shortlist\")\n    \n        # Check if already in shortlist\n>       existing = await db.shortlists.find_one({\n            \"userUsername\": username,\n            \"shortlistedUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1573: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:03,512 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/shortlist/user_b\n2025-10-13 09:43:03,513 - routes - INFO - \ud83d\udcdd Adding user_b to user_a's shortlist\n2025-10-13 09:43:03,514 - main - ERROR - \u274c Error processing POST /api/users/shortlist/user_b - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1573, in add_to_shortlist\n    existing = await db.shortlists.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/shortlist/user_b\nINFO     routes:routes.py:1570 \ud83d\udcdd Adding user_b to user_a's shortlist\nERROR    main:main.py:120 \u274c Error processing POST /api/users/shortlist/user_b - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1573, in add_to_shortlist\n    existing = await db.shortlists.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n_______________________ TestShortlist.test_get_shortlist _______________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 169, in test_get_shortlist\n    |     client.post(\"/api/users/shortlist/user_b?username=user_a\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1573, in add_to_shortlist\n    |     existing = await db.shortlists.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestShortlist object at 0x107cd9640>\nclient = <starlette.testclient.TestClient object at 0x10949e2a0>\ninteraction_users = [{'_id': ObjectId('68ed2c1807cd87bd4dd2ad1b'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c1807cd87bd4dd2ad1d'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_get_shortlist(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test retrieving shortlist\"\"\"\n        # Add users to shortlist\n>       client.post(\"/api/users/shortlist/user_b?username=user_a\")\n\ntests/test_user_interactions.py:169: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b', notes = None\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/shortlist/{target_username}\")\n    async def add_to_shortlist(\n        username: str,\n        target_username: str,\n        notes: Optional[str] = Form(None),\n        db = Depends(get_database)\n    ):\n        \"\"\"Add user to shortlist\"\"\"\n        logger.info(f\"\ud83d\udcdd Adding {target_username} to {username}'s shortlist\")\n    \n        # Check if already in shortlist\n>       existing = await db.shortlists.find_one({\n            \"userUsername\": username,\n            \"shortlistedUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1573: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:04,612 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/shortlist/user_b\n2025-10-13 09:43:04,614 - routes - INFO - \ud83d\udcdd Adding user_b to user_a's shortlist\n2025-10-13 09:43:04,615 - main - ERROR - \u274c Error processing POST /api/users/shortlist/user_b - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1573, in add_to_shortlist\n    existing = await db.shortlists.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/shortlist/user_b\nINFO     routes:routes.py:1570 \ud83d\udcdd Adding user_b to user_a's shortlist\nERROR    main:main.py:120 \u274c Error processing POST /api/users/shortlist/user_b - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1573, in add_to_shortlist\n    existing = await db.shortlists.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n____________________ TestShortlist.test_duplicate_shortlist ____________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 182, in test_duplicate_shortlist\n    |     response1 = client.post(\"/api/users/shortlist/user_b?username=user_a\")\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1573, in add_to_shortlist\n    |     existing = await db.shortlists.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestShortlist object at 0x107cd8b30>\nclient = <starlette.testclient.TestClient object at 0x1080321b0>\ninteraction_users = [{'_id': ObjectId('68ed2c1907cd87bd4dd2ad1f'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c1907cd87bd4dd2ad21'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_duplicate_shortlist(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test adding same user to shortlist twice\"\"\"\n>       response1 = client.post(\"/api/users/shortlist/user_b?username=user_a\")\n\ntests/test_user_interactions.py:182: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b', notes = None\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/shortlist/{target_username}\")\n    async def add_to_shortlist(\n        username: str,\n        target_username: str,\n        notes: Optional[str] = Form(None),\n        db = Depends(get_database)\n    ):\n        \"\"\"Add user to shortlist\"\"\"\n        logger.info(f\"\ud83d\udcdd Adding {target_username} to {username}'s shortlist\")\n    \n        # Check if already in shortlist\n>       existing = await db.shortlists.find_one({\n            \"userUsername\": username,\n            \"shortlistedUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1573: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:05,850 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/shortlist/user_b\n2025-10-13 09:43:05,853 - routes - INFO - \ud83d\udcdd Adding user_b to user_a's shortlist\n2025-10-13 09:43:05,859 - main - ERROR - \u274c Error processing POST /api/users/shortlist/user_b - Duration: 0.009s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1573, in add_to_shortlist\n    existing = await db.shortlists.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/shortlist/user_b\nINFO     routes:routes.py:1570 \ud83d\udcdd Adding user_b to user_a's shortlist\nERROR    main:main.py:120 \u274c Error processing POST /api/users/shortlist/user_b - Duration: 0.009s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1573, in add_to_shortlist\n    existing = await db.shortlists.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n________________ TestExclusions.test_add_to_exclusions_success _________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 193, in test_add_to_exclusions_success\n    |     response = client.post(\n    |                ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    |     existing = await db.exclusions.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestExclusions object at 0x107cd9c10>\nclient = <starlette.testclient.TestClient object at 0x10908aa50>\ninteraction_users = [{'_id': ObjectId('68ed2c1b07cd87bd4dd2ad23'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c1b07cd87bd4dd2ad25'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_add_to_exclusions_success(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test successfully adding user to exclusions\"\"\"\n>       response = client.post(\n            \"/api/users/exclusions/user_b?username=user_a\"\n        )\n\ntests/test_user_interactions.py:193: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b', reason = None\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/exclusions/{target_username}\")\n    async def add_to_exclusions(\n        username: str,\n        target_username: str,\n        reason: Optional[str] = Form(None),\n        db = Depends(get_database)\n    ):\n        \"\"\"Add user to exclusions\"\"\"\n        logger.info(f\"\u274c Adding {target_username} to {username}'s exclusions\")\n    \n        # Check if already excluded\n>       existing = await db.exclusions.find_one({\n            \"userUsername\": username,\n            \"excludedUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1669: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:07,242 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/exclusions/user_b\n2025-10-13 09:43:07,243 - routes - INFO - \u274c Adding user_b to user_a's exclusions\n2025-10-13 09:43:07,244 - main - ERROR - \u274c Error processing POST /api/users/exclusions/user_b - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    existing = await db.exclusions.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/exclusions/user_b\nINFO     routes:routes.py:1666 \u274c Adding user_b to user_a's exclusions\nERROR    main:main.py:120 \u274c Error processing POST /api/users/exclusions/user_b - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    existing = await db.exclusions.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n______________ TestExclusions.test_remove_from_exclusions_success ______________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 207, in test_remove_from_exclusions_success\n    |     client.post(\"/api/users/exclusions/user_b?username=user_a\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    |     existing = await db.exclusions.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestExclusions object at 0x107cd8d70>\nclient = <starlette.testclient.TestClient object at 0x108cd7fe0>\ninteraction_users = [{'_id': ObjectId('68ed2c1c07cd87bd4dd2ad2b'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c1c07cd87bd4dd2ad2d'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_remove_from_exclusions_success(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test successfully removing user from exclusions (unblock)\"\"\"\n        # First add\n>       client.post(\"/api/users/exclusions/user_b?username=user_a\")\n\ntests/test_user_interactions.py:207: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b', reason = None\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/exclusions/{target_username}\")\n    async def add_to_exclusions(\n        username: str,\n        target_username: str,\n        reason: Optional[str] = Form(None),\n        db = Depends(get_database)\n    ):\n        \"\"\"Add user to exclusions\"\"\"\n        logger.info(f\"\u274c Adding {target_username} to {username}'s exclusions\")\n    \n        # Check if already excluded\n>       existing = await db.exclusions.find_one({\n            \"userUsername\": username,\n            \"excludedUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1669: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:08,595 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/exclusions/user_b\n2025-10-13 09:43:08,596 - routes - INFO - \u274c Adding user_b to user_a's exclusions\n2025-10-13 09:43:08,597 - main - ERROR - \u274c Error processing POST /api/users/exclusions/user_b - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    existing = await db.exclusions.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/exclusions/user_b\nINFO     routes:routes.py:1666 \u274c Adding user_b to user_a's exclusions\nERROR    main:main.py:120 \u274c Error processing POST /api/users/exclusions/user_b - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    existing = await db.exclusions.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n___________________ TestExclusions.test_get_exclusions_list ____________________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 217, in test_get_exclusions_list\n    |     client.post(\"/api/users/exclusions/user_b?username=user_a\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    |     existing = await db.exclusions.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestExclusions object at 0x107cd8b90>\nclient = <starlette.testclient.TestClient object at 0x10913b9e0>\ninteraction_users = [{'_id': ObjectId('68ed2c1d07cd87bd4dd2ad2f'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c1d07cd87bd4dd2ad31'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_get_exclusions_list(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test retrieving exclusions list\"\"\"\n        # Add exclusions\n>       client.post(\"/api/users/exclusions/user_b?username=user_a\")\n\ntests/test_user_interactions.py:217: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b', reason = None\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/exclusions/{target_username}\")\n    async def add_to_exclusions(\n        username: str,\n        target_username: str,\n        reason: Optional[str] = Form(None),\n        db = Depends(get_database)\n    ):\n        \"\"\"Add user to exclusions\"\"\"\n        logger.info(f\"\u274c Adding {target_username} to {username}'s exclusions\")\n    \n        # Check if already excluded\n>       existing = await db.exclusions.find_one({\n            \"userUsername\": username,\n            \"excludedUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1669: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:09,999 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/exclusions/user_b\n2025-10-13 09:43:10,002 - routes - INFO - \u274c Adding user_b to user_a's exclusions\n2025-10-13 09:43:10,013 - main - ERROR - \u274c Error processing POST /api/users/exclusions/user_b - Duration: 0.013s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    existing = await db.exclusions.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/exclusions/user_b\nINFO     routes:routes.py:1666 \u274c Adding user_b to user_a's exclusions\nERROR    main:main.py:120 \u274c Error processing POST /api/users/exclusions/user_b - Duration: 0.013s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    existing = await db.exclusions.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n_____________ TestExclusions.test_exclusion_affects_search_results _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 231, in test_exclusion_affects_search_results\n    |     client.post(\"/api/users/exclusions/user_b?username=user_a\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    |     existing = await db.exclusions.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestExclusions object at 0x107cd8ad0>\nclient = <starlette.testclient.TestClient object at 0x10941eab0>\ninteraction_users = [{'_id': ObjectId('68ed2c1f07cd87bd4dd2ad33'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c1f07cd87bd4dd2ad35'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_exclusion_affects_search_results(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test that excluded users don't appear in search results\"\"\"\n        # Add exclusion\n>       client.post(\"/api/users/exclusions/user_b?username=user_a\")\n\ntests/test_user_interactions.py:231: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b', reason = None\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/exclusions/{target_username}\")\n    async def add_to_exclusions(\n        username: str,\n        target_username: str,\n        reason: Optional[str] = Form(None),\n        db = Depends(get_database)\n    ):\n        \"\"\"Add user to exclusions\"\"\"\n        logger.info(f\"\u274c Adding {target_username} to {username}'s exclusions\")\n    \n        # Check if already excluded\n>       existing = await db.exclusions.find_one({\n            \"userUsername\": username,\n            \"excludedUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1669: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:11,343 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/exclusions/user_b\n2025-10-13 09:43:11,344 - routes - INFO - \u274c Adding user_b to user_a's exclusions\n2025-10-13 09:43:11,346 - main - ERROR - \u274c Error processing POST /api/users/exclusions/user_b - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    existing = await db.exclusions.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/exclusions/user_b\nINFO     routes:routes.py:1666 \u274c Adding user_b to user_a's exclusions\nERROR    main:main.py:120 \u274c Error processing POST /api/users/exclusions/user_b - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    existing = await db.exclusions.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n________________ TestGetTheirFavorites.test_get_their_favorites ________________\n\nself = <test_user_interactions.TestGetTheirFavorites object at 0x107cdb950>\nclient = <starlette.testclient.TestClient object at 0x109458c20>\ninteraction_users = [{'_id': ObjectId('68ed2c2007cd87bd4dd2ad37'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c2007cd87bd4dd2ad39'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\nsetup_their_favorites = [{'_id': ObjectId('68ed2c2007cd87bd4dd2ad3a'), 'createdAt': datetime.datetime(2025, 10, 13, 16, 43, 12, 811332), 'favo...eatedAt': datetime.datetime(2025, 10, 13, 16, 43, 12, 811367), 'favoriteUsername': 'user_a', 'userUsername': 'user_c'}]\ncleanup_interactions = None\n\n    def test_get_their_favorites(self, client, interaction_users, setup_their_favorites, cleanup_interactions):\n        \"\"\"Test getting list of users who favorited you\"\"\"\n        response = client.get(\"/api/users/their-favorites/user_a\")\n    \n>       assert response.status_code == 200\nE       assert 500 == 200\nE        +  where 500 = <Response [500 Internal Server Error]>.status_code\n\ntests/test_user_interactions.py:268: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:12,967 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/their-favorites/user_a\n2025-10-13 09:43:12,973 - routes - INFO - \ud83d\udc96 Getting users who favorited user_a\n2025-10-13 09:43:12,976 - routes - ERROR - \u274c Error getting users who favorited: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2483, in get_users_who_favorited_me\n    favorites = await db.favorites.find(\n                ^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\n2025-10-13 09:43:12,977 - main - INFO - \u274c GET /api/users/their-favorites/user_a - Status: 500 - Duration: 0.010s\n2025-10-13 09:43:12,980 - httpx - INFO - HTTP Request: GET http://testserver/api/users/their-favorites/user_a \"HTTP/1.1 500 Internal Server Error\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/their-favorites/user_a\nINFO     routes:routes.py:2479 \ud83d\udc96 Getting users who favorited user_a\nERROR    routes:routes.py:2512 \u274c Error getting users who favorited: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2483, in get_users_who_favorited_me\n    favorites = await db.favorites.find(\n                ^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nINFO     main:main.py:111 \u274c GET /api/users/their-favorites/user_a - Status: 500 - Duration: 0.010s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/users/their-favorites/user_a \"HTTP/1.1 500 Internal Server Error\"\n_______________ TestGetTheirShortlists.test_get_their_shortlists _______________\n\nself = <test_user_interactions.TestGetTheirShortlists object at 0x107cdbd40>\nclient = <starlette.testclient.TestClient object at 0x108cff440>\ninteraction_users = [{'_id': ObjectId('68ed2c2107cd87bd4dd2ad3d'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c2107cd87bd4dd2ad3f'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\nsetup_their_shortlists = [{'_id': ObjectId('68ed2c2107cd87bd4dd2ad40'), 'createdAt': datetime.datetime(2025, 10, 13, 16, 43, 13, 342130), 'notes': 'Interesting profile', 'shortlistedUsername': 'user_a', ...}]\ncleanup_interactions = None\n\n    def test_get_their_shortlists(self, client, interaction_users, setup_their_shortlists, cleanup_interactions):\n        \"\"\"Test getting list of users who shortlisted you\"\"\"\n        response = client.get(\"/api/users/their-shortlists/user_a\")\n    \n>       assert response.status_code == 200\nE       assert 500 == 200\nE        +  where 500 = <Response [500 Internal Server Error]>.status_code\n\ntests/test_user_interactions.py:299: AssertionError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:13,518 - main - INFO - \ud83d\udce8 Incoming GET request to /api/users/their-shortlists/user_a\n2025-10-13 09:43:13,523 - routes - INFO - \ud83d\udcdd Getting users who shortlisted user_a\n2025-10-13 09:43:13,526 - routes - ERROR - \u274c Error getting users who shortlisted: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2522, in get_users_who_shortlisted_me\n    shortlists = await db.shortlists.find(\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\n2025-10-13 09:43:13,527 - main - INFO - \u274c GET /api/users/their-shortlists/user_a - Status: 500 - Duration: 0.009s\n2025-10-13 09:43:13,530 - httpx - INFO - HTTP Request: GET http://testserver/api/users/their-shortlists/user_a \"HTTP/1.1 500 Internal Server Error\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming GET request to /api/users/their-shortlists/user_a\nINFO     routes:routes.py:2518 \ud83d\udcdd Getting users who shortlisted user_a\nERROR    routes:routes.py:2551 \u274c Error getting users who shortlisted: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 2522, in get_users_who_shortlisted_me\n    shortlists = await db.shortlists.find(\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending> attached to a different loop\nINFO     main:main.py:111 \u274c GET /api/users/their-shortlists/user_a - Status: 500 - Duration: 0.009s\nINFO     httpx:_client.py:1027 HTTP Request: GET http://testserver/api/users/their-shortlists/user_a \"HTTP/1.1 500 Internal Server Error\"\n______ TestCrossFeatureInteractions.test_favorite_and_shortlist_same_user ______\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 310, in test_favorite_and_shortlist_same_user\n    |     fav_response = client.post(\"/api/users/favorites/user_b?username=user_a\")\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    |     existing = await db.favorites.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestCrossFeatureInteractions object at 0x107d512e0>\nclient = <starlette.testclient.TestClient object at 0x1080321b0>\ninteraction_users = [{'_id': ObjectId('68ed2c2107cd87bd4dd2ad42'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c2107cd87bd4dd2ad44'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_favorite_and_shortlist_same_user(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test that user can be both favorited and shortlisted\"\"\"\n        # Add to favorites\n>       fav_response = client.post(\"/api/users/favorites/user_b?username=user_a\")\n\ntests/test_user_interactions.py:310: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/favorites/{target_username}\")\n    async def add_to_favorites(username: str, target_username: str, db = Depends(get_database)):\n        \"\"\"Add user to favorites\"\"\"\n        logger.info(f\"\u2b50 Adding {target_username} to {username}'s favorites\")\n    \n        # Check if already in favorites\n>       existing = await db.favorites.find_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1463: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:13,792 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\n2025-10-13 09:43:13,793 - routes - INFO - \u2b50 Adding user_b to user_a's favorites\n2025-10-13 09:43:13,795 - main - ERROR - \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\nINFO     routes:routes.py:1460 \u2b50 Adding user_b to user_a's favorites\nERROR    main:main.py:120 \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n___________ TestCrossFeatureInteractions.test_favorite_then_exclude ____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 322, in test_favorite_then_exclude\n    |     client.post(\"/api/users/favorites/user_b?username=user_a\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    |     existing = await db.favorites.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestCrossFeatureInteractions object at 0x107d52360>\nclient = <starlette.testclient.TestClient object at 0x108cfdd30>\ninteraction_users = [{'_id': ObjectId('68ed2c2207cd87bd4dd2ad46'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c2207cd87bd4dd2ad48'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_favorite_then_exclude(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test favoriting then excluding same user\"\"\"\n        # Add to favorites\n>       client.post(\"/api/users/favorites/user_b?username=user_a\")\n\ntests/test_user_interactions.py:322: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/favorites/{target_username}\")\n    async def add_to_favorites(username: str, target_username: str, db = Depends(get_database)):\n        \"\"\"Add user to favorites\"\"\"\n        logger.info(f\"\u2b50 Adding {target_username} to {username}'s favorites\")\n    \n        # Check if already in favorites\n>       existing = await db.favorites.find_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1463: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:14,971 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\n2025-10-13 09:43:14,972 - routes - INFO - \u2b50 Adding user_b to user_a's favorites\n2025-10-13 09:43:14,973 - main - ERROR - \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\nINFO     routes:routes.py:1460 \u2b50 Adding user_b to user_a's favorites\nERROR    main:main.py:120 \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n________ TestCrossFeatureInteractions.test_exclude_removes_from_search _________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 333, in test_exclude_removes_from_search\n    |     client.post(\"/api/users/exclusions/user_b?username=user_a\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    |     existing = await db.exclusions.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestCrossFeatureInteractions object at 0x107d50080>\nclient = <starlette.testclient.TestClient object at 0x1094590d0>\ninteraction_users = [{'_id': ObjectId('68ed2c2407cd87bd4dd2ad4a'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c2407cd87bd4dd2ad4c'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_exclude_removes_from_search(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test that excluding user removes them from search results\"\"\"\n        # Exclude user_b\n>       client.post(\"/api/users/exclusions/user_b?username=user_a\")\n\ntests/test_user_interactions.py:333: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b', reason = None\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/exclusions/{target_username}\")\n    async def add_to_exclusions(\n        username: str,\n        target_username: str,\n        reason: Optional[str] = Form(None),\n        db = Depends(get_database)\n    ):\n        \"\"\"Add user to exclusions\"\"\"\n        logger.info(f\"\u274c Adding {target_username} to {username}'s exclusions\")\n    \n        # Check if already excluded\n>       existing = await db.exclusions.find_one({\n            \"userUsername\": username,\n            \"excludedUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1669: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:16,294 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/exclusions/user_b\n2025-10-13 09:43:16,295 - routes - INFO - \u274c Adding user_b to user_a's exclusions\n2025-10-13 09:43:16,297 - main - ERROR - \u274c Error processing POST /api/users/exclusions/user_b - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    existing = await db.exclusions.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/exclusions/user_b\nINFO     routes:routes.py:1666 \u274c Adding user_b to user_a's exclusions\nERROR    main:main.py:120 \u274c Error processing POST /api/users/exclusions/user_b - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1669, in add_to_exclusions\n    existing = await db.exclusions.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n______ TestInteractionEdgeCases.test_multiple_users_favorite_same_profile ______\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 347, in test_multiple_users_favorite_same_profile\n    |     response1 = client.post(\"/api/users/favorites/user_c?username=user_a\")\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    |     existing = await db.favorites.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestInteractionEdgeCases object at 0x107d51c70>\nclient = <starlette.testclient.TestClient object at 0x109475c10>\ninteraction_users = [{'_id': ObjectId('68ed2c2507cd87bd4dd2ad4e'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c2507cd87bd4dd2ad50'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_multiple_users_favorite_same_profile(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test multiple users can favorite the same profile\"\"\"\n>       response1 = client.post(\"/api/users/favorites/user_c?username=user_a\")\n\ntests/test_user_interactions.py:347: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_c'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/favorites/{target_username}\")\n    async def add_to_favorites(username: str, target_username: str, db = Depends(get_database)):\n        \"\"\"Add user to favorites\"\"\"\n        logger.info(f\"\u2b50 Adding {target_username} to {username}'s favorites\")\n    \n        # Check if already in favorites\n>       existing = await db.favorites.find_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1463: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:17,611 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/favorites/user_c\n2025-10-13 09:43:17,612 - routes - INFO - \u2b50 Adding user_c to user_a's favorites\n2025-10-13 09:43:17,613 - main - ERROR - \u274c Error processing POST /api/users/favorites/user_c - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/favorites/user_c\nINFO     routes:routes.py:1460 \u2b50 Adding user_c to user_a's favorites\nERROR    main:main.py:120 \u274c Error processing POST /api/users/favorites/user_c - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n____________ TestInteractionEdgeCases.test_bidirectional_favorites _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 359, in test_bidirectional_favorites\n    |     response1 = client.post(\"/api/users/favorites/user_b?username=user_a\")\n    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    |     existing = await db.favorites.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestInteractionEdgeCases object at 0x107cd8c80>\nclient = <starlette.testclient.TestClient object at 0x108cff6e0>\ninteraction_users = [{'_id': ObjectId('68ed2c2607cd87bd4dd2ad52'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c2607cd87bd4dd2ad54'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_bidirectional_favorites(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test that both users can favorite each other\"\"\"\n>       response1 = client.post(\"/api/users/favorites/user_b?username=user_a\")\n\ntests/test_user_interactions.py:359: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/favorites/{target_username}\")\n    async def add_to_favorites(username: str, target_username: str, db = Depends(get_database)):\n        \"\"\"Add user to favorites\"\"\"\n        logger.info(f\"\u2b50 Adding {target_username} to {username}'s favorites\")\n    \n        # Check if already in favorites\n>       existing = await db.favorites.find_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1463: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:19,025 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\n2025-10-13 09:43:19,026 - routes - INFO - \u2b50 Adding user_b to user_a's favorites\n2025-10-13 09:43:19,028 - main - ERROR - \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\nINFO     routes:routes.py:1460 \u2b50 Adding user_b to user_a's favorites\nERROR    main:main.py:120 \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.003s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n____________ TestInteractionEdgeCases.test_remove_all_interactions _____________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py\", line 368, in test_remove_all_interactions\n    |     client.post(\"/api/users/favorites/user_b?username=user_a\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    |     existing = await db.favorites.find_one({\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_interactions.TestInteractionEdgeCases object at 0x107d51be0>\nclient = <starlette.testclient.TestClient object at 0x109414ce0>\ninteraction_users = [{'_id': ObjectId('68ed2c2807cd87bd4dd2ad56'), 'contactEmail': 'usera@test.com', 'firstName': 'User', 'lastName': 'A',...d': ObjectId('68ed2c2807cd87bd4dd2ad58'), 'contactEmail': 'userc@test.com', 'firstName': 'User', 'lastName': 'C', ...}]\ncleanup_interactions = None\n\n    def test_remove_all_interactions(self, client, interaction_users, cleanup_interactions):\n        \"\"\"Test removing all interactions with a user\"\"\"\n        # Add to all lists\n>       client.post(\"/api/users/favorites/user_b?username=user_a\")\n\ntests/test_user_interactions.py:368: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nusername = 'user_a', target_username = 'user_b'\ndb = AsyncIOMotorDatabase(Database(MongoClient(host=['localhost:27017'], document_class=dict, tz_aware=False, connect=False, driver=DriverInfo(name='Motor', version='3.5.1', platform='asyncio')), 'test_profiledata'))\n\n    @router.post(\"/favorites/{target_username}\")\n    async def add_to_favorites(username: str, target_username: str, db = Depends(get_database)):\n        \"\"\"Add user to favorites\"\"\"\n        logger.info(f\"\u2b50 Adding {target_username} to {username}'s favorites\")\n    \n        # Check if already in favorites\n>       existing = await db.favorites.find_one({\n            \"userUsername\": username,\n            \"favoriteUsername\": target_username\n        })\nE       RuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n\nroutes.py:1463: RuntimeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:20,742 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\n2025-10-13 09:43:20,743 - routes - INFO - \u2b50 Adding user_b to user_a's favorites\n2025-10-13 09:43:20,744 - main - ERROR - \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/favorites/user_b\nINFO     routes:routes.py:1460 \u2b50 Adding user_b to user_a's favorites\nERROR    main:main.py:120 \u274c Error processing POST /api/users/favorites/user_b - Duration: 0.002s - Error: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 1463, in add_to_favorites\n    existing = await db.favorites.find_one({\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nRuntimeError: Task <Task pending name='starlette.middleware.base.BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro' coro=<BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.coro() running at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py:151> cb=[TaskGroup._spawn.<locals>.task_done() at /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:803]> got Future <Future pending cb=[_chain_future.<locals>._call_check_cancel() at /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/futures.py:387]> attached to a different loop\n___________ TestUserActivation.test_admin_can_activate_pending_user ____________\n\nself = <test_user_status.TestUserActivation object at 0x107d523f0>\nmock_get_db = <MagicMock name='get_database' id='4447250496'>\nclient = <starlette.testclient.TestClient object at 0x1093fd130>\nmock_db = <MagicMock name='get_database()' id='4450146240'>\nmock_pending_user = {'_id': 'test_id_1', 'email': 'test@example.com', 'password': '$2b$12$hashedpassword', 'role_name': 'free_user', ...}\nadmin_token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc2MDM3NTYwMSwiaWF0IjoxNzYwMzczODAxLCJ0eXBlIjoiYWNjZXNzIn0.NDVS3sO8w_B_3fHq9Txuob_Wdlc734JUeLJyFrpVgAo'\n\n    @patch('database.get_database')\n    def test_admin_can_activate_pending_user(self, mock_get_db, client, mock_db, mock_pending_user, admin_token):\n        \"\"\"Test admin successfully activates a pending user\"\"\"\n        mock_get_db.return_value = mock_db\n        mock_db.users.find_one = AsyncMock(return_value=mock_pending_user)\n        mock_db.users.update_one = AsyncMock(return_value=MagicMock(modified_count=1))\n    \n        response = client.post(\n            f\"/api/admin/users/{mock_pending_user['username']}/activate\",\n            headers={\"Authorization\": f\"Bearer {admin_token}\"},\n            json={\"reason\": \"Profile complete\"}\n        )\n    \n>       assert response.status_code == 200\nE       assert 404 == 200\nE        +  where 404 = <Response [404 Not Found]>.status_code\n\ntests/test_user_status.py:119: AssertionError\n---------------------------- Captured stderr setup -----------------------------\n2025-10-13 09:43:21,904 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/login\n2025-10-13 09:43:21,906 - routes - INFO - \ud83d\udd11 Login attempt for username: admin\n2025-10-13 09:43:21,906 - routes - INFO - \ud83d\udd10 Admin login attempt detected\n2025-10-13 09:43:21,906 - routes - INFO - \u2705 Admin login successful (hardcoded credentials)\n2025-10-13 09:43:21,907 - main - INFO - \u2705 POST /api/users/login - Status: 200 - Duration: 0.004s\n2025-10-13 09:43:21,909 - httpx - INFO - HTTP Request: POST http://testserver/api/users/login \"HTTP/1.1 200 OK\"\n------------------------------ Captured log setup ------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/login\nINFO     routes:routes.py:377 \ud83d\udd11 Login attempt for username: admin\nINFO     routes:routes.py:381 \ud83d\udd10 Admin login attempt detected\nINFO     routes:routes.py:388 \u2705 Admin login successful (hardcoded credentials)\nINFO     main:main.py:111 \u2705 POST /api/users/login - Status: 200 - Duration: 0.004s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/users/login \"HTTP/1.1 200 OK\"\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:21,913 - main - INFO - \ud83d\udce8 Incoming POST request to /api/admin/users/testuser/activate\n2025-10-13 09:43:21,915 - main - INFO - \u274c POST /api/admin/users/testuser/activate - Status: 404 - Duration: 0.002s\n2025-10-13 09:43:21,920 - httpx - INFO - HTTP Request: POST http://testserver/api/admin/users/testuser/activate \"HTTP/1.1 404 Not Found\"\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/admin/users/testuser/activate\nINFO     main:main.py:111 \u274c POST /api/admin/users/testuser/activate - Status: 404 - Duration: 0.002s\nINFO     httpx:_client.py:1027 HTTP Request: POST http://testserver/api/admin/users/testuser/activate \"HTTP/1.1 404 Not Found\"\n_________ TestMenuAccessControl.test_pending_user_login_returns_status _________\n  + Exception Group Traceback (most recent call last):\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 85, in collapse_excgroups\n  |     yield\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 190, in __call__\n  |     async with anyio.create_task_group() as task_group:\n  |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py\", line 781, in __aexit__\n  |     raise BaseExceptionGroup(\n  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)\n  +-+---------------- 1 ----------------\n    | Traceback (most recent call last):\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 345, in from_call\n    |     result: Optional[TResult] = func()\n    |                                 ^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 266, in <lambda>\n    |     lambda: ihook(item=item, **kwds), when=when, reraise=reraise\n    |             ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 87, in pytest_runtest_call\n    |     yield from thread_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/threadexception.py\", line 63, in thread_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 90, in pytest_runtest_call\n    |     yield from unraisable_exception_runtest_hook()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/unraisableexception.py\", line 65, in unraisable_exception_runtest_hook\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 839, in pytest_runtest_call\n    |     yield from self._runtest_for(item, \"call\")\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/logging.py\", line 822, in _runtest_for\n    |     yield\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/capture.py\", line 882, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    |     return (yield)\n    |             ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 181, in pytest_runtest_call\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/runner.py\", line 173, in pytest_runtest_call\n    |     item.runtest()\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 1836, in runtest\n    |     self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_hooks.py\", line 512, in __call__\n    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    |     raise exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 139, in _multicall\n    |     teardown.throw(exception)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 53, in run_old_style_hookwrapper\n    |     return result.get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_result.py\", line 103, in get_result\n    |     raise exc.with_traceback(tb)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 38, in run_old_style_hookwrapper\n    |     res = yield\n    |           ^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pluggy/_callers.py\", line 121, in _multicall\n    |     res = hook_impl.function(*args)\n    |           ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py\", line 193, in pytest_pyfunc_call\n    |     result = testfunction(**testargs)\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_status.py\", line 183, in test_pending_user_login_returns_status\n    |     response = client.post(\n    |                ^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 593, in post\n    |     return super().post(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1146, in post\n    |     return self.request(\n    |            ^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 468, in request\n    |     return super().request(\n    |            ^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 828, in request\n    |     return self.send(request, auth=auth, follow_redirects=follow_redirects)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 915, in send\n    |     response = self._send_handling_auth(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 943, in _send_handling_auth\n    |     response = self._send_handling_redirects(\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 980, in _send_handling_redirects\n    |     response = self._send_single_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_client.py\", line 1016, in _send_single_request\n    |     response = transport.handle_request(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 344, in handle_request\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/testclient.py\", line 341, in handle_request\n    |     portal.call(self.app, scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 321, in call\n    |     return cast(T_Retval, self.start_task_soon(func, *args).result())\n    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 456, in result\n    |     return self.__get_result()\n    |            ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py\", line 401, in __get_result\n    |     raise self._exception\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/from_thread.py\", line 252, in _call_func\n    |     retval = await retval_or_awaitable\n    |              ^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/applications.py\", line 1054, in __call__\n    |     await super().__call__(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/applications.py\", line 123, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 186, in __call__\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    |     await self.app(scope, receive, _send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    |     with collapse_excgroups():\n    |   File \"/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py\", line 158, in __exit__\n    |     self.gen.throw(value)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    |     response = await self.dispatch_func(request, call_next)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    |     response = await call_next(request)\n    |                ^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    |     raise app_exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    |     await self.app(scope, receive_or_disconnect, send_no_error)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    |     await self.middleware_stack(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    |     await route.handle(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    |     await self.app(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    |     raise exc\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    |     await app(scope, receive, sender)\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    |     response = await func(request)\n    |                ^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    |     raise e\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    |     raw_response = await run_endpoint_function(\n    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    |     return await dependant.call(**values)\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    |   File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 420, in login_user\n    |     user = await db.users.find_one({\"username\": login_data.username})\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    | TypeError: object MagicMock can't be used in 'await' expression\n    +------------------------------------\n\nDuring handling of the above exception, another exception occurred:\n\nself = <test_user_status.TestMenuAccessControl object at 0x107d533e0>\nclient = <starlette.testclient.TestClient object at 0x1082adf70>\nmock_db = <MagicMock id='4431990320'>\nmock_pending_user = {'_id': 'test_id_1', 'email': 'test@example.com', 'password': '$2b$12$hashedpassword', 'role_name': 'free_user', ...}\n\n    def test_pending_user_login_returns_status(self, client, mock_db, mock_pending_user):\n        \"\"\"Test login response includes user status\"\"\"\n        with patch('database.get_database', return_value=mock_db):\n            mock_db.users.find_one = AsyncMock(return_value=mock_pending_user)\n    \n>           response = client.post(\n                \"/api/users/login\",\n                json={\"username\": \"testuser\", \"password\": \"password\"}\n            )\n\ntests/test_user_status.py:183: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nvenv/lib/python3.12/site-packages/starlette/testclient.py:593: in post\n    return super().post(\nvenv/lib/python3.12/site-packages/httpx/_client.py:1146: in post\n    return self.request(\nvenv/lib/python3.12/site-packages/starlette/testclient.py:468: in request\n    return super().request(\nvenv/lib/python3.12/site-packages/httpx/_client.py:828: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\nvenv/lib/python3.12/site-packages/httpx/_client.py:915: in send\n    response = self._send_handling_auth(\nvenv/lib/python3.12/site-packages/httpx/_client.py:943: in _send_handling_auth\n    response = self._send_handling_redirects(\nvenv/lib/python3.12/site-packages/httpx/_client.py:980: in _send_handling_redirects\n    response = self._send_single_request(request)\nvenv/lib/python3.12/site-packages/httpx/_client.py:1016: in _send_single_request\n    response = transport.handle_request(request)\nvenv/lib/python3.12/site-packages/starlette/testclient.py:344: in handle_request\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/testclient.py:341: in handle_request\n    portal.call(self.app, scope, receive, send)\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:321: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:456: in result\n    return self.__get_result()\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result\n    raise self._exception\nvenv/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func\n    retval = await retval_or_awaitable\nvenv/lib/python3.12/site-packages/fastapi/applications.py:1054: in __call__\n    await super().__call__(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/applications.py:123: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__\n    await self.app(scope, receive, _send)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:189: in __call__\n    with collapse_excgroups():\n/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py:158: in __exit__\n    self.gen.throw(value)\nvenv/lib/python3.12/site-packages/starlette/_utils.py:91: in collapse_excgroups\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:191: in __call__\n    response = await self.dispatch_func(request, call_next)\nmain.py:105: in log_requests\n    response = await call_next(request)\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:165: in call_next\n    raise app_exc\nvenv/lib/python3.12/site-packages/starlette/middleware/base.py:151: in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\nvenv/lib/python3.12/site-packages/starlette/middleware/cors.py:83: in __call__\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/middleware/exceptions.py:62: in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:762: in __call__\n    await self.middleware_stack(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:782: in app\n    await route.handle(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:297: in handle\n    await self.app(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/routing.py:77: in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:64: in wrapped_app\n    raise exc\nvenv/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app\n    await app(scope, receive, sender)\nvenv/lib/python3.12/site-packages/starlette/routing.py:72: in app\n    response = await func(request)\nvenv/lib/python3.12/site-packages/fastapi/routing.py:299: in app\n    raise e\nvenv/lib/python3.12/site-packages/fastapi/routing.py:294: in app\n    raw_response = await run_endpoint_function(\nvenv/lib/python3.12/site-packages/fastapi/routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nlogin_data = LoginRequest(username='testuser', password='password')\ndb = <MagicMock name='mock.__getitem__()' id='4432632128'>\n\n    @router.post(\"/login\")\n    async def login_user(login_data: LoginRequest, db = Depends(get_database)):\n        \"\"\"Login user and return access token\"\"\"\n        logger.info(f\"\ud83d\udd11 Login attempt for username: {login_data.username}\")\n    \n        # Special handling for hardcoded admin account\n        if login_data.username == \"admin\":\n            logger.info(\"\ud83d\udd10 Admin login attempt detected\")\n    \n            # Check hardcoded admin password\n            # In production, this should be stored securely in environment variables\n            ADMIN_PASSWORD = \"admin\"  # Hardcoded admin password\n    \n            if login_data.password == ADMIN_PASSWORD:\n                logger.info(\"\u2705 Admin login successful (hardcoded credentials)\")\n    \n                # Create access token\n                access_token_expires = timedelta(minutes=settings.access_token_expire_minutes)\n                access_token = create_access_token(\n                    data={\"sub\": \"admin\"}, expires_delta=access_token_expires\n                )\n    \n                # Return admin user data\n                return {\n                    \"message\": \"Admin login successful\",\n                    \"user\": {\n                        \"username\": \"admin\",\n                        \"firstName\": \"Admin\",\n                        \"lastName\": \"User\",\n                        \"contactEmail\": \"admin@system.com\",\n                        \"role\": \"admin\"\n                    },\n                    \"access_token\": access_token,\n                    \"token_type\": \"bearer\"\n                }\n            else:\n                logger.warning(\"\u26a0\ufe0f Admin login failed: Invalid password\")\n                raise HTTPException(\n                    status_code=status.HTTP_400_BAD_REQUEST,\n                    detail=\"Invalid credentials\"\n                )\n    \n        # Regular user login)\n    \n        # Find user\n        logger.debug(f\"Looking up user '{login_data.username}' in database...\")\n>       user = await db.users.find_one({\"username\": login_data.username})\nE       TypeError: object MagicMock can't be used in 'await' expression\n\nroutes.py:420: TypeError\n----------------------------- Captured stderr call -----------------------------\n2025-10-13 09:43:22,080 - main - INFO - \ud83d\udce8 Incoming POST request to /api/users/login\n2025-10-13 09:43:22,090 - routes - INFO - \ud83d\udd11 Login attempt for username: testuser\n2025-10-13 09:43:22,090 - main - ERROR - \u274c Error processing POST /api/users/login - Duration: 0.011s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 420, in login_user\n    user = await db.users.find_one({\"username\": login_data.username})\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n------------------------------ Captured log call -------------------------------\nINFO     main:main.py:101 \ud83d\udce8 Incoming POST request to /api/users/login\nINFO     routes:routes.py:377 \ud83d\udd11 Login attempt for username: testuser\nERROR    main:main.py:120 \u274c Error processing POST /api/users/login - Duration: 0.011s - Error: object MagicMock can't be used in 'await' expression\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 159, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/main.py\", line 105, in log_requests\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/routes.py\", line 420, in login_user\n    user = await db.users.find_one({\"username\": login_data.username})\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nTypeError: object MagicMock can't be used in 'await' expression\n=============================== warnings summary ===============================\nvenv/lib/python3.12/site-packages/pydantic/_internal/_config.py:271: 12 warnings\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pydantic/_internal/_config.py:271: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)\n\nmodels.py:104\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/models.py:104: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('username')\n\nmodels.py:110\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/models.py:110: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('gender')\n\nmodels.py:116\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/models.py:116: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('countryOfOrigin', 'countryOfResidence')\n\nmodels.py:122\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/models.py:122: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('height')\n\nmodels.py:136\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/models.py:136: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('religion')\n\nmodels.py:146\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/models.py:146: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('languagesSpoken')\n\nmodels.py:152\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/models.py:152: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('eatingPreference')\n\nmodels.py:158\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/models.py:158: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('citizenshipStatus')\n\nmodels.py:164\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/models.py:164: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('themePreference')\n\nvenv/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:252\nvenv/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:252\nvenv/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:252\nvenv/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:252\nvenv/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:252\nvenv/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:252\nvenv/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:252\nvenv/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:252\nvenv/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:252\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:252: PydanticDeprecatedSince20: `json_encoders` is deprecated. See https://docs.pydantic.dev/2.5/concepts/serialization/#custom-serializers for alternatives. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    warnings.warn(\n\nmodels.py:363\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/models.py:363: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('themePreference')\n\nauth/security_models.py:157\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/security_models.py:157: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('confirm_password')\n\nauth/security_models.py:163\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/security_models.py:163: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('password')\n\nauth/security_models.py:216\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/security_models.py:216: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('confirm_password')\n\nauth/security_models.py:222\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/security_models.py:222: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('new_password')\n\nauth/security_models.py:238\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/security_models.py:238: PydanticDeprecatedSince20: Pydantic V1 style `@validator` validators are deprecated. You should migrate to Pydantic V2 style `@field_validator` validators, see the migration guide for more details. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/\n    @validator('confirm_password')\n\nvenv/lib/python3.12/site-packages/passlib/utils/__init__.py:854\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13\n    from crypt import crypt as _crypt\n\nvenv/lib/python3.12/site-packages/starlette/routing.py:661\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/starlette/routing.py:661: DeprecationWarning: async generator function lifespans are deprecated, use an @contextlib.asynccontextmanager function instead\n    warnings.warn(\n\ntests/test_search.py:426\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py:426: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html\n    @pytest.mark.slow\n\ntests/test_search.py:434\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_search.py:434: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html\n    @pytest.mark.slow\n\ntests/test_auth.py: 2 warnings\ntests/test_auth_module.py: 4 warnings\ntests/test_jwt_timezone.py: 107 warnings\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/jwt_auth.py:28: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    expire = datetime.utcnow() + timedelta(minutes=security_settings.JWT_ACCESS_TOKEN_EXPIRE_MINUTES)\n\ntests/test_auth.py: 3 warnings\ntests/test_auth_module.py: 4 warnings\ntests/test_jwt_timezone.py: 108 warnings\ntests/test_user_status.py: 10 warnings\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/jwt_auth.py:32: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"iat\": datetime.utcnow(),\n\ntests/test_auth.py: 1 warning\ntests/test_jwt_timezone.py: 1 warning\ntests/test_user_status.py: 10 warnings\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/jwt_auth.py:26: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    expire = datetime.utcnow() + expires_delta\n\ntests/test_auth_module.py::TestPasswordManager::test_check_password_in_history\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_auth_module.py:104: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    history = [{\"password_hash\": hashed, \"changed_at\": datetime.utcnow()}]\n\ntests/test_auth_module.py::TestPasswordManager::test_calculate_password_expiry\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_auth_module.py:111: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    now = datetime.utcnow()\n\ntests/test_auth_module.py::TestPasswordManager::test_is_password_expired\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_auth_module.py:119: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    past_date = datetime.utcnow() - timedelta(days=1)\n\ntests/test_auth_module.py::TestPasswordManager::test_is_password_expired\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_auth_module.py:120: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    future_date = datetime.utcnow() + timedelta(days=1)\n\ntests/test_auth_module.py::TestPasswordManager::test_is_password_expired\ntests/test_auth_module.py::TestPasswordManager::test_is_password_expired\ntests/test_auth_module.py::TestPasswordPolicyIntegration::test_password_expiry_workflow\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/password_utils.py:53: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    return datetime.utcnow() >= expires_at\n\ntests/test_auth_module.py::TestAccountLockoutManager::test_calculate_lockout_until\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_auth_module.py:146: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    now = datetime.utcnow()\n\ntests/test_auth_module.py::TestAccountLockoutManager::test_calculate_lockout_until\ntests/test_auth_module.py::TestAccountLockoutIntegration::test_failed_login_workflow\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/password_utils.py:130: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    return datetime.utcnow() + timedelta(minutes=security_settings.ACCOUNT_LOCKOUT_DURATION_MINUTES)\n\ntests/test_auth_module.py::TestAccountLockoutManager::test_is_account_locked\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_auth_module.py:154: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    past_date = datetime.utcnow() - timedelta(minutes=1)\n\ntests/test_auth_module.py::TestAccountLockoutManager::test_is_account_locked\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_auth_module.py:155: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    future_date = datetime.utcnow() + timedelta(minutes=30)\n\ntests/test_auth_module.py::TestAccountLockoutManager::test_is_account_locked\ntests/test_auth_module.py::TestAccountLockoutManager::test_is_account_locked\ntests/test_auth_module.py::TestAccountLockoutIntegration::test_failed_login_workflow\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/password_utils.py:137: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    return datetime.utcnow() < locked_until\n\ntests/test_auth_module.py::TestTokenManager::test_calculate_token_expiry\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_auth_module.py:182: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    now = datetime.utcnow()\n\ntests/test_auth_module.py::TestTokenManager::test_calculate_token_expiry\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/password_utils.py:165: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    return datetime.utcnow() + timedelta(hours=hours)\n\ntests/test_auth_module.py::TestTokenManager::test_is_token_expired\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_auth_module.py:190: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    past_date = datetime.utcnow() - timedelta(hours=1)\n\ntests/test_auth_module.py::TestTokenManager::test_is_token_expired\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_auth_module.py:191: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    future_date = datetime.utcnow() + timedelta(hours=24)\n\ntests/test_auth_module.py::TestTokenManager::test_is_token_expired\ntests/test_auth_module.py::TestTokenManager::test_is_token_expired\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/password_utils.py:170: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    return datetime.utcnow() >= expires_at\n\ntests/test_auth_module.py::TestJWTManager::test_create_refresh_token\ntests/test_auth_module.py::TestJWTManager::test_verify_token_type\ntests/test_auth_module.py::TestJWTManager::test_create_token_pair\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/jwt_auth.py:48: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    expire = datetime.utcnow() + timedelta(days=security_settings.JWT_REFRESH_TOKEN_EXPIRE_DAYS)\n\ntests/test_auth_module.py::TestJWTManager::test_create_refresh_token\ntests/test_auth_module.py::TestJWTManager::test_verify_token_type\ntests/test_auth_module.py::TestJWTManager::test_create_token_pair\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/jwt_auth.py:52: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"iat\": datetime.utcnow(),\n\ntests/test_auth_module.py: 3 warnings\ntests/test_jwt_timezone.py: 8 warnings\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/jose/jwt.py:311: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    now = timegm(datetime.utcnow().utctimetuple())\n\ntests/test_auth_module.py::TestAuditLogger::test_log_event\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/audit_logger.py:43: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"timestamp\": datetime.utcnow(),\n\ntests/test_auth_module.py::TestPasswordPolicyIntegration::test_password_expiry_workflow\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_auth_module.py:383: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    changed_at = datetime.utcnow()\n\ntests/test_auth_module.py::TestPasswordPolicyIntegration::test_password_expiry_workflow\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/password_utils.py:47: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    delta = expires_at - datetime.utcnow()\n\ntests/test_auth_module.py::TestPasswordPolicyIntegration::test_password_history_workflow\ntests/test_auth_module.py::TestPasswordPolicyIntegration::test_password_history_workflow\ntests/test_auth_module.py::TestPasswordPolicyIntegration::test_password_history_workflow\ntests/test_auth_module.py::TestPasswordPolicyIntegration::test_password_history_workflow\ntests/test_auth_module.py::TestPasswordPolicyIntegration::test_password_history_workflow\ntests/test_auth_module.py::TestPasswordPolicyIntegration::test_password_history_workflow\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/auth/password_utils.py:108: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"changed_at\": datetime.utcnow()\n\ntests/test_database.py::TestCloseMongoConnection::test_close_mongo_connection_with_client\ntests/test_database.py::TestCloseMongoConnection::test_close_mongo_connection_client_close_exception\ntests/test_database.py::TestDatabaseIntegration::test_full_connection_lifecycle\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/database.py:29: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited\n    client.close()\n  Enable tracemalloc to get traceback where the object was allocated.\n  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.\n\ntests/test_e2e_api.py::test_api_error_scenarios\ntests/test_routes_integration.py::TestErrorHandling::test_invalid_json_payload\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/httpx/_content.py:204: DeprecationWarning: Use 'content=<...>' to upload raw bytes/text content.\n    warnings.warn(message, DeprecationWarning)\n\ntests/test_messages.py::TestMessagePrivacy::test_send_message_to_blocked_user_marked_invisible\ntests/test_messages.py::TestMessagePrivacy::test_send_message_from_blocked_user_marked_invisible\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_messages.py:150: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow()\n\ntests/test_messages.py::TestGetConversation::test_get_conversation_success\ntests/test_messages.py::TestGetConversation::test_get_conversation_sorted_chronologically\ntests/test_messages.py::TestGetConversation::test_get_conversation_marks_messages_as_read\ntests/test_messages.py::TestGetConversation::test_get_conversation_includes_other_user_profile\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_messages.py:197: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow() - timedelta(minutes=5)\n\ntests/test_messages.py::TestGetConversation::test_get_conversation_success\ntests/test_messages.py::TestGetConversation::test_get_conversation_sorted_chronologically\ntests/test_messages.py::TestGetConversation::test_get_conversation_marks_messages_as_read\ntests/test_messages.py::TestGetConversation::test_get_conversation_includes_other_user_profile\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_messages.py:205: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow() - timedelta(minutes=3)\n\ntests/test_messages.py::TestGetConversation::test_get_conversation_success\ntests/test_messages.py::TestGetConversation::test_get_conversation_sorted_chronologically\ntests/test_messages.py::TestGetConversation::test_get_conversation_marks_messages_as_read\ntests/test_messages.py::TestGetConversation::test_get_conversation_includes_other_user_profile\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_messages.py:213: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow()\n\ntests/test_messages.py::TestGetConversations::test_get_conversations_success\ntests/test_messages.py::TestGetConversations::test_get_conversations_sorted_by_recent\ntests/test_messages.py::TestGetConversations::test_get_conversations_includes_unread_count\ntests/test_messages.py::TestGetConversations::test_get_conversations_includes_last_message\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_messages.py:286: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow() - timedelta(hours=1)\n\ntests/test_messages.py::TestGetConversations::test_get_conversations_success\ntests/test_messages.py::TestGetConversations::test_get_conversations_sorted_by_recent\ntests/test_messages.py::TestGetConversations::test_get_conversations_includes_unread_count\ntests/test_messages.py::TestGetConversations::test_get_conversations_includes_last_message\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_messages.py:294: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow() - timedelta(minutes=30)\n\ntests/test_messages.py::TestGetConversations::test_get_conversations_success\ntests/test_messages.py::TestGetConversations::test_get_conversations_sorted_by_recent\ntests/test_messages.py::TestGetConversations::test_get_conversations_includes_unread_count\ntests/test_messages.py::TestGetConversations::test_get_conversations_includes_last_message\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_messages.py:302: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow()\n\ntests/test_messages.py::TestAdminOverride::test_admin_can_see_blocked_messages\ntests/test_messages.py::TestAdminOverride::test_regular_user_cannot_see_blocked_messages\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_messages.py:370: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow()\n\ntests/test_messages.py::TestAdminOverride::test_admin_can_see_blocked_messages\ntests/test_messages.py::TestAdminOverride::test_regular_user_cannot_see_blocked_messages\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_messages.py:381: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow()\n\ntests/test_models.py::TestUserInDB::test_valid_user_in_db\ntests/test_models.py::TestUserInDB::test_valid_user_in_db\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/pydantic/main.py:164: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    __pydantic_self__.__pydantic_validator__.validate_python(data, self_instance=__pydantic_self__)\n\ntests/test_models.py::TestUserResponse::test_valid_user_response\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_models.py:135: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow(),\n\ntests/test_models.py::TestUserResponse::test_valid_user_response\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_models.py:136: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"updatedAt\": datetime.utcnow()\n\ntests/test_pii_security.py::TestCreateAccessRequest::test_create_access_request_new\ntests/test_pii_security.py::TestCreateAccessRequest::test_create_access_request_existing_denied\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/pii_security.py:189: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    'requestDate': datetime.utcnow().isoformat(),\n\ntests/test_pii_security.py::TestRespondToAccessRequest::test_respond_to_access_request_approve\ntests/test_pii_security.py::TestRespondToAccessRequest::test_respond_to_access_request_deny\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/pii_security.py:227: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    'responseDate': datetime.utcnow().isoformat()\n\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_success\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_includes_viewer_details\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_sorted_by_recent\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_with_limit\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py:174: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"viewedAt\": datetime.utcnow(),\n\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_success\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_includes_viewer_details\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_sorted_by_recent\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_with_limit\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py:175: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow()\n\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_success\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_includes_viewer_details\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_sorted_by_recent\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_with_limit\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py:180: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"viewedAt\": datetime.utcnow() - timedelta(hours=2),\n\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_success\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_includes_viewer_details\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_sorted_by_recent\ntests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_with_limit\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py:181: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow() - timedelta(hours=2)\n\ntests/test_profile_views.py::TestProfileViewCount::test_get_view_count_success\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py:253: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"viewedAt\": datetime.utcnow(),\n\ntests/test_profile_views.py::TestProfileViewCount::test_get_view_count_success\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py:254: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow()\n\ntests/test_profile_views.py::TestProfileViewCount::test_get_view_count_success\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py:259: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"viewedAt\": datetime.utcnow() - timedelta(days=2),\n\ntests/test_profile_views.py::TestProfileViewCount::test_get_view_count_success\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py:260: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow() - timedelta(days=2)\n\ntests/test_profile_views.py::TestProfileViewCount::test_get_view_count_success\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py:265: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"viewedAt\": datetime.utcnow(),\n\ntests/test_profile_views.py::TestProfileViewCount::test_get_view_count_success\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_profile_views.py:266: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow()\n\ntests/test_user_interactions.py::TestGetTheirFavorites::test_get_their_favorites\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py:253: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow()\n\ntests/test_user_interactions.py::TestGetTheirFavorites::test_get_their_favorites\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py:258: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow()\n\ntests/test_user_interactions.py::TestGetTheirShortlists::test_get_their_shortlists\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_interactions.py:289: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"createdAt\": datetime.utcnow()\n\ntests/test_user_status.py::TestUserStatusField::test_status_field_structure\ntests/test_user_status.py::TestUserActivation::test_admin_can_activate_pending_user\ntests/test_user_status.py::TestMenuAccessControl::test_pending_user_login_returns_status\ntests/test_user_status.py::TestMenuAccessControl::test_pending_user_limited_access\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_status.py:45: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"updatedAt\": datetime.utcnow().isoformat(),\n\ntests/test_user_status.py::TestMenuAccessControl::test_active_user_has_full_access\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/tests/test_user_status.py:62: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n    \"updatedAt\": datetime.utcnow().isoformat(),\n\ntests/test_utils.py::TestSaveUploadFile::test_save_upload_file_success\ntests/test_utils.py::TestSaveUploadFile::test_save_upload_file_no_extension\ntests/test_utils.py::TestSaveUploadFile::test_save_upload_file_creates_directory\ntests/test_utils.py::TestSaveUploadFile::test_save_upload_file_exception_handling\ntests/test_utils.py::TestSaveMultipleFiles::test_save_multiple_files_success\ntests/test_utils.py::TestSaveMultipleFiles::test_save_multiple_files_mixed_types\ntests/test_utils.py::TestSaveMultipleFiles::test_save_multiple_files_size_limit\ntests/test_utils.py::TestSaveMultipleFiles::test_save_multiple_files_partial_failure\ntests/test_utils.py::TestSaveMultipleFiles::test_save_multiple_files_empty_list\n  /Users/rajsiripuram02/opt/appsrc/profiledata/fastapi_backend/venv/lib/python3.12/site-packages/_pytest/python.py:182: PytestUnhandledCoroutineWarning: async def functions are not natively supported and have been skipped.\n  You need to install a suitable plugin for your async framework, for example:\n    - anyio\n    - pytest-asyncio\n    - pytest-tornasync\n    - pytest-trio\n    - pytest-twisted\n    warnings.warn(PytestUnhandledCoroutineWarning(msg.format(nodeid)))\n\n-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html\n=========================== short test summary info ============================\nFAILED tests/test_auth.py::TestJWTTokenFunctions::test_create_access_token_with_custom_settings\nFAILED tests/test_auth.py::TestGetCurrentUser::test_get_current_user_valid_token\nFAILED tests/test_auth.py::TestGetCurrentUser::test_get_current_user_invalid_token\nFAILED tests/test_auth.py::TestGetCurrentUser::test_get_current_user_expired_token\nFAILED tests/test_auth.py::TestGetCurrentUser::test_get_current_user_no_sub\nFAILED tests/test_auth.py::TestGetCurrentUser::test_get_current_user_wrong_secret\nFAILED tests/test_auth.py::TestIntegrationScenarios::test_full_authentication_flow\nFAILED tests/test_auth.py::TestIntegrationScenarios::test_password_security_edge_cases\nFAILED tests/test_auth_module.py::TestPasswordPolicyIntegration::test_password_expiry_workflow\nFAILED tests/test_e2e_api.py::test_full_user_lifecycle - assert 422 == 201\nFAILED tests/test_e2e_api.py::test_pii_masking_workflow - RuntimeError: Task ...\nFAILED tests/test_e2e_api.py::test_search_and_filtering - AttributeError: 'st...\nFAILED tests/test_e2e_api.py::test_concurrent_requests - RuntimeError: Task <...\nFAILED tests/test_e2e_api.py::test_cors_headers - assert 405 == 200\nFAILED tests/test_jwt_timezone.py::TestTokenRefresh::test_refresh_token_extends_expiry\nFAILED tests/test_messages.py::TestSendMessage::test_send_message_success - a...\nFAILED tests/test_messages.py::TestSendMessage::test_send_empty_message - ass...\nFAILED tests/test_messages.py::TestSendMessage::test_send_message_too_long - ...\nFAILED tests/test_messages.py::TestSendMessage::test_send_message_trims_whitespace\nFAILED tests/test_messages.py::TestMessagePrivacy::test_send_message_to_blocked_user_marked_invisible\nFAILED tests/test_messages.py::TestMessagePrivacy::test_send_message_from_blocked_user_marked_invisible\nFAILED tests/test_messages.py::TestGetConversation::test_get_conversation_success\nFAILED tests/test_messages.py::TestGetConversation::test_get_conversation_sorted_chronologically\nFAILED tests/test_messages.py::TestGetConversation::test_get_conversation_marks_messages_as_read\nFAILED tests/test_messages.py::TestGetConversation::test_get_conversation_includes_other_user_profile\nFAILED tests/test_messages.py::TestGetConversation::test_get_conversation_empty\nFAILED tests/test_messages.py::TestGetConversations::test_get_conversations_success\nFAILED tests/test_messages.py::TestGetConversations::test_get_conversations_sorted_by_recent\nFAILED tests/test_messages.py::TestGetConversations::test_get_conversations_includes_unread_count\nFAILED tests/test_messages.py::TestGetConversations::test_get_conversations_includes_last_message\nFAILED tests/test_messages.py::TestGetConversations::test_get_conversations_empty\nFAILED tests/test_messages.py::TestAdminOverride::test_admin_can_see_blocked_messages\nFAILED tests/test_messages.py::TestAdminOverride::test_regular_user_cannot_see_blocked_messages\nFAILED tests/test_messages.py::TestMessageEdgeCases::test_send_message_missing_username\nFAILED tests/test_messages.py::TestMessageEdgeCases::test_send_message_special_characters\nFAILED tests/test_messages.py::TestMessageIntegration::test_full_conversation_workflow\nFAILED tests/test_messages.py::TestMessageIntegration::test_block_user_hides_messages\nFAILED tests/test_models.py::TestUserBase::test_valid_user_base_creation - py...\nFAILED tests/test_models.py::TestUserBase::test_sex_validation - pydantic_cor...\nFAILED tests/test_models.py::TestUserBase::test_eating_preference_validation\nFAILED tests/test_models.py::TestUserBase::test_citizenship_status_validation\nFAILED tests/test_models.py::TestUserCreate::test_valid_user_create - pydanti...\nFAILED tests/test_models.py::TestUserInDB::test_valid_user_in_db - pydantic_c...\nFAILED tests/test_models.py::TestUserResponse::test_valid_user_response - pyd...\nFAILED tests/test_profile_views.py::TestProfileViewTracking::test_track_profile_view_success\nFAILED tests/test_profile_views.py::TestProfileViewTracking::test_track_view_nonexistent_profile\nFAILED tests/test_profile_views.py::TestProfileViewTracking::test_track_view_nonexistent_viewer\nFAILED tests/test_profile_views.py::TestProfileViewTracking::test_duplicate_view_within_24h_updates_timestamp\nFAILED tests/test_profile_views.py::TestProfileViewTracking::test_multiple_viewers_tracked_separately\nFAILED tests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_success\nFAILED tests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_includes_viewer_details\nFAILED tests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_sorted_by_recent\nFAILED tests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_with_limit\nFAILED tests/test_profile_views.py::TestGetProfileViews::test_get_profile_views_empty\nFAILED tests/test_profile_views.py::TestProfileViewCount::test_get_view_count_success\nFAILED tests/test_profile_views.py::TestProfileViewCount::test_get_view_count_no_views\nFAILED tests/test_profile_views.py::TestProfileViewIntegration::test_full_profile_view_workflow\nFAILED tests/test_profile_views.py::TestProfileViewIntegration::test_multiple_profiles_isolated\nFAILED tests/test_profile_views.py::TestProfileViewEdgeCases::test_invalid_username_format\nFAILED tests/test_routes_integration.py::TestUserRegistration::test_register_user_success\nFAILED tests/test_routes_integration.py::TestUserRegistration::test_register_user_duplicate_username\nFAILED tests/test_routes_integration.py::TestUserRegistration::test_register_user_duplicate_email\nFAILED tests/test_routes_integration.py::TestUserRegistration::test_register_user_too_many_images\nFAILED tests/test_routes_integration.py::TestUserLogin::test_login_success - ...\nFAILED tests/test_routes_integration.py::TestUserLogin::test_login_invalid_credentials\nFAILED tests/test_routes_integration.py::TestUserLogin::test_login_admin_success\nFAILED tests/test_routes_integration.py::TestUserProfile::test_get_user_profile_own\nFAILED tests/test_routes_integration.py::TestUserProfile::test_get_user_profile_other_user\nFAILED tests/test_routes_integration.py::TestUserProfile::test_get_user_profile_not_found\nFAILED tests/test_routes_integration.py::TestUserProfile::test_update_user_profile\nFAILED tests/test_routes_integration.py::TestSearch::test_search_users_basic\nFAILED tests/test_routes_integration.py::TestSearch::test_search_users_with_filters\nFAILED tests/test_routes_integration.py::TestSearch::test_search_users_pagination\nFAILED tests/test_routes_integration.py::TestAdminEndpoints::test_get_all_users_admin\nFAILED tests/test_routes_integration.py::TestAccessRequests::test_create_access_request\nFAILED tests/test_routes_integration.py::TestAccessRequests::test_create_duplicate_access_request\nFAILED tests/test_routes_integration.py::TestAccessRequests::test_get_access_requests\nFAILED tests/test_routes_integration.py::TestFavorites::test_add_to_favorites\nFAILED tests/test_routes_integration.py::TestFavorites::test_add_duplicate_to_favorites\nFAILED tests/test_routes_integration.py::TestFavorites::test_get_favorites - ...\nFAILED tests/test_routes_integration.py::TestMessaging::test_send_message - R...\nFAILED tests/test_routes_integration.py::TestMessaging::test_get_messages - R...\nFAILED tests/test_search.py::TestKeywordSearch::test_search_by_first_name - A...\nFAILED tests/test_search.py::TestKeywordSearch::test_search_by_last_name - At...\nFAILED tests/test_search.py::TestKeywordSearch::test_search_by_location - Att...\nFAILED tests/test_search.py::TestKeywordSearch::test_search_case_insensitive\nFAILED tests/test_search.py::TestKeywordSearch::test_search_partial_match - A...\nFAILED tests/test_search.py::TestAgeRangeSearch::test_search_by_age_range - A...\nFAILED tests/test_search.py::TestAgeRangeSearch::test_search_by_min_age_only\nFAILED tests/test_search.py::TestAgeRangeSearch::test_search_by_max_age_only\nFAILED tests/test_search.py::TestAgeRangeSearch::test_search_invalid_age_range\nFAILED tests/test_search.py::TestHeightRangeSearch::test_search_by_height_range\nFAILED tests/test_search.py::TestHeightRangeSearch::test_search_by_min_height_only\nFAILED tests/test_search.py::TestHeightRangeSearch::test_search_by_max_height_only\nFAILED tests/test_search.py::TestGenderSearch::test_search_by_gender_male - A...\nFAILED tests/test_search.py::TestGenderSearch::test_search_by_gender_female\nFAILED tests/test_search.py::TestLocationSearch::test_search_by_exact_location\nFAILED tests/test_search.py::TestLocationSearch::test_search_by_city_only - A...\nFAILED tests/test_search.py::TestEducationOccupationSearch::test_search_by_education\nFAILED tests/test_search.py::TestEducationOccupationSearch::test_search_by_occupation\nFAILED tests/test_search.py::TestReligionEatingPreference::test_search_by_religion\nFAILED tests/test_search.py::TestReligionEatingPreference::test_search_by_eating_preference\nFAILED tests/test_search.py::TestMultipleFilters::test_search_with_multiple_filters\nFAILED tests/test_search.py::TestMultipleFilters::test_search_keyword_with_filters\nFAILED tests/test_search.py::TestMultipleFilters::test_search_all_filters_combined\nFAILED tests/test_search.py::TestPagination::test_search_with_pagination - At...\nFAILED tests/test_search.py::TestPagination::test_search_page_2 - AttributeEr...\nFAILED tests/test_search.py::TestPagination::test_search_different_page_sizes\nFAILED tests/test_search.py::TestPagination::test_search_invalid_page_number\nFAILED tests/test_search.py::TestEmptyResults::test_search_no_matches - Attri...\nFAILED tests/test_search.py::TestEmptyResults::test_search_impossible_filters\nFAILED tests/test_search.py::TestSearchPerformance::test_search_with_many_results\nFAILED tests/test_search.py::TestSearchPerformance::test_complex_search_performance\nFAILED tests/test_search.py::TestSearchEdgeCases::test_search_with_special_characters\nFAILED tests/test_search.py::TestSearchEdgeCases::test_search_with_very_long_keyword\nFAILED tests/test_search.py::TestSearchEdgeCases::test_search_with_sql_injection_attempt\nFAILED tests/test_search.py::TestSearchEdgeCases::test_search_with_empty_parameters\nFAILED tests/test_search.py::TestSearchIntegration::test_search_to_profile_view_workflow\nFAILED tests/test_user_interactions.py::TestFavorites::test_add_to_favorites_success\nFAILED tests/test_user_interactions.py::TestFavorites::test_add_to_favorites_nonexistent_user\nFAILED tests/test_user_interactions.py::TestFavorites::test_add_self_to_favorites\nFAILED tests/test_user_interactions.py::TestFavorites::test_duplicate_favorite\nFAILED tests/test_user_interactions.py::TestFavorites::test_remove_from_favorites_success\nFAILED tests/test_user_interactions.py::TestFavorites::test_remove_nonexistent_favorite\nFAILED tests/test_user_interactions.py::TestFavorites::test_get_favorites_list\nFAILED tests/test_user_interactions.py::TestShortlist::test_add_to_shortlist_success\nFAILED tests/test_user_interactions.py::TestShortlist::test_remove_from_shortlist_success\nFAILED tests/test_user_interactions.py::TestShortlist::test_get_shortlist - R...\nFAILED tests/test_user_interactions.py::TestShortlist::test_duplicate_shortlist\nFAILED tests/test_user_interactions.py::TestExclusions::test_add_to_exclusions_success\nFAILED tests/test_user_interactions.py::TestExclusions::test_remove_from_exclusions_success\nFAILED tests/test_user_interactions.py::TestExclusions::test_get_exclusions_list\nFAILED tests/test_user_interactions.py::TestExclusions::test_exclusion_affects_search_results\nFAILED tests/test_user_interactions.py::TestGetTheirFavorites::test_get_their_favorites\nFAILED tests/test_user_interactions.py::TestGetTheirShortlists::test_get_their_shortlists\nFAILED tests/test_user_interactions.py::TestCrossFeatureInteractions::test_favorite_and_shortlist_same_user\nFAILED tests/test_user_interactions.py::TestCrossFeatureInteractions::test_favorite_then_exclude\nFAILED tests/test_user_interactions.py::TestCrossFeatureInteractions::test_exclude_removes_from_search\nFAILED tests/test_user_interactions.py::TestInteractionEdgeCases::test_multiple_users_favorite_same_profile\nFAILED tests/test_user_interactions.py::TestInteractionEdgeCases::test_bidirectional_favorites\nFAILED tests/test_user_interactions.py::TestInteractionEdgeCases::test_remove_all_interactions\nFAILED tests/test_user_status.py::TestUserActivation::test_admin_can_activate_pending_user\nFAILED tests/test_user_status.py::TestMenuAccessControl::test_pending_user_login_returns_status\n143 failed, 259 passed, 9 skipped, 419 warnings in 147.30s (0:02:27)\n",
  "error": ""
}