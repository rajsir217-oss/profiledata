# Build Information Tracking

This application tracks build date-time for both frontend and backend deployments.

## How It Works

### Frontend Build Info

**Generation:**
- Build info is generated by `frontend/generate-build-info.js`
- Automatically runs before every build via `prebuild` script in `package.json`
- Creates `/frontend/public/build-info.json` with build timestamp

**Files:**
- **Generator Script:** `frontend/generate-build-info.js`
- **Output File:** `frontend/public/build-info.json` (copied to build output)
- **Display:** `frontend/src/components/SystemStatus.js` loads and displays the info

**When It Runs:**
- ‚úÖ Local development: `npm run build`
- ‚úÖ Production deployment: Docker build runs `npm run build`
- ‚úÖ All build variants: `build:local`, `build:docker`, `build:dev`, etc.

---

### Backend Build Info

**Generation:**
- Build info is generated by `fastapi_backend/generate_build_info.py`
- Manually triggered before deployment or via build scripts
- Creates `fastapi_backend/build_info.py` with build timestamp

**Files:**
- **Generator Script:** `fastapi_backend/generate_build_info.py`
- **Output File:** `fastapi_backend/build_info.py` (Python module)
- **API Endpoint:** `/api/users/system/health` returns build info
- **Display:** `frontend/src/components/SystemStatus.js` fetches and displays

**When It Runs:**
- ‚úÖ Local build: `./build-local.sh`
- ‚úÖ Production deployment: `deploy_gcp/deploy_backend_simple.sh` runs it
- ‚úÖ Manual: `cd fastapi_backend && python3 generate_build_info.py`

---

## Usage

### For Local Development

Generate build info for both services:
```bash
./build-local.sh
```

Or generate individually:
```bash
# Backend only
cd fastapi_backend
python3 generate_build_info.py

# Frontend only
cd frontend
node generate-build-info.js
```

---

### For Production Deployment

Build info is automatically generated during deployment:

```bash
# Full deployment (includes build info generation)
./deploy_gcp/deploy-production.sh

# Backend only (includes build info generation)
./deploy_gcp/deploy_backend_simple.sh

# Frontend only (build info via prebuild script)
./deploy_gcp/deploy_frontend_full.sh
```

---

## Viewing Build Information

1. Log in to the application as an admin
2. Navigate to **Preferences ‚Üí SysConfig** tab
3. Scroll to the "üì¶ Build Information" section
4. View build dates and versions for:
   - **‚öôÔ∏è Backend** - Shows when backend was last built/deployed
   - **üåê Frontend** - Shows when frontend was last built/deployed

---

## Build Info Format

### Frontend (`public/build-info.json`)
```json
{
  "buildTime": "2025-11-06T23:01:15.179Z",
  "buildDate": "November 6, 2025 at 11:01 PM PST",
  "version": "1.0.0",
  "environment": "production",
  "gitCommit": "unknown",
  "gitBranch": "unknown"
}
```

### Backend (`build_info.py`)
```python
BUILD_TIME = "2025-11-07T07:01:15+00:00"
BUILD_DATE = "November 06, 2025 11:01 PM UTC"
VERSION = "1.0.0"
ENVIRONMENT = "production"
GIT_COMMIT = "unknown"
GIT_BRANCH = "unknown"
```

---

## Environment Variables

You can customize build info with environment variables:

```bash
# Version
export APP_VERSION="2.0.0"

# Environment
export ENVIRONMENT="production"  # or "staging", "dev", "local"

# Git info (optional)
export GIT_COMMIT=$(git rev-parse --short HEAD)
export GIT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
```

---

## Troubleshooting

### Build info shows "unknown"

**Problem:** Build date shows as "unknown" in System Config

**Solution:** Run the build info generation script:
```bash
# For backend
cd fastapi_backend && python3 generate_build_info.py

# For frontend
cd frontend && node generate-build-info.js
```

### Backend build info not updating

**Problem:** After deployment, backend still shows old build date

**Solution:** 
1. Verify `generate_build_info.py` ran during deployment
2. Check deployment logs for "üìù Generating build information..."
3. Restart the backend service to reload the module

### Frontend build info not updating

**Problem:** Frontend shows old build date after deployment

**Solution:**
1. Clear browser cache (hard refresh: Cmd+Shift+R or Ctrl+Shift+F5)
2. Verify `build-info.json` exists in the deployed build
3. Check browser console for fetch errors

---

## Development Notes

- **Frontend:** Build info is static after build (captured at build time)
- **Backend:** Build info is static after deployment (captured when script runs)
- **Not runtime:** Neither captures server startup time - they capture BUILD time
- **Persisted:** Both files are checked into git with placeholder values, overwritten during build/deployment

---

## Files Modified

### Frontend
- `frontend/generate-build-info.js` - Generator script
- `frontend/public/build-info.json` - Output file (git-tracked with placeholder)
- `frontend/package.json` - Added `prebuild` script
- `frontend/src/components/SystemStatus.js` - Loads and displays build info

### Backend  
- `fastapi_backend/generate_build_info.py` - Generator script
- `fastapi_backend/build_info.py` - Output module (git-tracked with placeholder)
- `fastapi_backend/routers/system_health.py` - Returns build info in API
- `deploy_gcp/deploy_backend_simple.sh` - Runs generator before deployment

### Root
- `build-local.sh` - Convenience script to generate both
- `BUILD_INFO.md` - This documentation
